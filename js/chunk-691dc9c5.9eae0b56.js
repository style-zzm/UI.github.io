(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-691dc9c5"],{"4e36":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"draw"},[t.lineStep==t.lineNum?a("div",{ref:"drawTop",staticClass:"drawTop"},[a("div",[a("a-button",{attrs:{type:""},on:{click:t.resetAll}},[t._v("清空")]),a("a-button",{attrs:{type:""},on:{click:t.repeal}},[t._v("撤销")]),a("a-button",{attrs:{type:""},on:{click:t.canvasRedo}},[t._v("恢复")]),a("a-button",{attrs:{type:""},on:{click:t.downLoad}},[t._v("下载")])],1),a("div",{staticStyle:{width:"22%"}},[t._v(" 选择绘制类型: "),a("a-radio-group",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.typeOption,(function(e,s){return a("a-radio-button",{key:s,attrs:{value:e.value},nativeOn:{click:function(a){return t.radioClick(e.value)}}},[t._v(t._s(e.label)+" ")])})),1)],1),a("div",{staticStyle:{width:"15%"}},[t._v(" 边框粗细: "),a("a-slider",{staticStyle:{width:"70%"},attrs:{min:0,max:10,step:1},model:{value:t.lineWidth,callback:function(e){t.lineWidth=e},expression:"lineWidth"}})],1),a("div",{staticStyle:{width:"15%"}},[t._v(" 文字大小: "),a("a-slider",{staticStyle:{width:"70%"},attrs:{min:14,max:36,step:2},model:{value:t.fontSize,callback:function(e){t.fontSize=e},expression:"fontSize"}})],1)]):t._e(),a("div",{staticStyle:{height:"100%",width:"100%",position:"relative"}},[a("div",{staticClass:"content"}),a("input",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],ref:"txt",staticStyle:{"z-index":"9999",position:"absolute",border:"0",background:"none",outline:"none"},attrs:{type:"text",id:"txt"},on:{blur:t.txtBlue}})])])},n=[],i={name:"zzm-mark-js",props:{imgPath:{type:String,default:"/img/quyu_bg.jpg"}},data(){return{isShow:!1,canvas:"",ctx:"",ctxX:0,ctxY:0,lineWidth:1,type:"L",typeOption:[{label:"线",value:"L"},{label:"矩形",value:"R"},{label:"箭头",value:"A"},{label:"文字",value:"T"}],canvasHistory:[],step:0,loading:!1,fillStyle:"#CB0707",strokeStyle:"#CB0707",lineNum:2,linePeak:[],lineStep:2,ellipseR:.5,dialogVisible:!1,isUnfold:!0,fontSize:24,fontColor:"#CB0707",fontFamily:"微软雅黑",img:new Image}},mounted(){const t=this,e=document.createElement("img");e.src="/img/zip.0742bf7a.png",console.log(e),e.onload=function(){if(console.log(e),e.complete){t.img=e;const a=document.getElementsByClassName("content")[0];t.canvas=document.createElement("canvas"),t.canvas.height=t.img.height,t.canvas.width=t.img.width,t.ctx=t.canvas.getContext("2d"),t.ctx.globalAlpha=1,t.ctx.drawImage(t.img,0,0),t.canvasHistory.push(t.canvas.toDataURL()),t.ctx.globalCompositeOperation=t.type,a.appendChild(t.canvas),t.bindEventLisner()}}},methods:{radioClick(t){"T"!==t&&(this.txtBlue(),this.resetTxt())},downLoad(){const t=this,e=t.canvas.toDataURL("image/png"),a="canvas.png";if("download"in document.createElement("a")){const t=document.createElement("a");t.download=a,t.style.display="none",t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}else navigator.msSaveBlob(e,a)},resetAll(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvasHistory=[],this.ctx.drawImage(this.img,0,0),this.canvasHistory.push(this.canvas.toDataURL()),this.step=0,this.resetTxt()},reset(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.img,0,0),this.resetTxt()},repeal(){const t=this;this.isShow?(t.resetTxt(),t._repeal()):t._repeal()},_repeal(){if(this.step>=1){this.step=this.step-1;const t=new Image;t.src=this.canvasHistory[this.step],t.addEventListener("load",()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t,0,0),this.loading=!0})}else this.$message.warning("不能再继续撤销了")},canvasRedo(){if(this.step<this.canvasHistory.length-1){0===this.step?this.step=1:this.step++;const t=new Image;t.src=this.canvasHistory[this.step],t.addEventListener("load",()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t,0,0)})}else this.$message.warning("已经是最新的记录了")},rebroadcast(){const t=new Image;t.src=this.canvasHistory[this.step],t.addEventListener("load",()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t,0,0),this.loading=!0})},bindEventLisner(){const t=this;let e,a;this.canvas.onmousedown=function(s){console.log("onmousedown"),"L"===t.type?t.createL(s,"begin"):"R"===t.type?(e=s.layerX,a=s.layerY,t.createR(s,"begin",e,a)):"A"===t.type?t.drawArrow(s,"begin"):"T"===t.type&&t.createT(s,"begin")},this.canvas.onmouseup=function(s){console.log("onmouseup"),"L"===t.type?t.createL(s,"end"):"R"===t.type?(t.createR(s,"end",e,a),e=null,a=null):"A"===t.type?t.drawArrow(s,"end"):"T"===t.type&&t.createT(s,"end")}},createL(t,e){const a=this;"begin"===e?(a.ctx.beginPath(),a.ctx.moveTo(t.layerX,t.layerY),a.canvas.onmousemove=function(t){console.log("onmousemove"),a.ctx.lineTo(t.layerX,t.layerY),a.ctx.strokeStyle=a.strokeStyle,a.ctx.lineWidth=a.lineWidth,a.ctx.stroke()}):"end"===e&&(a.ctx.closePath(),a.step=a.step+1,a.step<a.canvasHistory.length-1&&(a.canvasHistory.length=a.step),a.canvasHistory.push(a.canvas.toDataURL()),a.canvas.onmousemove=null)},createR(t,e,a,s){const n=this;if("begin"===e)console.log("onmousemove"),n.canvas.onmousemove=function(t){n.reset();const e=t.layerX-a,i=t.layerY-s;if(0!==n.step){const t=new Image;t.src=n.canvasHistory[n.step],n.ctx.drawImage(t,0,0)}n.ctx.beginPath(),n.ctx.strokeRect(a,s,e,i),n.ctx.strokeStyle=n.strokeStyle,n.ctx.lineWidth=n.lineWidth,n.ctx.closePath()};else if("end"===e){n.rebroadcast();const e=setInterval(()=>{if(!n.loading)return;clearInterval(e),n.loading=!1;const i=t.layerX-a,o=t.layerY-s;n.ctx.beginPath(),n.ctx.rect(a,s,i,o),n.ctx.strokeStyle=n.strokeStyle,n.ctx.lineWidth=n.lineWidth,n.ctx.closePath(),n.ctx.stroke(),n.step=n.step+1,n.step<n.canvasHistory.length-1&&(n.canvasHistory.length=n.step),n.canvasHistory.push(n.canvas.toDataURL()),n.canvas.onmousemove=null},1)}},drawArrow(t,e){const a=this;if("begin"===e)a.arrowFromX=t.layerX,a.arrowFromY=t.layerY,a.ctx.beginPath(),a.ctx.moveTo(t.layerX,t.layerY);else if("end"===e){const e=t.layerX,a=t.layerY,s=30,n=10,i=this,o=this.arrowFromX,c=this.arrowFromY,l=180*Math.atan2(c-a,o-e)/Math.PI,r=(l+s)*Math.PI/180,d=(l-s)*Math.PI/180,h=n*Math.cos(r),p=n*Math.sin(r),v=n*Math.cos(d),x=n*Math.sin(d);let y=o-h,m=c-p;i.ctx.moveTo(y,m),i.ctx.moveTo(o,c),i.ctx.lineTo(e,a),y=e+h,m=a+p,i.ctx.moveTo(y,m),i.ctx.lineTo(e,a),y=e+v,m=a+x,i.ctx.lineTo(y,m),i.ctx.strokeStyle=i.strokeStyle,i.ctx.lineWidth=i.lineWidth,i.ctx.stroke(),i.ctx.closePath(),i.step=i.step+1,i.step<i.canvasHistory.length-1&&(i.canvasHistory.length=i.step),i.canvasHistory.push(i.canvas.toDataURL()),i.canvas.onmousemove=null}},createT(t,e){const a=this;if("begin"===e);else if("end"===e){let e=0;e=a.fontSize>=28?a.fontSize/2-3:a.fontSize/2-2,a.ctxX=t.layerX+2,a.ctxY=t.layerY+e;const s=this.getPointOnCanvas(t);a.$refs.txt.style.left=s.x+"px",a.$refs.txt.style.top=s.y-a.fontSize/2+"px",a.$refs.txt.value="",a.$refs.txt.style.height=a.fontSize+"px",a.$refs.txt.style.width=a.canvas.width-t.layerX-1+"px",a.$refs.txt.style.fontSize=a.fontSize+"px",a.$refs.txt.style.fontFamily=a.fontFamily,a.$refs.txt.style.color=a.fontColor,a.$refs.txt.style.maxlength=Math.floor((a.canvas.width-t.layerX)/a.fontSize),a.isShow=!0,setTimeout(()=>{a.$refs.txt.focus()})}},txtBlue(){const t=this,e=t.$refs.txt.value;e&&(t.ctx.font=t.$refs.txt.style.fontSize+" "+t.$refs.txt.style.fontFamily,t.ctx.fillStyle=t.$refs.txt.style.color,t.ctx.fillText(e,t.ctxX,t.ctxY),t.step=t.step+1,t.step<t.canvasHistory.length-1&&(t.canvasHistory.length=t.step),t.canvasHistory.push(t.canvas.toDataURL()),t.canvas.onmousemove=null)},getPointOnCanvas(t){const e=this.canvas,a=document.getElementsByClassName("content")[0];return{x:t.layerX+(a.clientWidth-e.width)/2,y:t.layerY}},resetTxt(){const t=this;t.$refs.txt.value="",t.isShow=!1}}},o=i,c=(a("7852"),a("2877")),l=Object(c["a"])(o,s,n,!1,null,"54c58cc1",null);e["default"]=l.exports},"5e0f":function(t,e,a){var s=a("6a52");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var n=a("499e").default;n("2499d2d1",s,!0,{sourceMap:!1,shadowMode:!1})},"6a52":function(t,e,a){var s=a("24fb");e=s(!1),e.push([t.i,"*[data-v-54c58cc1]{box-sizing:border-box}#app[data-v-54c58cc1],body[data-v-54c58cc1],html[data-v-54c58cc1]{overflow:hidden}.draw[data-v-54c58cc1]{height:100%;min-width:420px;display:flex;flex-direction:column}.content[data-v-54c58cc1]{flex-grow:1;height:100%;width:100%}.drawTop[data-v-54c58cc1]{justify-content:flex-start;padding:5px;height:52px}.drawTop[data-v-54c58cc1],.drawTop>div[data-v-54c58cc1]{display:flex;align-items:center}.drawTop>div[data-v-54c58cc1]{padding:5px 5px}div.drawTopContrllor[data-v-54c58cc1]{display:none}@media screen and (max-width:1200px){.drawTop[data-v-54c58cc1]{position:absolute;background-color:#fff;width:100%;flex-direction:column;align-items:flex-start;height:30px;overflow:hidden}.drawTopContrllor[data-v-54c58cc1]{display:flex!important;height:30px;width:100%;justify-content:center;align-items:center;padding:0!important}}",""]),t.exports=e},7852:function(t,e,a){"use strict";a("5e0f")}}]);