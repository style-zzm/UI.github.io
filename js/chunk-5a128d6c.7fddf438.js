(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a128d6c"],{"02d6":function(e,t,i){e.exports=i.p+"img/Group.304e2ba3.png"},"1de5":function(e,t,i){"use strict";e.exports=function(e,t){return t||(t={}),e=e&&e.__esModule?e.default:e,"string"!==typeof e?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},"292a":function(e,t,i){e.exports=i.p+"img/leader.4c52f4c5.png"},"3f2e":function(e,t,i){var r=i("69a1");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=i("499e").default;a("7658fd21",r,!0,{sourceMap:!1,shadowMode:!1})},"69a1":function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".bacground[data-v-5f34950a]{width:100%;height:100%;display:flex;flex-direction:row;justify-content:center;align-items:center;background:linear-gradient(180deg,rgb(0 21 56),#001e50 85.31%)}.bacground .animall[data-v-5f34950a]{top:25%}",""]),e.exports=t},"6b3c":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAqCAYAAADf/ynVAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAl+SURBVHgBrVlLjBxHGf6qX7MzPbtr+YUUEkvxAYsEJZAHiVYC4YBkwY2D1ycQB5QckIgPyZEL16zFmVyCiJDsIHIOBwRIYCniIYFJIBxw5CU43p1dZ3emp3umZ7r4/nr09IztxGunpNnuqamu+ur7v/9RvQqfQnvkHzpZ3Ue3CjA5cQ3ZL9fVFPfZFO6jnSWg6zeRljES35cNgLSL/H4B3hOws1qH1/+AFTIUT0POQTDoAvkUusrtnOMQ02gbxbtnkUEpjQO2AwHTWqtvvY3lEdDOGv3CUtCGbhNkE5yMiQlwuI3sv+sqxwHaXQETQGf+jg4X7Uy56BIBLAJbbP73QIByfDHEtLWMwfunVYH7BSaA1t9BukdAE8dCQWaWeF9wQTFjOyBLFfQdwcmfFBhyfMcBDItPZvCOwM5e1u3oCNJsjLDgwh6YbwaY9HVnpmyaMMU8MHPraBwuQR8uUV5L0cdpNbkrYOJpwwppoilssiETCxlRewZOQMnVA7v5L3xhmuHZaBm/jh/ApscjLPFn9AvKf8kyVoNzDG71kdOnMyx4sGoCipeR6n0k8mxYucWD2ZhBNs/YzjZO5Nt4iao5F0yggxKbkcKFyRouCnuB24BobOjudWg366ciHC19yQjFTeHAAVTi+ivvYHVIhvyi/iEBJ/dLBNcEtVNidecDfF8XeCEYYUWVXK/k+DEUP/LcJpffCNZwyXgpGRNzZo055FZY1IUzv3QcIXiGGGFQ/WBfHxn1EE2GUCONOt4UjjEZH40QyPcPKyz3tvG8HuEFAlkRMGpsmEJEUMHYgIP0yz1Z3OR2f9R/Fm81dSYa6xTznu3XMtoke8HRPtRxfls9Bp3i1iZsRQR1hSr430f4TQW8rBWWcRs9yFW5L5rbUhUeCvbx2qG38KvuZTwooIQl+d2btp5jqbF+Fzry9zHZSo87+2dWW2LKPw2x1h/hx6jwqAyutMgEJpTzo3mjHA6Dxd3oQJkxOuA89Lu19lX8+eGruJSdwIZ+AptZaMEIc52IGixmEqLSVCR7Hw+hE06ULLAlkXBX480ooFkUxNA1IRaO/a5n/Z4+/1eeki/KDJjiXPo+e57AeWEnJaiA4AYy06QRIcaOMQE11hYcFht7JokBpgIyqEsHS88NgfuuddXo1oZFTGP7ianjcGKl4+Pctg8Svk86D4tGMzuvgMrm8oyLU85GMnG+Sgc5BC8A5gULUc9gKkedMaNsaHSYm+5a9rg5xGT/aCOlSSzz69VhZJfAEud9Yz0vRoHfEn1QpNyl8TI1sjFpcBx6vMzFQwNcBY60wIErO5TJA1ycmp3Etj/kyNAO0BJC6sywsKZxADJWi5+ZK0hT6N2+AagkPExplii3u6eHKRE+ncCWNVywOmwYU+FHvOeYssXnjpNdMhVTOLLpWJwoMBrUWrul2paENLdW0m5j4qmZu4+4cy3pVBgTbxKWJHkd4XULBpj1vMqKXEAacNpOOGpbILLoaJXj6THJ0AKKXPSohWutYrNBbksk+Vm8shfR4ekMnskoYRwrOUPcmTelpznJTQgwU2oLyIAS9kToAlrTRPlRgogoPzIoHyLSSjX9wupM/rZ9sg+tVzKXotNqBFxqLCKo0ABwk5TO1gVNerWHh6KhmdnEJwcObt9iWsNCIOFihXO0rMBhCTTDKsuS8qFDWkhT7ueWnWqCoKKEth17Blxi2LZNTFkO7Q9idxPxC/Op9VVfnUkNY05zQaM2UHBRTmwdOEA2dJj+aaOEylvUlUnIdXVkTenjl/k0XMVchjb2oA7r1pwuVpmrWakyVQJmUjKeaDhymcEDFtEZbYmDVi5UpDbBz8XQqBlUBfmoctSzxVZj1i7CVgUfVJTrs2MrE1JUbUMHTlkJWK2p2e8CKLAeWOfMFA2NSeT3jMmVyKXCkBiiC46KS+OVta60nrFXC9+nnInRUyM3oXZB7f1R2Z+NyQiuzzU6qQsZ9EymJZ1JkpfYt5iOJtsMF9SF1PVHHsVmEuLFuMC1ODdm1e4KuUZDdz80JQ68vH1WV6oGahhjQP5jdRKvmHLcgW8wZgFLfbbrAqwHZaJ/aisMM+oGy6GvsCLIcKn6LV5iHbbORHxCN6hw5hSNKSf52pwOpKLgLgdH8crKc7g8IVOlOyOI+cRpplJd0AmGDDeS2LNm5PesNVOFuHXk7X8aG+O/4lLyAeR887I4QmVNbEgxjGkLzjPFn6+1VnH+wa/jsszXmxrng0R+iWU9d7RjySPVhXFis/bApDnb0gBB1vRINjmeLeWz5D5dw7Wt53Bh8Bk8TY1dNJUqy2oB1YzwZGy/neDFrz2DL596yoKSA40/j/oA23b1f7OlI3PA0TWwspHEm5Vs87hoandOtPUINq98A+d3juFpviZ4o2G2/STCxpOn8ORXH8fFkcuJoTstRaKngd24sGZSUjq/Hlr2magpfElLEmTlqIYek69M2HX08k818iqy7b3PY7Nb4oef/Sc2kgHOrR3Gq6ci7LsKRk28VmnTgRxvwxlTOb+3mVuzG2gcQl3bdV7p7efvJZHLYDHlJJ/pLqc747hjZ2JLl0EM9d5j2MxjbHhQc83VdcKWfPgmCP5Y50/v9QGFTmDChRSKX/w9ejTRuMnn1sL50ZtXInSw586Ho9mGyFrNYiylTnv2jL+KvsQjm68SBGDgDidSMOYjcnuDM34T/WjdHjBvPq91vPxvrI5C1mWYP1oVjTqpkkA4sqtlzlQDKV0wQ1F6lh3VzblCBzofWJM2Dr6DwbeZBOWV1XfrohN4VanywinVa2+hHySoM1+0sPshTSgxpzO2i6dOUL4lQeMA23jeN2Fu6oBL2xsj3xqhd+OMmnuPFmGh/WTNvIXJv3dVL/V76E6mdKpwtrboQOjLaL7MepC6U5l8u+akoXQHZXUd2e46j8y3aRHu0H72sHmPVXznbzp9dxdtrhPesri81pSzQEIG4wWmqLW93Hj4nNMlHYz7LWRXnlIlPqZF+IT2+uOk+A1dPNNliV6YwF2XKvISM5P90qzHDs0/J/k2taypPf5hYTjtL2PvL1/6eEB3Dcw0OsjbnJsAs5MRutRZq10xU7iYlsbGnNYbF96j7ewz7bQw+N1pNcQB2t0BawD8D/XKnBMkv2Di6KEt3RlNmTlvFHBydXVd9uYahuoeXg4fDJhvSlW7wuBPdU4HX6FnRr4iGfTp6iGynz/GV0kE9Drurd3T6/Rb2mt66XMtdM+cxPjDT+kfEP8HaRb4iXPLfBEAAAAASUVORK5CYII="},"704c":function(e,t,i){e.exports=i.p+"img/diceng.d88ccc70.png"},"7fed":function(e,t,i){var r=r||{},a=a||{},o=o||{REVISION:"55"};a.console=a.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},a.Int32Array=a.Int32Array||Array,a.Float32Array=a.Float32Array||Array,String.prototype.startsWith=String.prototype.startsWith||function(e){return this.slice(0,e.length)===e},String.prototype.endsWith=String.prototype.endsWith||function(e){var t=String(e),i=this.lastIndexOf(t);return(-1<i&&i)===this.length-t.length},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!r.requestAnimationFrame;++i)r.requestAnimationFrame=r[t[i]+"RequestAnimationFrame"],r.cancelAnimationFrame=r[t[i]+"CancelAnimationFrame"]||r[t[i]+"CancelRequestAnimationFrame"];void 0===r.requestAnimationFrame&&(r.requestAnimationFrame=function(t,i){var a=Date.now(),o=Math.max(0,16-(a-e)),n=r.setTimeout((function(){t(a+o)}),o);return e=a+o,n}),r.cancelAnimationFrame=r.cancelAnimationFrame||function(e){r.clearTimeout(e)}}(),o.CullFaceNone=0,o.CullFaceBack=1,o.CullFaceFront=2,o.CullFaceFrontBack=3,o.FrontFaceDirectionCW=0,o.FrontFaceDirectionCCW=1,o.BasicShadowMap=0,o.PCFShadowMap=1,o.PCFSoftShadowMap=2,o.FrontSide=0,o.BackSide=1,o.DoubleSide=2,o.NoShading=0,o.FlatShading=1,o.SmoothShading=2,o.NoColors=0,o.FaceColors=1,o.VertexColors=2,o.NoBlending=0,o.NormalBlending=1,o.AdditiveBlending=2,o.SubtractiveBlending=3,o.MultiplyBlending=4,o.CustomBlending=5,o.AddEquation=100,o.SubtractEquation=101,o.ReverseSubtractEquation=102,o.ZeroFactor=200,o.OneFactor=201,o.SrcColorFactor=202,o.OneMinusSrcColorFactor=203,o.SrcAlphaFactor=204,o.OneMinusSrcAlphaFactor=205,o.DstAlphaFactor=206,o.OneMinusDstAlphaFactor=207,o.DstColorFactor=208,o.OneMinusDstColorFactor=209,o.SrcAlphaSaturateFactor=210,o.MultiplyOperation=0,o.MixOperation=1,o.AddOperation=2,o.UVMapping=function(){},o.CubeReflectionMapping=function(){},o.CubeRefractionMapping=function(){},o.SphericalReflectionMapping=function(){},o.SphericalRefractionMapping=function(){},o.RepeatWrapping=1e3,o.ClampToEdgeWrapping=1001,o.MirroredRepeatWrapping=1002,o.NearestFilter=1003,o.NearestMipMapNearestFilter=1004,o.NearestMipMapLinearFilter=1005,o.LinearFilter=1006,o.LinearMipMapNearestFilter=1007,o.LinearMipMapLinearFilter=1008,o.UnsignedByteType=1009,o.ByteType=1010,o.ShortType=1011,o.UnsignedShortType=1012,o.IntType=1013,o.UnsignedIntType=1014,o.FloatType=1015,o.UnsignedShort4444Type=1016,o.UnsignedShort5551Type=1017,o.UnsignedShort565Type=1018,o.AlphaFormat=1019,o.RGBFormat=1020,o.RGBAFormat=1021,o.LuminanceFormat=1022,o.LuminanceAlphaFormat=1023,o.RGB_S3TC_DXT1_Format=2001,o.RGBA_S3TC_DXT1_Format=2002,o.RGBA_S3TC_DXT3_Format=2003,o.RGBA_S3TC_DXT5_Format=2004,o.Color=function(e){return void 0!==e&&this.set(e),this},o.Color.prototype={constructor:o.Color,r:1,g:1,b:1,set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e);break}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSV:function(e,t,i){var r,a,o,n,s;return 0===i?this.r=this.g=this.b=0:(r=Math.floor(6*e),a=6*e-r,o=i*(1-t),n=i*(1-t*a),s=i*(1-t*(1-a)),0===r?(this.r=i,this.g=s,this.b=o):1===r?(this.r=n,this.g=i,this.b=o):2===r?(this.r=o,this.g=i,this.b=s):3===r?(this.r=o,this.g=n,this.b=i):4===r?(this.r=s,this.g=o,this.b=i):5===r&&(this.r=i,this.g=o,this.b=n)),this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(o.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},getHSV:function(e){var t,i,r=this.r,a=this.g,o=this.b,n=Math.max(Math.max(r,a),o),s=Math.min(Math.min(r,a),o),l=n;if(s===n)t=0,i=0;else{var h=n-s;i=h/n,t=r===n?(a-o)/h:a===n?2+(o-r)/h:4+(r-a)/h,t/=6,t<0&&(t+=1),t>1&&(t-=1)}return void 0===e&&(e={h:0,s:0,v:0}),e.h=t,e.s=i,e.v=l,e},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new o.Color).setRGB(this.r,this.g,this.b)}},o.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},o.Quaternion=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},o.Quaternion.prototype={constructor:o.Quaternion,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var i=Math.cos(e.x/2),r=Math.cos(e.y/2),a=Math.cos(e.z/2),o=Math.sin(e.x/2),n=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*r*a+i*n*s,this.y=i*n*a-o*r*s,this.z=i*r*s+o*n*a,this.w=i*r*a-o*n*s):"YXZ"===t?(this.x=o*r*a+i*n*s,this.y=i*n*a-o*r*s,this.z=i*r*s-o*n*a,this.w=i*r*a+o*n*s):"ZXY"===t?(this.x=o*r*a-i*n*s,this.y=i*n*a+o*r*s,this.z=i*r*s+o*n*a,this.w=i*r*a-o*n*s):"ZYX"===t?(this.x=o*r*a-i*n*s,this.y=i*n*a+o*r*s,this.z=i*r*s-o*n*a,this.w=i*r*a+o*n*s):"YZX"===t?(this.x=o*r*a+i*n*s,this.y=i*n*a+o*r*s,this.z=i*r*s-o*n*a,this.w=i*r*a-o*n*s):"XZY"===t&&(this.x=o*r*a-i*n*s,this.y=i*n*a-o*r*s,this.z=i*r*s+o*n*a,this.w=i*r*a+o*n*s),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],a=i[4],o=i[8],n=i[1],s=i[5],l=i[9],h=i[2],c=i[6],p=i[10],u=r+s+p;return u>0?(t=.5/Math.sqrt(u+1),this.w=.25/t,this.x=(c-l)*t,this.y=(o-h)*t,this.z=(n-a)*t):r>s&&r>p?(t=2*Math.sqrt(1+r-s-p),this.w=(c-l)/t,this.x=.25*t,this.y=(a+n)/t,this.z=(o+h)/t):s>p?(t=2*Math.sqrt(1+s-r-p),this.w=(o-h)/t,this.x=(a+n)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+p-r-s),this.w=(n-a)/t,this.x=(o+h)/t,this.y=(l+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,a=e.z,o=e.w,n=t.x,s=t.y,l=t.z,h=t.w;return this.x=i*h+o*n+r*l-a*s,this.y=r*h+o*s+a*n-i*l,this.z=a*h+o*l+i*s-r*n,this.w=o*h-i*n-r*s-a*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this.x,r=this.y,a=this.z,o=this.w,n=o*e.w+i*e.x+r*e.y+a*e.z;if(n<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,n=-n):this.copy(e),n>=1)return this.w=o,this.x=i,this.y=r,this.z=a,this;var s=Math.acos(n),l=Math.sqrt(1-n*n);if(Math.abs(l)<.001)return this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(a+this.z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=o*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=a*h+this.z*c,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new o.Quaternion(this.x,this.y,this.z,this.w)}},o.Quaternion.slerp=function(e,t,i,r){return i.copy(e).slerp(t,r)},o.Vector2=function(e,t){this.x=e||0,this.y=t||0},o.Vector2.prototype={constructor:o.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},clone:function(){return new o.Vector2(this.x,this.y)}},o.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},o.Vector3.prototype={constructor:o.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6]*r,this.y=a[1]*t+a[4]*i+a[7]*r,this.z=a[2]*t+a[5]*i+a[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12],this.y=a[1]*t+a[5]*i+a[9]*r+a[13],this.z=a[2]*t+a[6]*i+a[10]*r+a[14],this},applyProjection:function(e){var t=this.x,i=this.y,r=this.z,a=e.elements,o=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*o,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*o,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,a=e.x,o=e.y,n=e.z,s=e.w,l=s*t+o*r-n*i,h=s*i+n*t-a*r,c=s*r+a*i-o*t,p=-a*t-o*i-n*r;return this.x=l*s+p*-a+h*-n-c*-o,this.y=h*s+p*-o+c*-a-l*-n,this.z=c*s+p*-n+l*-o-h*-a,this},applyEuler:function(e,t){var i=o.Vector3.__q1.setFromEuler(e,t);return this.applyQuaternion(i),this},applyAxisAngle:function(e,t){var i=o.Vector3.__q1.setFromAxisAngle(e,t);return this.applyQuaternion(i),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,r=this.y,a=this.z;return this.x=r*e.z-a*e.y,this.y=a*e.x-i*e.z,this.z=i*e.y-r*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},angleTo:function(e){return Math.acos(this.dot(e)/this.length()/e.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,a=r[0],o=r[4],n=r[8],s=r[1],l=r[5],h=r[9],c=r[2],p=r[6],u=r[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(i(n)),Math.abs(n)<.99999?(this.x=Math.atan2(-h,u),this.z=Math.atan2(-o,a)):(this.x=Math.atan2(p,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-i(h)),Math.abs(h)<.99999?(this.y=Math.atan2(n,u),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-c,a),this.z=0)):"ZXY"===t?(this.x=Math.asin(i(p)),Math.abs(p)<.99999?(this.y=Math.atan2(-c,u),this.z=Math.atan2(-o,l)):(this.y=0,this.z=Math.atan2(s,a))):"ZYX"===t?(this.y=Math.asin(-i(c)),Math.abs(c)<.99999?(this.x=Math.atan2(p,u),this.z=Math.atan2(s,a)):(this.x=0,this.z=Math.atan2(-o,l))):"YZX"===t?(this.z=Math.asin(i(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-h,l),this.y=Math.atan2(-c,a)):(this.x=0,this.y=Math.atan2(n,u))):"XZY"===t&&(this.z=Math.asin(-i(o)),Math.abs(o)<.99999?(this.x=Math.atan2(p,l),this.y=Math.atan2(n,a)):(this.x=Math.atan2(-h,u),this.y=0)),this},setEulerFromQuaternion:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,a=e.y*e.y,o=e.z*e.z,n=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),n-r-a+o),this.y=Math.asin(i(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),n+r-a-o)):"YXZ"===t?(this.x=Math.asin(i(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),n-r-a+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),n-r+a-o)):"ZXY"===t?(this.x=Math.asin(i(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),n-r-a+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),n-r+a-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),n-r-a+o),this.y=Math.asin(i(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),n+r-a-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),n-r+a-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),n+r-a-o),this.z=Math.asin(i(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),n-r+a-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),n+r-a-o),this.z=Math.asin(i(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=r,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},clone:function(){return new o.Vector3(this.x,this.y,this.z)}},o.Vector3.__q1=new o.Quaternion,o.Vector4=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1},o.Vector4.prototype={constructor:o.Vector4,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,a=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*a,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*a,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*a,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*a,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new o.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,a,o=.01,n=.1,s=e.elements,l=s[0],h=s[4],c=s[8],p=s[1],u=s[5],f=s[9],d=s[2],m=s[6],g=s[10];if(Math.abs(h-p)<o&&Math.abs(c-d)<o&&Math.abs(f-m)<o){if(Math.abs(h+p)<n&&Math.abs(c+d)<n&&Math.abs(f+m)<n&&Math.abs(l+u+g-3)<n)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(u+1)/2,x=(g+1)/2,_=(h+p)/4,w=(c+d)/4,b=(f+m)/4;return v>y&&v>x?v<o?(i=0,r=.707106781,a=.707106781):(i=Math.sqrt(v),r=_/i,a=w/i):y>x?y<o?(i=.707106781,r=0,a=.707106781):(r=Math.sqrt(y),i=_/r,a=b/r):x<o?(i=.707106781,r=.707106781,a=0):(a=Math.sqrt(x),i=w/a,r=b/a),this.set(i,r,a,t),this}var S=Math.sqrt((m-f)*(m-f)+(c-d)*(c-d)+(p-h)*(p-h));return Math.abs(S)<.001&&(S=1),this.x=(m-f)/S,this.y=(c-d)/S,this.z=(p-h)/S,this.w=Math.acos((l+u+g-1)/2),this}},o.Box2=function(e,t){this.min=void 0!==e?e:new o.Vector2(1/0,1/0),this.max=void 0!==t?t:new o.Vector2(-1/0,-1/0)},o.Box2.prototype={constructor:o.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(e,t){var i=o.Box2.__v1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new o.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new o.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e){return new o.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){var i=t||new o.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=o.Box2.__v1.copy(e).clamp(this.min,this.max);return t.sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new o.Box2).copy(this)}},o.Box2.__v1=new o.Vector2,o.Box3=function(e,t){this.min=void 0!==e?e:new o.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new o.Vector3(-1/0,-1/0,-1/0)},o.Box3.prototype={constructor:o.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(e,t){var i=o.Box3.__v1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new o.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new o.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e){return new o.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){t||new o.Vector3;return(new o.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=o.Box3.__v1.copy(e).clamp(this.min,this.max);return t.sub(e).length()},getBoundingSphere:function(e){var t=e||new o.Sphere;return t.center=this.center(),t.radius=.5*this.size(o.Box3.__v0).length(),t},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},transform:function(e){var t=[o.Box3.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),o.Box3.__v0.set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),o.Box3.__v1.set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),o.Box3.__v2.set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),o.Box3.__v3.set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),o.Box3.__v4.set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),o.Box3.__v5.set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),o.Box3.__v6.set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),o.Box3.__v7.set(this.max.x,this.max.y,this.max.z).applyMatrix4(e)];return this.makeEmpty(),this.setFromPoints(t),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new o.Box3).copy(this)}},o.Box3.__v0=new o.Vector3,o.Box3.__v1=new o.Vector3,o.Box3.__v2=new o.Vector3,o.Box3.__v3=new o.Vector3,o.Box3.__v4=new o.Vector3,o.Box3.__v5=new o.Vector3,o.Box3.__v6=new o.Vector3,o.Box3.__v7=new o.Vector3,o.Matrix3=function(e,t,i,r,a,o,n,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,r||0,void 0!==a?a:1,o||0,n||0,s||0,void 0!==l?l:1)},o.Matrix3.prototype={constructor:o.Matrix3,set:function(e,t,i,r,a,o,n,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=r,h[4]=a,h[7]=o,h[2]=n,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){for(var t=o.Matrix3.__v1,i=0,r=e.length;i<r;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyMatrix3(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],o=e[4],n=e[5],s=e[6],l=e[7],h=e[8];return t*o*h-t*n*l-i*a*h+i*n*s+r*a*l-r*o*s},getInverse:function(e,t){var i=e.elements,r=this.elements;r[0]=i[10]*i[5]-i[6]*i[9],r[1]=-i[10]*i[1]+i[2]*i[9],r[2]=i[6]*i[1]-i[2]*i[5],r[3]=-i[10]*i[4]+i[6]*i[8],r[4]=i[10]*i[0]-i[2]*i[8],r[5]=-i[6]*i[0]+i[2]*i[4],r[6]=i[9]*i[4]-i[5]*i[8],r[7]=-i[9]*i[0]+i[1]*i[8],r[8]=i[5]*i[0]-i[1]*i[4];var a=i[0]*r[0]+i[1]*r[3]+i[2]*r[6];if(0===a){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/a),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new o.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},o.Matrix3.__v1=new o.Vector3,o.Matrix4=function(e,t,i,r,a,o,n,s,l,h,c,p,u,f,d,m){this.elements=new Float32Array(16),this.set(void 0!==e?e:1,t||0,i||0,r||0,a||0,void 0!==o?o:1,n||0,s||0,l||0,h||0,void 0!==c?c:1,p||0,u||0,f||0,d||0,void 0!==m?m:1)},o.Matrix4.prototype={constructor:o.Matrix4,set:function(e,t,i,r,a,o,n,s,l,h,c,p,u,f,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=r,g[1]=a,g[5]=o,g[9]=n,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=p,g[3]=u,g[7]=f,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,t){var i=this.elements,r=e.x,a=e.y,o=e.z,n=Math.cos(r),s=Math.sin(r),l=Math.cos(a),h=Math.sin(a),c=Math.cos(o),p=Math.sin(o);if(void 0===t||"XYZ"===t){var u=n*c,f=n*p,d=s*c,m=s*p;i[0]=l*c,i[4]=-l*p,i[8]=h,i[1]=f+d*h,i[5]=u-m*h,i[9]=-s*l,i[2]=m-u*h,i[6]=d+f*h,i[10]=n*l}else if("YXZ"===t){var g=l*c,v=l*p,y=h*c,x=h*p;i[0]=g+x*s,i[4]=y*s-v,i[8]=n*h,i[1]=n*p,i[5]=n*c,i[9]=-s,i[2]=v*s-y,i[6]=x+g*s,i[10]=n*l}else if("ZXY"===t){g=l*c,v=l*p,y=h*c,x=h*p;i[0]=g-x*s,i[4]=-n*p,i[8]=y+v*s,i[1]=v+y*s,i[5]=n*c,i[9]=x-g*s,i[2]=-n*h,i[6]=s,i[10]=n*l}else if("ZYX"===t){u=n*c,f=n*p,d=s*c,m=s*p;i[0]=l*c,i[4]=d*h-f,i[8]=u*h+m,i[1]=l*p,i[5]=m*h+u,i[9]=f*h-d,i[2]=-h,i[6]=s*l,i[10]=n*l}else if("YZX"===t){var _=n*l,w=n*h,b=s*l,S=s*h;i[0]=l*c,i[4]=S-_*p,i[8]=b*p+w,i[1]=p,i[5]=n*c,i[9]=-s*c,i[2]=-h*c,i[6]=w*p+b,i[10]=_-S*p}else if("XZY"===t){_=n*l,w=n*h,b=s*l,S=s*h;i[0]=l*c,i[4]=-p,i[8]=h*c,i[1]=_*p+S,i[5]=n*c,i[9]=w*p-b,i[2]=b*p-w,i[6]=s*c,i[10]=S*p+_}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z,o=e.w,n=i+i,s=r+r,l=a+a,h=i*n,c=i*s,p=i*l,u=r*s,f=r*l,d=a*l,m=o*n,g=o*s,v=o*l;return t[0]=1-(u+d),t[4]=c-v,t[8]=p+g,t[1]=c+v,t[5]=1-(h+d),t[9]=f-m,t[2]=p-g,t[6]=f+m,t[10]=1-(h+u),this},lookAt:function(e,t,i){var r=this.elements,a=o.Matrix4.__v1,n=o.Matrix4.__v2,s=o.Matrix4.__v3;return s.subVectors(e,t).normalize(),0===s.length()&&(s.z=1),a.crossVectors(i,s).normalize(),0===a.length()&&(s.x+=1e-4,a.crossVectors(i,s).normalize()),n.crossVectors(s,a),r[0]=a.x,r[4]=n.x,r[8]=s.x,r[1]=a.y,r[5]=n.y,r[9]=s.y,r[2]=a.z,r[6]=n.z,r[10]=s.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,a=this.elements,o=i[0],n=i[4],s=i[8],l=i[12],h=i[1],c=i[5],p=i[9],u=i[13],f=i[2],d=i[6],m=i[10],g=i[14],v=i[3],y=i[7],x=i[11],_=i[15],w=r[0],b=r[4],S=r[8],M=r[12],A=r[1],T=r[5],C=r[9],E=r[13],P=r[2],L=r[6],R=r[10],D=r[14],F=r[3],U=r[7],z=r[11],V=r[15];return a[0]=o*w+n*A+s*P+l*F,a[4]=o*b+n*T+s*L+l*U,a[8]=o*S+n*C+s*R+l*z,a[12]=o*M+n*E+s*D+l*V,a[1]=h*w+c*A+p*P+u*F,a[5]=h*b+c*T+p*L+u*U,a[9]=h*S+c*C+p*R+u*z,a[13]=h*M+c*E+p*D+u*V,a[2]=f*w+d*A+m*P+g*F,a[6]=f*b+d*T+m*L+g*U,a[10]=f*S+d*C+m*R+g*z,a[14]=f*M+d*E+m*D+g*V,a[3]=v*w+y*A+x*P+_*F,a[7]=v*b+y*T+x*L+_*U,a[11]=v*S+y*C+x*R+_*z,a[15]=v*M+y*E+x*D+_*V,this},multiplyToArray:function(e,t,i){var r=this.elements;return this.multiplyMatrices(e,t),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){for(var t=o.Matrix4.__v1,i=0,r=e.length;i<r;i+=3)t.x=e[i],t.y=e[i+1],t.z=e[i+2],t.applyProjection(this),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z;return e},rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return e.x=i*t[0]+r*t[4]+a*t[8],e.y=i*t[1]+r*t[5]+a*t[9],e.z=i*t[2]+r*t[6]+a*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,i=new o.Vector4;return i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],a=e[12],o=e[1],n=e[5],s=e[9],l=e[13],h=e[2],c=e[6],p=e[10],u=e[14],f=e[3],d=e[7],m=e[11],g=e[15];return f*(+a*s*c-r*l*c-a*n*p+i*l*p+r*n*u-i*s*u)+d*(+t*s*u-t*l*p+a*o*p-r*o*u+r*l*h-a*s*h)+m*(+t*l*c-t*n*u-a*o*c+i*o*u+a*n*h-i*l*h)+g*(-r*n*h-t*s*c+t*n*p+r*o*c-i*o*p+i*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=this.elements;return o.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getColumnX:function(){var e=this.elements;return o.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return o.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return o.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e,t){var i=this.elements,r=e.elements,a=r[0],o=r[4],n=r[8],s=r[12],l=r[1],h=r[5],c=r[9],p=r[13],u=r[2],f=r[6],d=r[10],m=r[14],g=r[3],v=r[7],y=r[11],x=r[15];i[0]=c*m*v-p*d*v+p*f*y-h*m*y-c*f*x+h*d*x,i[4]=s*d*v-n*m*v-s*f*y+o*m*y+n*f*x-o*d*x,i[8]=n*p*v-s*c*v+s*h*y-o*p*y-n*h*x+o*c*x,i[12]=s*c*f-n*p*f-s*h*d+o*p*d+n*h*m-o*c*m,i[1]=p*d*g-c*m*g-p*u*y+l*m*y+c*u*x-l*d*x,i[5]=n*m*g-s*d*g+s*u*y-a*m*y-n*u*x+a*d*x,i[9]=s*c*g-n*p*g-s*l*y+a*p*y+n*l*x-a*c*x,i[13]=n*p*u-s*c*u+s*l*d-a*p*d-n*l*m+a*c*m,i[2]=h*m*g-p*f*g+p*u*v-l*m*v-h*u*x+l*f*x,i[6]=s*f*g-o*m*g-s*u*v+a*m*v+o*u*x-a*f*x,i[10]=o*p*g-s*h*g+s*l*v-a*p*v-o*l*x+a*h*x,i[14]=s*h*u-o*p*u-s*l*f+a*p*f+o*l*m-a*h*m,i[3]=c*f*g-h*d*g-c*u*v+l*d*v+h*u*y-l*f*y,i[7]=o*d*g-n*f*g+n*u*v-a*d*v-o*u*y+a*f*y,i[11]=n*h*g-o*c*g-n*l*v+a*c*v+o*l*y-a*h*y,i[15]=o*c*u-n*h*u+n*l*f-a*c*f-o*l*d+a*h*d;var _=r[0]*i[0]+r[1]*i[4]+r[2]*i[8]+r[3]*i[12];if(0==_){var w="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(w);return console.warn(w),this.identity(),this}return this.multiplyScalar(1/_),this},compose:function(e,t,i){var r=this.elements,a=o.Matrix4.__m1,n=o.Matrix4.__m2;return a.identity(),a.setRotationFromQuaternion(t),n.makeScale(i.x,i.y,i.z),this.multiplyMatrices(a,n),r[12]=e.x,r[13]=e.y,r[14]=e.z,this},decompose:function(e,t,i){var r=this.elements,a=o.Matrix4.__v1,n=o.Matrix4.__v2,s=o.Matrix4.__v3;a.set(r[0],r[1],r[2]),n.set(r[4],r[5],r[6]),s.set(r[8],r[9],r[10]),e=e instanceof o.Vector3?e:new o.Vector3,t=t instanceof o.Quaternion?t:new o.Quaternion,i=i instanceof o.Vector3?i:new o.Vector3,i.x=a.length(),i.y=n.length(),i.z=s.length(),e.x=r[12],e.y=r[13],e.z=r[14];var l=o.Matrix4.__m1;return l.copy(this),l.elements[0]/=i.x,l.elements[1]/=i.x,l.elements[2]/=i.x,l.elements[4]/=i.y,l.elements[5]/=i.y,l.elements[6]/=i.y,l.elements[8]/=i.z,l.elements[9]/=i.z,l.elements[10]/=i.z,t.setFromRotationMatrix(l),[e,t,i]},extractPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(e){var t=this.elements,i=e.elements,r=o.Matrix4.__v1,a=1/r.set(i[0],i[1],i[2]).length(),n=1/r.set(i[4],i[5],i[6]).length(),s=1/r.set(i[8],i[9],i[10]).length();return t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*s,t[9]=i[9]*s,t[10]=i[10]*s,this},translate:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return t[12]=t[0]*i+t[4]*r+t[8]*a+t[12],t[13]=t[1]*i+t[5]*r+t[9]*a+t[13],t[14]=t[2]*i+t[6]*r+t[10]*a+t[14],t[15]=t[3]*i+t[7]*r+t[11]*a+t[15],this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],a=t[6],o=t[7],n=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),p=Math.sin(e);return t[4]=c*i+p*n,t[5]=c*r+p*s,t[6]=c*a+p*l,t[7]=c*o+p*h,t[8]=c*n-p*i,t[9]=c*s-p*r,t[10]=c*l-p*a,t[11]=c*h-p*o,this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],o=t[3],n=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),p=Math.sin(e);return t[0]=c*i-p*n,t[1]=c*r-p*s,t[2]=c*a-p*l,t[3]=c*o-p*h,t[8]=c*n+p*i,t[9]=c*s+p*r,t[10]=c*l+p*a,t[11]=c*h+p*o,this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],a=t[2],o=t[3],n=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),p=Math.sin(e);return t[0]=c*i+p*n,t[1]=c*r+p*s,t[2]=c*a+p*l,t[3]=c*o+p*h,t[4]=c*n-p*i,t[5]=c*s-p*r,t[6]=c*l-p*a,t[7]=c*h-p*o,this},rotateByAxis:function(e,t){var i=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var r=e.x,a=e.y,o=e.z,n=Math.sqrt(r*r+a*a+o*o);r/=n,a/=n,o/=n;var s=r*r,l=a*a,h=o*o,c=Math.cos(t),p=Math.sin(t),u=1-c,f=r*a*u,d=r*o*u,m=a*o*u,g=r*p,v=a*p,y=o*p,x=s+(1-s)*c,_=f+y,w=d-v,b=f-y,S=l+(1-l)*c,M=m+g,A=d+v,T=m-g,C=h+(1-h)*c,E=i[0],P=i[1],L=i[2],R=i[3],D=i[4],F=i[5],U=i[6],z=i[7],V=i[8],B=i[9],N=i[10],O=i[11];i[12],i[13],i[14],i[15];return i[0]=x*E+_*D+w*V,i[1]=x*P+_*F+w*B,i[2]=x*L+_*U+w*N,i[3]=x*R+_*z+w*O,i[4]=b*E+S*D+M*V,i[5]=b*P+S*F+M*B,i[6]=b*L+S*U+M*N,i[7]=b*R+S*z+M*O,i[8]=A*E+T*D+C*V,i[9]=A*P+T*F+C*B,i[10]=A*L+T*U+C*N,i[11]=A*R+T*z+C*O,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,a=e.z;return t[0]*=i,t[4]*=r,t[8]*=a,t[1]*=i,t[5]*=r,t[9]*=a,t[2]*=i,t[6]*=r,t[10]*=a,t[3]*=i,t[7]*=r,t[11]*=a,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,r)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),a=1-i,o=e.x,n=e.y,s=e.z,l=a*o,h=a*n;return this.set(l*o+i,l*n-r*s,l*s+r*n,0,l*n+r*s,h*n+i,h*s-r*o,0,l*s-r*n,h*s+r*o,a*s*s+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeFrustum:function(e,t,i,r,a,o){var n=this.elements,s=2*a/(t-e),l=2*a/(r-i),h=(t+e)/(t-e),c=(r+i)/(r-i),p=-(o+a)/(o-a),u=-2*o*a/(o-a);return n[0]=s,n[4]=0,n[8]=h,n[12]=0,n[1]=0,n[5]=l,n[9]=c,n[13]=0,n[2]=0,n[6]=0,n[10]=p,n[14]=u,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this},makePerspective:function(e,t,i,r){var a=i*Math.tan(o.Math.degToRad(.5*e)),n=-a,s=n*t,l=a*t;return this.makeFrustum(s,l,n,a,i,r)},makeOrthographic:function(e,t,i,r,a,o){var n=this.elements,s=t-e,l=i-r,h=o-a,c=(t+e)/s,p=(i+r)/l,u=(o+a)/h;return n[0]=2/s,n[4]=0,n[8]=0,n[12]=-c,n[1]=0,n[5]=2/l,n[9]=0,n[13]=-p,n[2]=0,n[6]=0,n[10]=-2/h,n[14]=-u,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this},clone:function(){var e=this.elements;return new o.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},o.Matrix4.__v1=new o.Vector3,o.Matrix4.__v2=new o.Vector3,o.Matrix4.__v3=new o.Vector3,o.Matrix4.__m1=new o.Matrix4,o.Matrix4.__m2=new o.Matrix4,o.Ray=function(e,t){this.origin=void 0!==e?e:new o.Vector3,this.direction=void 0!==t?t:new o.Vector3},o.Ray.prototype={constructor:o.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var i=t||new o.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(e){return this.origin.copy(this.at(e,o.Ray.__v1)),this},closestPointToPoint:function(e,t){var i=t||new o.Vector3;i.subVectors(e,this.origin);var r=i.dot(this.direction);return i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){var t=o.Ray.__v1.subVectors(e,this.origin).dot(this.direction);return o.Ray.__v1.copy(this.direction).multiplyScalar(t).add(this.origin),o.Ray.__v1.distanceTo(e)},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);return 0!=t||0==e.distanceToPoint(this.origin)},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:void 0;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i},intersectPlane:function(e,t){var i=this.distanceToPlane(e);if(void 0!==i)return this.at(i,t)},transform:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new o.Ray).copy(this)}},o.Ray.__v1=new o.Vector3,o.Ray.__v2=new o.Vector3,o.Sphere=function(e,t){this.center=void 0!==e?e:new o.Vector3,this.radius=void 0!==t?t:0},o.Sphere.prototype={constructor:o.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var i=0,r=0,a=t.length;r<a;r++){var o=e.distanceToSquared(t[r]);i=Math.max(i,o)}return this.center=e,this.radius=Math.sqrt(i),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new o.Vector3;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new o.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},transform:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new o.Sphere).copy(this)}},o.Frustum=function(e,t,i,r,a,n){this.planes=[void 0!==e?e:new o.Plane,void 0!==t?t:new o.Plane,void 0!==i?i:new o.Plane,void 0!==r?r:new o.Plane,void 0!==a?a:new o.Plane,void 0!==n?n:new o.Plane]},o.Frustum.prototype={set:function(e,t,i,r,a,o){var n=this.planes;return n[0].copy(e),n[1].copy(t),n[2].copy(i),n[3].copy(r),n[4].copy(a),n[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],a=i[1],o=i[2],n=i[3],s=i[4],l=i[5],h=i[6],c=i[7],p=i[8],u=i[9],f=i[10],d=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(n-r,c-s,d-p,y-m).normalize(),t[1].setComponents(n+r,c+s,d+p,y+m).normalize(),t[2].setComponents(n+a,c+l,d+u,y+g).normalize(),t[3].setComponents(n-a,c-l,d-u,y-g).normalize(),t[4].setComponents(n-o,c-h,d-f,y-v).normalize(),t[5].setComponents(n+o,c+h,d+f,y+v).normalize(),this},intersectsObject:function(e){for(var t=e.matrixWorld,i=this.planes,r=t.getPosition(),a=-e.geometry.boundingSphere.radius*t.getMaxScaleOnAxis(),o=0;o<6;o++){var n=i[o].distanceToPoint(r);if(n<a)return!1}return!0},intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,a=0;a<6;a++){var o=t[a].distanceToPoint(i);if(o<r)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new o.Frustum).copy(this)}},o.Plane=function(e,t){this.normal=void 0!==e?e:new o.Vector3(1,0,0),this.constant=void 0!==t?t:0},o.Plane.prototype={constructor:o.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var r=o.Plane.__v1.subVectors(i,t).cross(o.Plane.__v2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e),r=t||new o.Vector3;return r.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e,t){var i=this.distanceToPoint(e),r=this.distanceToPoint(t);return i<0&&r>0||r<0&&i>0},intersectLine:function(e,t,i){var r=i||new o.Vector3,a=o.Plane.__v1.subVectors(t,e),n=this.normal.dot(a);if(0==n)return 0==this.distanceToPoint(e)?r.copy(e):void 0;var s=-(e.dot(this.normal)+this.constant)/n;return s<0||s>1?void 0:r.copy(a).multiplyScalar(s).add(e)},coplanarPoint:function(e){var t=e||new o.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},transform:function(e,t){t=t||(new o.Matrix3).getInverse(e).transpose();var i=o.Plane.__v1.copy(this.normal).applyMatrix3(t),r=this.coplanarPoint(o.Plane.__v2);return r.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(i,r),this},translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new o.Plane).copy(this)}},o.Plane.__vZero=new o.Vector3(0,0,0),o.Plane.__v1=new o.Vector3,o.Plane.__v2=new o.Vector3,o.Math={clamp:function(e,t,i){return e<t?t:e>i?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,a){return r+(e-t)*(a-r)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(e){return e*o.Math.__d2r},radToDeg:function(e){return e*o.Math.__r2d}},o.Math.__d2r=Math.PI/180,o.Math.__r2d=180/Math.PI,o.Spline=function(e){this.points=e;var t,i,r,a,n,s,l,h,c,p=[],u={x:0,y:0,z:0};function f(e,t,i,r,a,o,n){var s=.5*(i-e),l=.5*(r-t);return(2*(t-i)+s+l)*n+(-3*(t-i)-2*s-l)*o+s*a+t}this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,i=Math.floor(t),r=t-i,p[0]=0===i?i:i-1,p[1]=i,p[2]=i>this.points.length-2?this.points.length-1:i+1,p[3]=i>this.points.length-3?this.points.length-1:i+2,s=this.points[p[0]],l=this.points[p[1]],h=this.points[p[2]],c=this.points[p[3]],a=r*r,n=r*a,u.x=f(s.x,l.x,h.x,c.x,r,a,n),u.y=f(s.y,l.y,h.y,c.y,r,a,n),u.z=f(s.z,l.z,h.z,c.z,r,a,n),u},this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,i,r,a,n=0,s=0,l=0,h=new o.Vector3,c=new o.Vector3,p=[],u=0;for(p[0]=0,e||(e=100),r=this.points.length*e,h.copy(this.points[0]),t=1;t<r;t++)i=t/r,a=this.getPoint(i),c.copy(a),u+=c.distanceTo(h),h.copy(a),n=(this.points.length-1)*i,s=Math.floor(n),s!=l&&(p[s]=u,l=s);return p[p.length]=u,{chunks:p,total:u}},this.reparametrizeByArcLength=function(e){var t,i,r,a,n,s,l,h,c=[],p=new o.Vector3,u=this.getLength();for(c.push(p.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=u.chunks[t]-u.chunks[t-1],l=Math.ceil(e*s/u.total),a=(t-1)/(this.points.length-1),n=t/(this.points.length-1),i=1;i<l-1;i++)r=a+i*(1/l)*(n-a),h=this.getPoint(r),c.push(p.copy(h).clone());c.push(p.copy(this.points[t]).clone())}this.points=c}},o.Triangle=function(e,t,i){this.a=void 0!==e?e:new o.Vector3,this.b=void 0!==t?t:new o.Vector3,this.c=void 0!==i?i:new o.Vector3},o.Triangle.normal=function(e,t,i,r){var a=r||new o.Vector3;a.subVectors(i,t),o.Triangle.__v0.subVectors(e,t),a.cross(o.Triangle.__v0);var n=a.lengthSq();return n>0?a.multiplyScalar(1/Math.sqrt(n)):a.set(0,0,0)},o.Triangle.barycoordFromPoint=function(e,t,i,r,a){o.Triangle.__v0.subVectors(r,t),o.Triangle.__v1.subVectors(i,t),o.Triangle.__v2.subVectors(e,t);var n=o.Triangle.__v0.dot(o.Triangle.__v0),s=o.Triangle.__v0.dot(o.Triangle.__v1),l=o.Triangle.__v0.dot(o.Triangle.__v2),h=o.Triangle.__v1.dot(o.Triangle.__v1),c=o.Triangle.__v1.dot(o.Triangle.__v2),p=n*h-s*s,u=a||new o.Vector3;if(0==p)return u.set(-2,-1,-1);var f=1/p,d=(h*l-s*c)*f,m=(n*c-s*l)*f;return u.set(1-d-m,m,d)},o.Triangle.containsPoint=function(e,t,i,r){var a=o.Triangle.barycoordFromPoint(e,t,i,r,o.Triangle.__v3);return a.x>=0&&a.y>=0&&a.x+a.y<=1},o.Triangle.prototype={constructor:o.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){return o.Triangle.__v0.subVectors(this.c,this.b),o.Triangle.__v1.subVectors(this.a,this.b),.5*o.Triangle.__v0.cross(o.Triangle.__v1).length()},midpoint:function(e){var t=e||new o.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return o.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new o.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return o.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return o.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new o.Triangle).copy(this)}},o.Triangle.__v0=new o.Vector3,o.Triangle.__v1=new o.Vector3,o.Triangle.__v2=new o.Vector3,o.Triangle.__v3=new o.Vector3,o.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},o.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new o.Vector2(e,t)},o.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},o.Clock.prototype.start=function(){this.startTime=Date.now(),this.oldTime=this.startTime,this.running=!0},o.Clock.prototype.stop=function(){this.getElapsedTime(),this.running=!1},o.Clock.prototype.getElapsedTime=function(){return this.getDelta(),this.elapsedTime},o.Clock.prototype.getDelta=function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e},o.EventDispatcher=function(){var e={};this.addEventListener=function(t,i){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(i)&&e[t].push(i)},this.removeEventListener=function(t,i){var r=e[t].indexOf(i);-1!==r&&e[t].splice(r,1)},this.dispatchEvent=function(t){var i=e[t.type];if(void 0!==i){t.target=this;for(var r=0,a=i.length;r<a;r++)i[r].call(this,t)}}},function(e){e.Raycaster=function(t,i,r,a){this.ray=new e.Ray(t,i),this.ray.direction.length()>0&&this.ray.direction.normalize(),this.near=r||0,this.far=a||1/0};var t=new e.Sphere,i=new e.Ray,r=new e.Plane,a=new e.Vector3,o=new e.Matrix4,n=function(e,t){return e.distance-t.distance},s=function(n,s,l){if(n instanceof e.Particle){var h=s.ray.distanceToPoint(n.matrixWorld.getPosition());if(h>n.scale.x)return l;l.push({distance:h,point:n.position,face:null,object:n})}else if(n instanceof e.Mesh){if(t.set(n.matrixWorld.getPosition(),n.geometry.boundingSphere.radius*n.matrixWorld.getMaxScaleOnAxis()),!s.ray.isIntersectionSphere(t))return l;var c,p,u,f,d=n.geometry,m=d.vertices,g=n.material instanceof e.MeshFaceMaterial,v=!0===g?n.material.materials:null,y=n.material.side,x=s.precision;n.matrixRotationWorld.extractRotation(n.matrixWorld),o.getInverse(n.matrixWorld),i.copy(s.ray).transform(o);for(var _=0,w=d.faces.length;_<w;_++){var b=d.faces[_],S=!0===g?v[b.materialIndex]:n.material;if(void 0!==S){r.setFromNormalAndCoplanarPoint(b.normal,m[b.a]);var M=i.distanceToPlane(r);if(!(Math.abs(M)<x)&&!(M<0)){if(y=S.side,y!==e.DoubleSide){var A=i.direction.dot(r.normal);if(!(y===e.FrontSide?A<0:A>0))continue}if(!(M<s.near||M>s.far)){if(a=i.at(M,a),b instanceof e.Face3){if(c=m[b.a],p=m[b.b],u=m[b.c],!e.Triangle.containsPoint(a,c,p,u))continue}else{if(!(b instanceof e.Face4))throw Error("face type not supported");if(c=m[b.a],p=m[b.b],u=m[b.c],f=m[b.d],!e.Triangle.containsPoint(a,c,p,f)&&!e.Triangle.containsPoint(a,p,u,f))continue}l.push({distance:M,point:s.ray.at(M),face:b,faceIndex:_,object:n})}}}}}},l=function(e,t,i){for(var r=e.getDescendants(),a=0,o=r.length;a<o;a++)s(r[a],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),this.ray.direction.length()>0&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return!0===t&&l(e,this,i),s(e,this,i),i.sort(n),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],r=0,a=e.length;r<a;r++)s(e[r],this,i),!0===t&&l(e[r],this,i);return i.sort(n),i}}(o),o.Object3D=function(){this.id=o.Object3DIdCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new o.Vector3(0,1,0),this.position=new o.Vector3,this.rotation=new o.Vector3,this.eulerOrder=o.Object3D.defaultEulerOrder,this.scale=new o.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new o.Matrix4,this.matrixWorld=new o.Matrix4,this.matrixRotationWorld=new o.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new o.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this._vector=new o.Vector3},o.Object3D.prototype={constructor:o.Object3D,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix);var t=(new o.Matrix4).extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.add(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(o.Object3D.__m1.getInverse(this.matrixWorld))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&(!1===this.useQuaternion?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},add:function(e){if(e!==this){if(e instanceof o.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);var t=this;while(void 0!==t.parent)t=t.parent;void 0!==t&&t instanceof o.Scene&&t.__addObject(e)}}else console.warn("THREE.Object3D.add: An object can't be added as a child of itself.")},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);var i=this;while(void 0!==i.parent)i=i.parent;void 0!==i&&i instanceof o.Scene&&i.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;t<i;t++)this.children[t].traverse(e)},getChildByName:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var a=this.children[i];if(a.name===e)return a;if(!0===t&&(a=a.getChildByName(e,t),void 0!==a))return a}},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;t<i;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){void 0===e&&(e=new o.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof o.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled;for(var t=0;t<this.children.length;t++){var i=this.children[t];e.add(i.clone())}return e}},o.Object3D.__m1=new o.Matrix4,o.Object3D.defaultEulerOrder="XYZ",o.Object3DIdCount=0,o.Projector=function(){var e,t,i,r,a,n,s,l,h,c,p,u,f=[],d=0,m=[],g=0,v=[],y=0,x=[],_=0,w=[],b=0,S=[],M=0,A={objects:[],sprites:[],lights:[],elements:[]},T=new o.Vector3,C=new o.Vector4,E=new o.Box3(new o.Vector3(-1,-1,-1),new o.Vector3(1,1,1)),P=new o.Box3,L=new Array(3),R=new Array(4),D=new o.Matrix4,F=new o.Matrix4,U=new o.Matrix4,z=new o.Matrix3,V=new o.Matrix3,B=new o.Vector3,N=new o.Frustum,O=new o.Vector4,I=new o.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(F)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),F.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(F)},this.pickingRay=function(e,t){e.z=-1;var i=new o.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new o.Raycaster(e,i)};var k=function(i,r){t=0,A.objects.length=0,A.sprites.length=0,A.lights.length=0;var a=function(t){for(var i=0,r=t.children.length;i<r;i++){var n=t.children[i];!1!==n.visible&&(n instanceof o.Light?A.lights.push(n):n instanceof o.Mesh||n instanceof o.Line?!1!==n.frustumCulled&&!0!==N.intersectsObject(n)||(e=G(),e.object=n,null!==n.renderDepth?e.z=n.renderDepth:(T.copy(n.matrixWorld.getPosition()),T.applyProjection(F),e.z=T.z),A.objects.push(e)):n instanceof o.Sprite||n instanceof o.Particle?(e=G(),e.object=n,null!==n.renderDepth?e.z=n.renderDepth:(T.copy(n.matrixWorld.getPosition()),T.applyProjection(F),e.z=T.z),A.sprites.push(e)):(e=G(),e.object=n,null!==n.renderDepth?e.z=n.renderDepth:(T.copy(n.matrixWorld.getPosition()),T.applyProjection(F),e.z=T.z),A.objects.push(e)),a(n))}};return a(i),!0===r&&A.objects.sort(q),A};function G(){if(t===d){var e=new o.RenderableObject;return f.push(e),d++,t++,e}return f[t++]}function H(){if(r===g){var e=new o.RenderableVertex;return m.push(e),g++,r++,e}return m[r++]}function W(){if(n===y){var e=new o.RenderableFace3;return v.push(e),y++,n++,e}return v[n++]}function j(){if(s===_){var e=new o.RenderableFace4;return x.push(e),_++,s++,e}return x[s++]}function X(){if(h===b){var e=new o.RenderableLine;return w.push(e),b++,h++,e}return w[h++]}function Y(){if(p===M){var e=new o.RenderableParticle;return S.push(e),M++,p++,e}return S[p++]}function q(e,t){return t.z-e.z}function K(e,t){var i=0,r=1,a=e.z+e.w,o=t.z+t.w,n=-e.z+e.w,s=-t.z+t.w;return a>=0&&o>=0&&n>=0&&s>=0||!(a<0&&o<0||n<0&&s<0)&&(a<0?i=Math.max(i,a/(a-o)):o<0&&(r=Math.min(r,a/(a-o))),n<0?i=Math.max(i,n/(n-s)):s<0&&(r=Math.min(r,n/(n-s))),!(r<i)&&(e.lerp(t,i),t.lerp(e,1-r),!0))}this.projectScene=function(e,t,f,d){var g,v,y,x,_,w,b,S,M,T,G,Q,Z,J,$,ee,te,ie,re,ae,oe,ne,se,le,he,ce,pe=!1;for(n=0,s=0,h=0,p=0,A.elements.length=0,e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),D.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),F.multiplyMatrices(t.projectionMatrix,D),V.getInverse(D),V.transpose(),N.setFromMatrix(F),A=k(e,f),g=0,v=A.objects.length;g<v;g++)if(Z=A.objects[g].object,u=Z.matrixWorld,r=0,Z instanceof o.Mesh){for(J=Z.geometry,$=J.vertices,ee=J.faces,re=J.faceVertexUvs,z.getInverse(u),z.transpose(),he=Z.material instanceof o.MeshFaceMaterial,ce=!0===he?Z.material:null,y=0,x=$.length;y<x;y++)i=H(),i.positionWorld.copy($[y]).applyMatrix4(u),i.positionScreen.copy(i.positionWorld).applyMatrix4(F),i.positionScreen.x/=i.positionScreen.w,i.positionScreen.y/=i.positionScreen.w,i.positionScreen.z/=i.positionScreen.w,i.visible=!(i.positionScreen.x<-1||i.positionScreen.x>1||i.positionScreen.y<-1||i.positionScreen.y>1||i.positionScreen.z<-1||i.positionScreen.z>1);for(_=0,w=ee.length;_<w;_++){te=ee[_];var ue=!0===he?ce.materials[te.materialIndex]:Z.material;if(void 0!==ue){var fe=ue.side;if(te instanceof o.Face3){if(oe=m[te.a],ne=m[te.b],se=m[te.c],L[0]=oe.positionScreen,L[1]=ne.positionScreen,L[2]=se.positionScreen,!0!==oe.visible&&!0!==ne.visible&&!0!==se.visible&&!E.isIntersectionBox(P.setFromPoints(L)))continue;if(pe=(se.positionScreen.x-oe.positionScreen.x)*(ne.positionScreen.y-oe.positionScreen.y)-(se.positionScreen.y-oe.positionScreen.y)*(ne.positionScreen.x-oe.positionScreen.x)<0,fe!==o.DoubleSide&&pe!==(fe===o.FrontSide))continue;a=W(),a.v1.copy(oe),a.v2.copy(ne),a.v3.copy(se)}else if(te instanceof o.Face4){if(oe=m[te.a],ne=m[te.b],se=m[te.c],le=m[te.d],R[0]=oe.positionScreen,R[1]=ne.positionScreen,R[2]=se.positionScreen,R[3]=le.positionScreen,!0!==oe.visible&&!0!==ne.visible&&!0!==se.visible&&!0!==le.visible&&!E.isIntersectionBox(P.setFromPoints(R)))continue;if(pe=(le.positionScreen.x-oe.positionScreen.x)*(ne.positionScreen.y-oe.positionScreen.y)-(le.positionScreen.y-oe.positionScreen.y)*(ne.positionScreen.x-oe.positionScreen.x)<0||(ne.positionScreen.x-se.positionScreen.x)*(le.positionScreen.y-se.positionScreen.y)-(ne.positionScreen.y-se.positionScreen.y)*(le.positionScreen.x-se.positionScreen.x)<0,fe!==o.DoubleSide&&pe!==(fe===o.FrontSide))continue;a=j(),a.v1.copy(oe),a.v2.copy(ne),a.v3.copy(se),a.v4.copy(le)}for(a.normalModel.copy(te.normal),!1!==pe||fe!==o.BackSide&&fe!==o.DoubleSide||a.normalModel.negate(),a.normalModel.applyMatrix3(z).normalize(),a.normalModelView.copy(a.normalModel).applyMatrix3(V),a.centroidModel.copy(te.centroid).applyMatrix4(u),ie=te.vertexNormals,b=0,S=ie.length;b<S;b++){var de=a.vertexNormalsModel[b];de.copy(ie[b]),!1!==pe||fe!==o.BackSide&&fe!==o.DoubleSide||de.negate(),de.applyMatrix3(z).normalize();var me=a.vertexNormalsModelView[b];me.copy(de).applyMatrix3(V)}for(a.vertexNormalsLength=ie.length,M=0,T=re.length;M<T;M++)if(ae=re[M][_],void 0!==ae)for(G=0,Q=ae.length;G<Q;G++)a.uvs[M][G]=ae[G];a.color=te.color,a.material=ue,B.copy(a.centroidModel).applyProjection(F),a.z=B.z,A.elements.push(a)}}}else if(Z instanceof o.Line){U.multiplyMatrices(F,u),$=Z.geometry.vertices,oe=H(),oe.positionScreen.copy($[0]).applyMatrix4(U);var ge=Z.type===o.LinePieces?2:1;for(y=1,x=$.length;y<x;y++)oe=H(),oe.positionScreen.copy($[y]).applyMatrix4(U),(y+1)%ge>0||(ne=m[r-2],O.copy(oe.positionScreen),I.copy(ne.positionScreen),!0===K(O,I)&&(O.multiplyScalar(1/O.w),I.multiplyScalar(1/I.w),l=X(),l.v1.positionScreen.copy(O),l.v2.positionScreen.copy(I),l.z=Math.max(O.z,I.z),l.material=Z.material,A.elements.push(l)))}for(g=0,v=A.sprites.length;g<v;g++)Z=A.sprites[g].object,u=Z.matrixWorld,Z instanceof o.Particle&&(C.set(u.elements[12],u.elements[13],u.elements[14],1),C.applyMatrix4(F),C.z/=C.w,C.z>0&&C.z<1&&(c=Y(),c.object=Z,c.x=C.x/C.w,c.y=C.y/C.w,c.z=C.z,c.rotation=Z.rotation.z,c.scale.x=Z.scale.x*Math.abs(c.x-(C.x+t.projectionMatrix.elements[0])/(C.w+t.projectionMatrix.elements[12])),c.scale.y=Z.scale.y*Math.abs(c.y-(C.y+t.projectionMatrix.elements[5])/(C.w+t.projectionMatrix.elements[13])),c.material=Z.material,A.elements.push(c)));return!0===d&&A.elements.sort(q),A}},o.Face3=function(e,t,i,r,a,n){this.a=e,this.b=t,this.c=i,this.normal=r instanceof o.Vector3?r:new o.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=a instanceof o.Color?a:new o.Color,this.vertexColors=a instanceof Array?a:[],this.vertexTangents=[],this.materialIndex=void 0!==n?n:0,this.centroid=new o.Vector3},o.Face3.prototype={constructor:o.Face3,clone:function(){var e,t,i=new o.Face3(this.a,this.b,this.c);for(i.normal.copy(this.normal),i.color.copy(this.color),i.centroid.copy(this.centroid),i.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)i.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,t=this.vertexColors.length;e<t;e++)i.vertexColors[e]=this.vertexColors[e].clone();for(e=0,t=this.vertexTangents.length;e<t;e++)i.vertexTangents[e]=this.vertexTangents[e].clone();return i}},o.Face4=function(e,t,i,r,a,n,s){this.a=e,this.b=t,this.c=i,this.d=r,this.normal=a instanceof o.Vector3?a:new o.Vector3,this.vertexNormals=a instanceof Array?a:[],this.color=n instanceof o.Color?n:new o.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0,this.centroid=new o.Vector3},o.Face4.prototype={constructor:o.Face4,clone:function(){var e,t,i=new o.Face4(this.a,this.b,this.c,this.d);for(i.normal.copy(this.normal),i.color.copy(this.color),i.centroid.copy(this.centroid),i.materialIndex=this.materialIndex,e=0,t=this.vertexNormals.length;e<t;e++)i.vertexNormals[e]=this.vertexNormals[e].clone();for(e=0,t=this.vertexColors.length;e<t;e++)i.vertexColors[e]=this.vertexColors[e].clone();for(e=0,t=this.vertexTangents.length;e<t;e++)i.vertexTangents[e]=this.vertexTangents[e].clone();return i}},o.Geometry=function(){o.EventDispatcher.call(this),this.id=o.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},o.Geometry.prototype={constructor:o.Geometry,applyMatrix:function(e){for(var t=(new o.Matrix3).getInverse(e).transpose(),i=0,r=this.vertices.length;i<r;i++){var a=this.vertices[i];a.applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var s=0,l=n.vertexNormals.length;s<l;s++)n.vertexNormals[s].applyMatrix3(t).normalize();n.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],i.centroid.set(0,0,0),i instanceof o.Face3?(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)):i instanceof o.Face4&&(i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.add(this.vertices[i.d]),i.centroid.divideScalar(4))},computeFaceNormals:function(){var e,t,i,r,a,n,s=new o.Vector3,l=new o.Vector3;for(e=0,t=this.faces.length;e<t;e++)i=this.faces[e],r=this.vertices[i.a],a=this.vertices[i.b],n=this.vertices[i.c],s.subVectors(n,a),l.subVectors(r,a),s.cross(l),s.normalize(),i.normal.copy(s)},computeVertexNormals:function(e){var t,i,r,a,n,s;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),s=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)s[t]=new o.Vector3;for(r=0,a=this.faces.length;r<a;r++)n=this.faces[r],n instanceof o.Face3?n.vertexNormals=[new o.Vector3,new o.Vector3,new o.Vector3]:n instanceof o.Face4&&(n.vertexNormals=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3])}else for(s=this.__tmpVertices,t=0,i=this.vertices.length;t<i;t++)s[t].set(0,0,0);if(e){var l,h,c,p,u=new o.Vector3,f=new o.Vector3,d=new o.Vector3,m=new o.Vector3,g=new o.Vector3;for(r=0,a=this.faces.length;r<a;r++)n=this.faces[r],n instanceof o.Face3?(l=this.vertices[n.a],h=this.vertices[n.b],c=this.vertices[n.c],u.subVectors(c,h),f.subVectors(l,h),u.cross(f),s[n.a].add(u),s[n.b].add(u),s[n.c].add(u)):n instanceof o.Face4&&(l=this.vertices[n.a],h=this.vertices[n.b],c=this.vertices[n.c],p=this.vertices[n.d],d.subVectors(p,h),f.subVectors(l,h),d.cross(f),s[n.a].add(d),s[n.b].add(d),s[n.d].add(d),m.subVectors(p,c),g.subVectors(h,c),m.cross(g),s[n.b].add(m),s[n.c].add(m),s[n.d].add(m))}else for(r=0,a=this.faces.length;r<a;r++)n=this.faces[r],n instanceof o.Face3?(s[n.a].add(n.normal),s[n.b].add(n.normal),s[n.c].add(n.normal)):n instanceof o.Face4&&(s[n.a].add(n.normal),s[n.b].add(n.normal),s[n.c].add(n.normal),s[n.d].add(n.normal));for(t=0,i=this.vertices.length;t<i;t++)s[t].normalize();for(r=0,a=this.faces.length;r<a;r++)n=this.faces[r],n instanceof o.Face3?(n.vertexNormals[0].copy(s[n.a]),n.vertexNormals[1].copy(s[n.b]),n.vertexNormals[2].copy(s[n.c])):n instanceof o.Face4&&(n.vertexNormals[0].copy(s[n.a]),n.vertexNormals[1].copy(s[n.b]),n.vertexNormals[2].copy(s[n.c]),n.vertexNormals[3].copy(s[n.d]))},computeMorphNormals:function(){var e,t,i,r,a;for(i=0,r=this.faces.length;i<r;i++)for(a=this.faces[i],a.__originalFaceNormal?a.__originalFaceNormal.copy(a.normal):a.__originalFaceNormal=a.normal.clone(),a.__originalVertexNormals||(a.__originalVertexNormals=[]),e=0,t=a.vertexNormals.length;e<t;e++)a.__originalVertexNormals[e]?a.__originalVertexNormals[e].copy(a.vertexNormals[e]):a.__originalVertexNormals[e]=a.vertexNormals[e].clone();var n=new o.Geometry;for(n.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,l=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],h=new o.Vector3,c=a instanceof o.Face3?{a:new o.Vector3,b:new o.Vector3,c:new o.Vector3}:{a:new o.Vector3,b:new o.Vector3,c:new o.Vector3,d:new o.Vector3},s.push(h),l.push(c)}var h,c,p=this.morphNormals[e];for(n.vertices=this.morphTargets[e].vertices,n.computeFaceNormals(),n.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)a=this.faces[i],h=p.faceNormals[i],c=p.vertexNormals[i],h.copy(a.normal),a instanceof o.Face3?(c.a.copy(a.vertexNormals[0]),c.b.copy(a.vertexNormals[1]),c.c.copy(a.vertexNormals[2])):(c.a.copy(a.vertexNormals[0]),c.b.copy(a.vertexNormals[1]),c.c.copy(a.vertexNormals[2]),c.d.copy(a.vertexNormals[3]))}for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],a.normal=a.__originalFaceNormal,a.vertexNormals=a.__originalVertexNormals},computeTangents:function(){var e,t,i,r,a,n,s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C,E,P=[],L=[],R=new o.Vector3,D=new o.Vector3,F=new o.Vector3,U=new o.Vector3,z=new o.Vector3;for(i=0,r=this.vertices.length;i<r;i++)P[i]=new o.Vector3,L[i]=new o.Vector3;function V(e,t,i,r,a,o,n){h=e.vertices[t],c=e.vertices[i],p=e.vertices[r],u=l[a],f=l[o],d=l[n],m=c.x-h.x,g=p.x-h.x,v=c.y-h.y,y=p.y-h.y,x=c.z-h.z,_=p.z-h.z,w=f.x-u.x,b=d.x-u.x,S=f.y-u.y,M=d.y-u.y,A=1/(w*M-b*S),R.set((M*m-S*g)*A,(M*v-S*y)*A,(M*x-S*_)*A),D.set((w*g-b*m)*A,(w*y-b*v)*A,(w*_-b*x)*A),P[t].add(R),P[i].add(R),P[r].add(R),L[t].add(D),L[i].add(D),L[r].add(D)}for(e=0,t=this.faces.length;e<t;e++)s=this.faces[e],l=this.faceVertexUvs[0][e],s instanceof o.Face3?V(this,s.a,s.b,s.c,0,1,2):s instanceof o.Face4&&(V(this,s.a,s.b,s.d,0,1,3),V(this,s.b,s.c,s.d,1,2,3));var B=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(s=this.faces[e],a=0;a<s.vertexNormals.length;a++)z.copy(s.vertexNormals[a]),n=s[B[a]],T=P[n],F.copy(T),F.sub(z.multiplyScalar(z.dot(T))).normalize(),U.crossVectors(s.vertexNormals[a],T),C=U.dot(L[n]),E=C<0?-1:1,s.vertexTangents[a]=new o.Vector4(F.x,F.y,F.z,E);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new o.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e,t,i,r,a,n,s,l,h,c={},p=[],u=[],f=4,d=Math.pow(10,f);for(this.__tmpVertices=void 0,i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],t=[Math.round(e.x*d),Math.round(e.y*d),Math.round(e.z*d)].join("_"),void 0===c[t]?(c[t]=i,p.push(this.vertices[i]),u[i]=p.length-1):u[i]=u[c[t]];var m=[];for(i=0,r=this.faces.length;i<r;i++)if(a=this.faces[i],a instanceof o.Face3){a.a=u[a.a],a.b=u[a.b],a.c=u[a.c],n=[a.a,a.b,a.c];for(var g=-1,v=0;v<3;v++)if(n[v]==n[(v+1)%3]){g=v,m.push(i);break}}else if(a instanceof o.Face4){a.a=u[a.a],a.b=u[a.b],a.c=u[a.c],a.d=u[a.d],n=[a.a,a.b,a.c,a.d];for(g=-1,v=0;v<4;v++)n[v]==n[(v+1)%4]&&(g>=0&&m.push(i),g=v);if(g>=0){n.splice(g,1);var y=new o.Face3(n[0],n[1],n[2],a.normal,a.color,a.materialIndex);for(s=0,l=this.faceVertexUvs.length;s<l;s++)h=this.faceVertexUvs[s][i],h&&h.splice(g,1);a.vertexNormals&&a.vertexNormals.length>0&&(y.vertexNormals=a.vertexNormals,y.vertexNormals.splice(g,1)),a.vertexColors&&a.vertexColors.length>0&&(y.vertexColors=a.vertexColors,y.vertexColors.splice(g,1)),this.faces[i]=y}}for(i=m.length-1;i>=0;i--)for(this.faces.splice(i,1),s=0,l=this.faceVertexUvs.length;s<l;s++)this.faceVertexUvs[s].splice(i,1);var x=this.vertices.length-p.length;return this.vertices=p,x},clone:function(){for(var e=new o.Geometry,t=this.vertices,i=0,r=t.length;i<r;i++)e.vertices.push(t[i].clone());var a=this.faces;for(i=0,r=a.length;i<r;i++)e.faces.push(a[i].clone());var n=this.faceVertexUvs[0];for(i=0,r=n.length;i<r;i++){for(var s=n[i],l=[],h=0,c=s.length;h<c;h++)l.push(new o.Vector2(s[h].x,s[h].y));e.faceVertexUvs[0].push(l)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.GeometryIdCount=0,o.BufferGeometry=function(){o.EventDispatcher.call(this),this.id=o.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},o.BufferGeometry.prototype={constructor:o.BufferGeometry,applyMatrix:function(e){var t,i;if(this.attributes["position"]&&(t=this.attributes["position"].array),this.attributes["normal"]&&(i=this.attributes["normal"].array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i){var r=new o.Matrix3;r.getInverse(e).transpose(),r.multiplyVector3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new o.Box3);var e=this.attributes["position"].array;if(e){var t,i,r,a=this.boundingBox;e.length>=3&&(a.min.x=a.max.x=e[0],a.min.y=a.max.y=e[1],a.min.z=a.max.z=e[2]);for(var n=3,s=e.length;n<s;n+=3)t=e[n],i=e[n+1],r=e[n+2],t<a.min.x?a.min.x=t:t>a.max.x&&(a.max.x=t),i<a.min.y?a.min.y=i:i>a.max.y&&(a.max.y=i),r<a.min.z?a.min.z=r:r>a.max.z&&(a.max.z=r)}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere);var e=this.attributes["position"].array;if(e){for(var t,i,r,a,n=0,s=0,l=e.length;s<l;s+=3)i=e[s],r=e[s+1],a=e[s+2],t=i*i+r*r+a*a,t>n&&(n=t);this.boundingSphere.radius=Math.sqrt(n)}},computeVertexNormals:function(){if(this.attributes["position"]){var e,t,i,r,a=this.attributes["position"].array.length;if(void 0===this.attributes["normal"])this.attributes["normal"]={itemSize:3,array:new Float32Array(a),numItems:a};else for(e=0,t=this.attributes["normal"].array.length;e<t;e++)this.attributes["normal"].array[e]=0;var n,s,l,h,c,p,u=this.attributes["position"].array,f=this.attributes["normal"].array,d=new o.Vector3,m=new o.Vector3,g=new o.Vector3,v=new o.Vector3,y=new o.Vector3;if(this.attributes["index"]){var x=this.attributes["index"].array,_=this.offsets;for(i=0,r=_.length;i<r;++i){var w=_[i].start,b=_[i].count,S=_[i].index;for(e=w,t=w+b;e<t;e+=3)n=S+x[e],s=S+x[e+1],l=S+x[e+2],h=u[3*n],c=u[3*n+1],p=u[3*n+2],d.set(h,c,p),h=u[3*s],c=u[3*s+1],p=u[3*s+2],m.set(h,c,p),h=u[3*l],c=u[3*l+1],p=u[3*l+2],g.set(h,c,p),v.subVectors(g,m),y.subVectors(d,m),v.cross(y),f[3*n]+=v.x,f[3*n+1]+=v.y,f[3*n+2]+=v.z,f[3*s]+=v.x,f[3*s+1]+=v.y,f[3*s+2]+=v.z,f[3*l]+=v.x,f[3*l+1]+=v.y,f[3*l+2]+=v.z}}else for(e=0,t=u.length;e<t;e+=9)h=u[e],c=u[e+1],p=u[e+2],d.set(h,c,p),h=u[e+3],c=u[e+4],p=u[e+5],m.set(h,c,p),h=u[e+6],c=u[e+7],p=u[e+8],g.set(h,c,p),v.subVectors(g,m),y.subVectors(d,m),v.cross(y),f[e]=v.x,f[e+1]=v.y,f[e+2]=v.z,f[e+3]=v.x,f[e+4]=v.y,f[e+5]=v.z,f[e+6]=v.x,f[e+7]=v.y,f[e+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,r,a=this.attributes["normal"].array,o=0,n=a.length;o<n;o+=3)e=a[o],t=a[o+1],i=a[o+2],r=1/Math.sqrt(e*e+t*t+i*i),a[o]*=r,a[o+1]*=r,a[o+2]*=r},computeTangents:function(){if(void 0!==this.attributes["index"]&&void 0!==this.attributes["position"]&&void 0!==this.attributes["normal"]&&void 0!==this.attributes["uv"]){var e=this.attributes["index"].array,t=this.attributes["position"].array,i=this.attributes["normal"].array,r=this.attributes["uv"].array,a=t.length/3;if(void 0===this.attributes["tangent"]){var n=4*a;this.attributes["tangent"]={itemSize:4,array:new Float32Array(n),numItems:n}}for(var s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C,E,P,L,R,D,F=this.attributes["tangent"].array,U=[],z=[],V=0;V<a;V++)U[V]=new o.Vector3,z[V]=new o.Vector3;var B,N,O,I,k,G,H,W=new o.Vector3,j=new o.Vector3,X=this.offsets;for(O=0,I=X.length;O<I;++O){var Y=X[O].start,q=X[O].count,K=X[O].index;for(B=Y,N=Y+q;B<N;B+=3)k=K+e[B],G=K+e[B+1],H=K+e[B+2],re(k,G,H)}var Q,Z,J,$=new o.Vector3,ee=new o.Vector3,te=new o.Vector3,ie=new o.Vector3;for(O=0,I=X.length;O<I;++O){Y=X[O].start,q=X[O].count,K=X[O].index;for(B=Y,N=Y+q;B<N;B+=3)k=K+e[B],G=K+e[B+1],H=K+e[B+2],ae(k),ae(G),ae(H)}this.hasTangents=!0,this.tangentsNeedUpdate=!0}else console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function re(e,i,a){s=t[3*e],l=t[3*e+1],h=t[3*e+2],c=t[3*i],p=t[3*i+1],u=t[3*i+2],f=t[3*a],d=t[3*a+1],m=t[3*a+2],g=r[2*e],v=r[2*e+1],y=r[2*i],x=r[2*i+1],_=r[2*a],w=r[2*a+1],b=c-s,S=f-s,M=p-l,A=d-l,T=u-h,C=m-h,E=y-g,P=_-g,L=x-v,R=w-v,D=1/(E*R-P*L),W.set((R*b-L*S)*D,(R*M-L*A)*D,(R*T-L*C)*D),j.set((E*S-P*b)*D,(E*A-P*M)*D,(E*C-P*T)*D),U[e].add(W),U[i].add(W),U[a].add(W),z[e].add(j),z[i].add(j),z[a].add(j)}function ae(e){te.x=i[3*e],te.y=i[3*e+1],te.z=i[3*e+2],ie.copy(te),Z=U[e],$.copy(Z),$.sub(te.multiplyScalar(te.dot(Z))).normalize(),ee.crossVectors(ie,Z),J=ee.dot(z[e]),Q=J<0?-1:1,F[4*e]=$.x,F[4*e+1]=$.y,F[4*e+2]=$.z,F[4*e+3]=Q}},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.Camera=function(){o.Object3D.call(this),this.matrixWorldInverse=new o.Matrix4,this.projectionMatrix=new o.Matrix4,this.projectionMatrixInverse=new o.Matrix4},o.Camera.prototype=Object.create(o.Object3D.prototype),o.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),!0===this.rotationAutoUpdate&&(!1===this.useQuaternion?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},o.OrthographicCamera=function(e,t,i,r,a,n){o.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==a?a:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},o.OrthographicCamera.prototype=Object.create(o.Camera.prototype),o.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},o.PerspectiveCamera=function(e,t,i,r){o.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype=Object.create(o.Camera.prototype),o.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*o.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,a,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=r,this.width=a,this.height=o,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(o.Math.degToRad(.5*this.fov))*this.near,i=-t,r=e*i,a=e*t,n=Math.abs(a-r),s=Math.abs(t-i);this.projectionMatrix.makeFrustum(r+this.x*n/this.fullWidth,r+(this.x+this.width)*n/this.fullWidth,t-(this.y+this.height)*s/this.fullHeight,t-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},o.Light=function(e){o.Object3D.call(this),this.color=new o.Color(e)},o.Light.prototype=Object.create(o.Object3D.prototype),o.AmbientLight=function(e){o.Light.call(this,e)},o.AmbientLight.prototype=Object.create(o.Light.prototype),o.AreaLight=function(e,t){o.Light.call(this,e),this.normal=new o.Vector3(0,-1,0),this.right=new o.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},o.AreaLight.prototype=Object.create(o.Light.prototype),o.DirectionalLight=function(e,t){o.Light.call(this,e),this.position=new o.Vector3(0,1,0),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new o.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},o.DirectionalLight.prototype=Object.create(o.Light.prototype),o.HemisphereLight=function(e,t,i){o.Light.call(this,e),this.groundColor=new o.Color(t),this.position=new o.Vector3(0,100,0),this.intensity=void 0!==i?i:1},o.HemisphereLight.prototype=Object.create(o.Light.prototype),o.PointLight=function(e,t,i){o.Light.call(this,e),this.position=new o.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},o.PointLight.prototype=Object.create(o.Light.prototype),o.SpotLight=function(e,t,i,r,a){o.Light.call(this,e),this.position=new o.Vector3(0,1,0),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/2,this.exponent=void 0!==a?a:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},o.SpotLight.prototype=Object.create(o.Light.prototype),o.Loader=function(e){this.showStatus=e,this.statusDomElement=e?o.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},o.Loader.prototype={constructor:o.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";e.total?t+=(100*e.loaded/e.total).toFixed(0)+"%":t+=(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var i=[],r=0;r<e.length;++r)i[r]=o.Loader.prototype.createMaterial(e[r],t);return i},needsTangents:function(e){for(var t=0,i=e.length;t<i;t++){var r=e[t];if(r instanceof o.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var i=this;function r(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function a(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,t){var o=new Image;o.onload=function(){if(r(this.width)&&r(this.height))e.image=this;else{var t=a(this.width),i=a(this.height);e.image.width=t,e.image.height=i,e.image.getContext("2d").drawImage(this,0,0,t,i)}e.needsUpdate=!0},o.crossOrigin=i.crossOrigin,o.src=t}function s(e,i,r,a,s,l,h){var c=r.toLowerCase().endsWith(".dds"),p=t+"/"+r;if(c){var u=o.ImageUtils.loadCompressedTexture(p);e[i]=u}else{u=document.createElement("canvas");e[i]=new o.Texture(u)}if(e[i].sourceFile=r,a&&(e[i].repeat.set(a[0],a[1]),1!==a[0]&&(e[i].wrapS=o.RepeatWrapping),1!==a[1]&&(e[i].wrapT=o.RepeatWrapping)),s&&e[i].offset.set(s[0],s[1]),l){var f={repeat:o.RepeatWrapping,mirror:o.MirroredRepeatWrapping};void 0!==f[l[0]]&&(e[i].wrapS=f[l[0]]),void 0!==f[l[1]]&&(e[i].wrapT=f[l[1]])}h&&(e[i].anisotropy=h),c||n(e[i],p)}function l(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var h="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var p=e.shading.toLowerCase();"phong"===p?h="MeshPhongMaterial":"basic"===p&&(h="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==o[e.blending]&&(c.blending=o[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(c.transparent=e.transparent),void 0!==e.depthTest&&(c.depthTest=e.depthTest),void 0!==e.depthWrite&&(c.depthWrite=e.depthWrite),void 0!==e.visible&&(c.visible=e.visible),void 0!==e.flipSided&&(c.side=o.BackSide),void 0!==e.doubleSided&&(c.side=o.DoubleSide),void 0!==e.wireframe&&(c.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?c.vertexColors=o.FaceColors:e.vertexColors&&(c.vertexColors=o.VertexColors)),e.colorDiffuse?c.color=l(e.colorDiffuse):e.DbgColor&&(c.color=e.DbgColor),e.colorSpecular&&(c.specular=l(e.colorSpecular)),e.colorAmbient&&(c.ambient=l(e.colorAmbient)),e.transparency&&(c.opacity=e.transparency),e.specularCoef&&(c.shininess=e.specularCoef),e.mapDiffuse&&t&&s(c,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&s(c,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&s(c,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&s(c,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&s(c,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(c.bumpScale=e.mapBumpScale),e.mapNormal){var u=o.ShaderLib["normalmap"],f=o.UniformsUtils.clone(u.uniforms);f["tNormal"].value=c.normalMap,e.mapNormalFactor&&f["uNormalScale"].value.set(e.mapNormalFactor,e.mapNormalFactor),c.map&&(f["tDiffuse"].value=c.map,f["enableDiffuse"].value=!0),c.specularMap&&(f["tSpecular"].value=c.specularMap,f["enableSpecular"].value=!0),c.lightMap&&(f["tAO"].value=c.lightMap,f["enableAO"].value=!0),f["uDiffuseColor"].value.setHex(c.color),f["uSpecularColor"].value.setHex(c.specular),f["uAmbientColor"].value.setHex(c.ambient),f["uShininess"].value=c.shininess,void 0!==c.opacity&&(f["uOpacity"].value=c.opacity);var d={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:f,lights:!0,fog:!0},m=new o.ShaderMaterial(d);c.transparent&&(m.transparent=!0)}else m=new o[h](c);return void 0!==e.DbgName&&(m.name=e.DbgName),m}},o.ImageLoader=function(){o.EventDispatcher.call(this),this.crossOrigin=null},o.ImageLoader.prototype={constructor:o.ImageLoader,load:function(e,t){var i=this;void 0===t&&(t=new Image),t.addEventListener("load",(function(){i.dispatchEvent({type:"load",content:t})}),!1),t.addEventListener("error",(function(){i.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})}),!1),i.crossOrigin&&(t.crossOrigin=i.crossOrigin),t.src=e}},o.JSONLoader=function(e){o.Loader.call(this,e),this.withCredentials=!1},o.JSONLoader.prototype=Object.create(o.Loader.prototype),o.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"===typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},o.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,a){var o=new XMLHttpRequest,n=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);e.createModel(s,i,r)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?a&&(0===n&&(n=o.getResponseHeader("Content-Length")),a({total:n,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&(n=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},o.JSONLoader.prototype.createModel=function(e,t,i){var r=new o.Geometry,a=void 0!==e.scale?1/e.scale:1;function n(t){function i(e,t){return e&1<<t}var a,n,s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C,E,P,L,R,D=e.faces,F=e.vertices,U=e.normals,z=e.colors,V=0;for(a=0;a<e.uvs.length;a++)e.uvs[a].length&&V++;for(a=0;a<V;a++)r.faceUvs[a]=[],r.faceVertexUvs[a]=[];l=0,h=F.length;while(l<h)M=new o.Vector3,M.x=F[l++]*t,M.y=F[l++]*t,M.z=F[l++]*t,r.vertices.push(M);l=0,h=D.length;while(l<h){if(m=D[l++],g=i(m,0),v=i(m,1),y=i(m,2),x=i(m,3),_=i(m,4),w=i(m,5),b=i(m,6),S=i(m,7),g?(A=new o.Face4,A.a=D[l++],A.b=D[l++],A.c=D[l++],A.d=D[l++],c=4):(A=new o.Face3,A.a=D[l++],A.b=D[l++],A.c=D[l++],c=3),v&&(d=D[l++],A.materialIndex=d),s=r.faces.length,y)for(a=0;a<V;a++)E=e.uvs[a],f=D[l++],L=E[2*f],R=E[2*f+1],r.faceUvs[a][s]=new o.Vector2(L,R);if(x)for(a=0;a<V;a++){for(E=e.uvs[a],P=[],n=0;n<c;n++)f=D[l++],L=E[2*f],R=E[2*f+1],P[n]=new o.Vector2(L,R);r.faceVertexUvs[a][s]=P}if(_&&(u=3*D[l++],C=new o.Vector3,C.x=U[u++],C.y=U[u++],C.z=U[u],A.normal=C),w)for(a=0;a<c;a++)u=3*D[l++],C=new o.Vector3,C.x=U[u++],C.y=U[u++],C.z=U[u],A.vertexNormals.push(C);if(b&&(p=D[l++],T=new o.Color(z[p]),A.color=T),S)for(a=0;a<c;a++)p=D[l++],T=new o.Color(z[p]),A.vertexColors.push(T);r.faces.push(A)}}function s(){var t,i,a,n,s,l,h,c,p,u;if(e.skinWeights)for(t=0,i=e.skinWeights.length;t<i;t+=2)a=e.skinWeights[t],n=e.skinWeights[t+1],s=0,l=0,r.skinWeights.push(new o.Vector4(a,n,s,l));if(e.skinIndices)for(t=0,i=e.skinIndices.length;t<i;t+=2)h=e.skinIndices[t],c=e.skinIndices[t+1],p=0,u=0,r.skinIndices.push(new o.Vector4(h,c,p,u));r.bones=e.bones,r.animation=e.animation}function l(t){var i,a,n,s,l,h,c,p,u,f,d;if(void 0!==e.morphTargets)for(l=0,h=e.morphTargets.length;l<h;l++)for(r.morphTargets[l]={},r.morphTargets[l].name=e.morphTargets[l].name,r.morphTargets[l].vertices=[],n=r.morphTargets[l].vertices,s=e.morphTargets[l].vertices,i=0,a=s.length;i<a;i+=3){var m=new o.Vector3;m.x=s[i]*t,m.y=s[i+1]*t,m.z=s[i+2]*t,n.push(m)}if(void 0!==e.morphColors)for(l=0,h=e.morphColors.length;l<h;l++)for(r.morphColors[l]={},r.morphColors[l].name=e.morphColors[l].name,r.morphColors[l].colors=[],u=r.morphColors[l].colors,f=e.morphColors[l].colors,c=0,p=f.length;c<p;c+=3)d=new o.Color(16755200),d.setRGB(f[c],f[c+1],f[c+2]),u.push(d)}n(a),s(),l(a),r.computeCentroids(),r.computeFaceNormals();var h=this.initMaterials(e.materials,i);this.needsTangents(h)&&r.computeTangents(),t(r,h)},o.LoadingMonitor=function(){o.EventDispatcher.call(this);var e=this,t=0,i=0,r=function(r){t++,e.dispatchEvent({type:"progress",loaded:t,total:i}),t===i&&e.dispatchEvent({type:"load"})};this.add=function(e){i++,e.addEventListener("load",r,!1)}},o.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",o.JSONLoader)},o.SceneLoader.prototype.constructor=o.SceneLoader,o.SceneLoader.prototype.load=function(e,t){var i=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status||0===r.status){var a=JSON.parse(r.responseText);i.parse(a,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")},r.open("GET",e,!0),r.send(null)},o.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},o.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},o.SceneLoader.prototype.parse=function(e,t,i){var r,a,n,s,l,h,c,p,u,f,d,m,g,v,y=this,x=o.Loader.prototype.extractUrlBase(i),_=[],w=e;for(var b in this.geometryHandlerMap){var S=this.geometryHandlerMap[b]["loaderClass"];this.geometryHandlerMap[b]["loaderObject"]=new S}for(var b in this.hierarchyHandlerMap){S=this.hierarchyHandlerMap[b]["loaderClass"];this.hierarchyHandlerMap[b]["loaderObject"]=new S}if(f=0,d=0,v={scene:new o.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},w.transform){var M=w.transform.position,A=w.transform.rotation,T=w.transform.scale;M&&v.scene.position.set(M[0],M[1],M[2]),A&&v.scene.rotation.set(A[0],A[1],A[2]),T&&v.scene.scale.set(T[0],T[1],T[2]),(M||A||T)&&(v.scene.updateMatrix(),v.scene.updateMatrixWorld())}function C(e,t){return"relativeToHTML"==t?e:x+"/"+e}function E(){P(v.scene,w.objects)}function P(e,t){var i,s,l,h,f,d;for(var m in t)if(void 0===v.objects[m]){var g=t[m],x=null;if(g.type&&g.type in y.hierarchyHandlerMap){if(void 0===g.loading){var b={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,properties:1,skin:1,morph:1,mirroredLoop:1,duration:1},S={};for(var M in g)M in b||(S[M]=g[M]);a=v.materials[g.material],g.loading=!0;var A=y.hierarchyHandlerMap[g.type]["loaderObject"];A.options?A.load(C(g.url,w.urlBaseType),F(m,e,a,g)):A.load(C(g.url,w.urlBaseType),F(m,e,a,g),S)}}else if(void 0!==g.geometry){if(r=v.geometries[g.geometry],r){var T=!1;if(a=v.materials[g.material],T=a instanceof o.ShaderMaterial,l=g.position,h=g.rotation,f=g.scale,i=g.matrix,d=g.quaternion,g.material||(a=new o.MeshFaceMaterial(v.face_materials[g.geometry])),a instanceof o.MeshFaceMaterial&&0===a.materials.length&&(a=new o.MeshFaceMaterial(v.face_materials[g.geometry])),a instanceof o.MeshFaceMaterial)for(var E=0;E<a.materials.length;E++)T=T||a.materials[E]instanceof o.ShaderMaterial;T&&r.computeTangents(),g.skin?x=new o.SkinnedMesh(r,a):g.morph?(x=new o.MorphAnimMesh(r,a),void 0!==g.duration&&(x.duration=g.duration),void 0!==g.time&&(x.time=g.time),void 0!==g.mirroredLoop&&(x.mirroredLoop=g.mirroredLoop),a.morphNormals&&r.computeMorphNormals()):x=new o.Mesh(r,a),x.name=m,i?(x.matrixAutoUpdate=!1,x.matrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])):(x.position.set(l[0],l[1],l[2]),d?(x.quaternion.set(d[0],d[1],d[2],d[3]),x.useQuaternion=!0):x.rotation.set(h[0],h[1],h[2]),x.scale.set(f[0],f[1],f[2])),x.visible=g.visible,x.castShadow=g.castShadow,x.receiveShadow=g.receiveShadow,e.add(x),v.objects[m]=x}}else"DirectionalLight"===g.type||"PointLight"===g.type||"AmbientLight"===g.type?(p=void 0!==g.color?g.color:16777215,u=void 0!==g.intensity?g.intensity:1,"DirectionalLight"===g.type?(l=g.direction,c=new o.DirectionalLight(p,u),c.position.set(l[0],l[1],l[2]),g.target&&(_.push({object:c,targetName:g.target}),c.target=null)):"PointLight"===g.type?(l=g.position,s=g.distance,c=new o.PointLight(p,u,s),c.position.set(l[0],l[1],l[2])):"AmbientLight"===g.type&&(c=new o.AmbientLight(p)),e.add(c),c.name=m,v.lights[m]=c,v.objects[m]=c):"PerspectiveCamera"===g.type||"OrthographicCamera"===g.type?("PerspectiveCamera"===g.type?n=new o.PerspectiveCamera(g.fov,g.aspect,g.near,g.far):"OrthographicCamera"===g.type&&(n=new o.OrthographicCamera(g.left,g.right,g.top,g.bottom,g.near,g.far)),l=g.position,n.position.set(l[0],l[1],l[2]),e.add(n),n.name=m,v.cameras[m]=n,v.objects[m]=n):(l=g.position,h=g.rotation,f=g.scale,d=g.quaternion,x=new o.Object3D,x.name=m,x.position.set(l[0],l[1],l[2]),d?(x.quaternion.set(d[0],d[1],d[2],d[3]),x.useQuaternion=!0):x.rotation.set(h[0],h[1],h[2]),x.scale.set(f[0],f[1],f[2]),x.visible=void 0!==g.visible&&g.visible,e.add(x),v.objects[m]=x,v.empties[m]=x);if(x){if(void 0!==g.properties)for(var L in g.properties){var R=g.properties[L];x.properties[L]=R}if(void 0!==g.groups)for(E=0;E<g.groups.length;E++){var D=g.groups[E];void 0===v.groups[D]&&(v.groups[D]=[]),v.groups[D].push(m)}void 0!==g.children&&P(x,g.children)}}}function L(e,t,i){v.geometries[i]=e,v.face_materials[i]=t,E()}function R(e,t,i,r,a){var o=a.position,n=a.rotation,s=a.quaternion,l=a.scale;e.position.set(o[0],o[1],o[2]),s?(e.quaternion.set(s[0],s[1],s[2],s[3]),e.useQuaternion=!0):e.rotation.set(n[0],n[1],n[2]),e.scale.set(l[0],l[1],l[2]),r&&e.traverse((function(e){e.material=r}));var h=void 0===a.visible||a.visible;e.traverse((function(e){e.visible=h})),i.add(e),e.name=t,v.objects[t]=e,E()}function D(e){return function(t,i){L(t,i,e),f-=1,y.onLoadComplete(),z()}}function F(e,t,i,r){return function(a){var o;o=a.content?a.content:a.dae?a.scene:a,R(o,e,t,i,r),f-=1,y.onLoadComplete(),z()}}function U(e){return function(t,i){v.geometries[e]=t,v.face_materials[e]=i}}function z(){var e={totalModels:m,totalTextures:g,loadedModels:m-f,loadedTextures:g-d};y.callbackProgress(e,v),y.onLoadProgress(),0===f&&0===d&&(V(),t(v))}function V(){for(var e=0;e<_.length;e++){var t=_[e],i=v.objects[t.targetName];i?t.object.target=i:(t.object.target=new o.Object3D,v.scene.add(t.object.target)),t.object.target.properties.targetInverse=t.object}}var B,N,O,I,k,G,H,W,j,X,Y,q=function(e){d-=e,z(),y.onLoadComplete()},K=function(e){return function(){q(e)}};for(B in w.fogs)N=w.fogs[B],"linear"===N.type?s=new o.Fog(0,N.near,N.far):"exp2"===N.type&&(s=new o.FogExp2(0,N.density)),h=N.color,s.color.setRGB(h[0],h[1],h[2]),v.fogs[B]=s;for(O in w.geometries)I=w.geometries[O],I.type in this.geometryHandlerMap&&(f+=1,y.onLoadStart());for(k in w.objects)G=w.objects[k],G.type&&G.type in this.hierarchyHandlerMap&&(f+=1,y.onLoadStart());for(O in m=f,w.geometries)if(I=w.geometries[O],"cube"===I.type)r=new o.CubeGeometry(I.width,I.height,I.depth,I.widthSegments,I.heightSegments,I.depthSegments),v.geometries[O]=r;else if("plane"===I.type)r=new o.PlaneGeometry(I.width,I.height,I.widthSegments,I.heightSegments),v.geometries[O]=r;else if("sphere"===I.type)r=new o.SphereGeometry(I.radius,I.widthSegments,I.heightSegments),v.geometries[O]=r;else if("cylinder"===I.type)r=new o.CylinderGeometry(I.topRad,I.botRad,I.height,I.radSegs,I.heightSegs),v.geometries[O]=r;else if("torus"===I.type)r=new o.TorusGeometry(I.radius,I.tube,I.segmentsR,I.segmentsT),v.geometries[O]=r;else if("icosahedron"===I.type)r=new o.IcosahedronGeometry(I.radius,I.subdivisions),v.geometries[O]=r;else if(I.type in this.geometryHandlerMap){var Q={};for(var Z in I)"type"!==Z&&"url"!==Z&&(Q[Z]=I[Z]);var J=this.geometryHandlerMap[I.type]["loaderObject"];J.load(C(I.url,w.urlBaseType),D(O),Q)}else if("embedded"===I.type){var $=w.embeds[I.id],ee="";if($.metadata=w.metadata,$){var te=this.geometryHandlerMap["ascii"]["loaderObject"];te.createModel($,U(O),ee)}}for(H in w.textures)if(W=w.textures[H],W.url instanceof Array){d+=W.url.length;for(var ie=0;ie<W.url.length;ie++)y.onLoadStart()}else d+=1,y.onLoadStart();for(H in g=d,w.textures){if(W=w.textures[H],void 0!==W.mapping&&void 0!==o[W.mapping]&&(W.mapping=new o[W.mapping]),W.url instanceof Array){for(var re=W.url.length,ae=[],oe=0;oe<re;oe++)ae[oe]=C(W.url[oe],w.urlBaseType);var ne=ae[0].endsWith(".dds");l=ne?o.ImageUtils.loadCompressedTextureCube(ae,W.mapping,K(re)):o.ImageUtils.loadTextureCube(ae,W.mapping,K(re))}else{ne=W.url.toLowerCase().endsWith(".dds");var se=C(W.url,w.urlBaseType),le=K(1);if(l=ne?o.ImageUtils.loadCompressedTexture(se,W.mapping,le):o.ImageUtils.loadTexture(se,W.mapping,le),void 0!==o[W.minFilter]&&(l.minFilter=o[W.minFilter]),void 0!==o[W.magFilter]&&(l.magFilter=o[W.magFilter]),W.anisotropy&&(l.anisotropy=W.anisotropy),W.repeat&&(l.repeat.set(W.repeat[0],W.repeat[1]),1!==W.repeat[0]&&(l.wrapS=o.RepeatWrapping),1!==W.repeat[1]&&(l.wrapT=o.RepeatWrapping)),W.offset&&l.offset.set(W.offset[0],W.offset[1]),W.wrap){var he={repeat:o.RepeatWrapping,mirror:o.MirroredRepeatWrapping};void 0!==he[W.wrap[0]]&&(l.wrapS=he[W.wrap[0]]),void 0!==he[W.wrap[1]]&&(l.wrapT=he[W.wrap[1]])}}v.textures[H]=l}for(j in w.materials){for(Y in X=w.materials[j],X.parameters)if("envMap"===Y||"map"===Y||"lightMap"===Y||"bumpMap"===Y)X.parameters[Y]=v.textures[X.parameters[Y]];else if("shading"===Y)X.parameters[Y]="flat"===X.parameters[Y]?o.FlatShading:o.SmoothShading;else if("side"===Y)"double"==X.parameters[Y]?X.parameters[Y]=o.DoubleSide:"back"==X.parameters[Y]?X.parameters[Y]=o.BackSide:X.parameters[Y]=o.FrontSide;else if("blending"===Y)X.parameters[Y]=X.parameters[Y]in o?o[X.parameters[Y]]:o.NormalBlending;else if("combine"===Y)X.parameters[Y]=X.parameters[Y]in o?o[X.parameters[Y]]:o.MultiplyOperation;else if("vertexColors"===Y)"face"==X.parameters[Y]?X.parameters[Y]=o.FaceColors:X.parameters[Y]&&(X.parameters[Y]=o.VertexColors);else if("wrapRGB"===Y){var ce=X.parameters[Y];X.parameters[Y]=new o.Vector3(ce[0],ce[1],ce[2])}if(void 0!==X.parameters.opacity&&X.parameters.opacity<1&&(X.parameters.transparent=!0),X.parameters.normalMap){var pe=o.ShaderLib["normalmap"],ue=o.UniformsUtils.clone(pe.uniforms),fe=X.parameters.color,de=X.parameters.specular,me=X.parameters.ambient,ge=X.parameters.shininess;ue["tNormal"].value=v.textures[X.parameters.normalMap],X.parameters.normalScale&&ue["uNormalScale"].value.set(X.parameters.normalScale[0],X.parameters.normalScale[1]),X.parameters.map&&(ue["tDiffuse"].value=X.parameters.map,ue["enableDiffuse"].value=!0),X.parameters.envMap&&(ue["tCube"].value=X.parameters.envMap,ue["enableReflection"].value=!0,ue["uReflectivity"].value=X.parameters.reflectivity),X.parameters.lightMap&&(ue["tAO"].value=X.parameters.lightMap,ue["enableAO"].value=!0),X.parameters.specularMap&&(ue["tSpecular"].value=v.textures[X.parameters.specularMap],ue["enableSpecular"].value=!0),X.parameters.displacementMap&&(ue["tDisplacement"].value=v.textures[X.parameters.displacementMap],ue["enableDisplacement"].value=!0,ue["uDisplacementBias"].value=X.parameters.displacementBias,ue["uDisplacementScale"].value=X.parameters.displacementScale),ue["uDiffuseColor"].value.setHex(fe),ue["uSpecularColor"].value.setHex(de),ue["uAmbientColor"].value.setHex(me),ue["uShininess"].value=ge,X.parameters.opacity&&(ue["uOpacity"].value=X.parameters.opacity);var ve={fragmentShader:pe.fragmentShader,vertexShader:pe.vertexShader,uniforms:ue,lights:!0,fog:!0};a=new o.ShaderMaterial(ve)}else a=new o[X.type](X.parameters);v.materials[j]=a}for(j in w.materials)if(X=w.materials[j],X.parameters.materials){var ye=[];for(oe=0;oe<X.parameters.materials.length;oe++){var xe=X.parameters.materials[oe];ye.push(v.materials[xe])}v.materials[j].materials=ye}E(),v.cameras&&w.defaults.camera&&(v.currentCamera=v.cameras[w.defaults.camera]),v.fogs&&w.defaults.fog&&(v.scene.fog=v.fogs[w.defaults.fog]),y.callbackSync(v),z()},o.TextureLoader=function(){o.EventDispatcher.call(this),this.crossOrigin=null},o.TextureLoader.prototype={constructor:o.TextureLoader,load:function(e){var t=this,i=new Image;i.addEventListener("load",(function(){var e=new o.Texture(i);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})}),!1),i.addEventListener("error",(function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})}),!1),t.crossOrigin&&(i.crossOrigin=t.crossOrigin),i.src=e}},o.Material=function(){o.EventDispatcher.call(this),this.id=o.MaterialIdCount++,this.name="",this.side=o.FrontSide,this.opacity=1,this.transparent=!1,this.blending=o.NormalBlending,this.blendSrc=o.SrcAlphaFactor,this.blendDst=o.OneMinusSrcAlphaFactor,this.blendEquation=o.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},o.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var r=this[t];r instanceof o.Color&&i instanceof o.Color?r.copy(i):r instanceof o.Color?r.set(i):r instanceof o.Vector3&&i instanceof o.Vector3?r.copy(i):this[t]=i}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},o.Material.prototype.clone=function(e){return void 0===e&&(e=new o.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},o.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},o.MaterialIdCount=0,o.LineBasicMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.LineBasicMaterial.prototype=Object.create(o.Material.prototype),o.LineBasicMaterial.prototype.clone=function(){var e=new o.LineBasicMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},o.LineDashedMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.LineDashedMaterial.prototype=Object.create(o.Material.prototype),o.LineDashedMaterial.prototype.clone=function(){var e=new o.LineDashedMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},o.MeshBasicMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},o.MeshBasicMaterial.prototype=Object.create(o.Material.prototype),o.MeshBasicMaterial.prototype.clone=function(){var e=new o.MeshBasicMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},o.MeshLambertMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.ambient=new o.Color(16777215),this.emissive=new o.Color(0),this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.MeshLambertMaterial.prototype=Object.create(o.Material.prototype),o.MeshLambertMaterial.prototype.clone=function(){var e=new o.MeshLambertMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},o.MeshPhongMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.ambient=new o.Color(16777215),this.emissive=new o.Color(0),this.specular=new o.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.MeshPhongMaterial.prototype=Object.create(o.Material.prototype),o.MeshPhongMaterial.prototype.clone=function(){var e=new o.MeshPhongMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},o.MeshDepthMaterial=function(e){o.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},o.MeshDepthMaterial.prototype=Object.create(o.Material.prototype),o.MeshDepthMaterial.prototype.clone=function(){var e=new o.LineBasicMaterial;return o.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},o.MeshNormalMaterial=function(e){o.Material.call(this,e),this.shading=o.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},o.MeshNormalMaterial.prototype=Object.create(o.Material.prototype),o.MeshNormalMaterial.prototype.clone=function(){var e=new o.MeshNormalMaterial;return o.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},o.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},o.MeshFaceMaterial.prototype.clone=function(){return new o.MeshFaceMaterial(this.materials.slice(0))},o.ParticleBasicMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.ParticleBasicMaterial.prototype=Object.create(o.Material.prototype),o.ParticleBasicMaterial.prototype.clone=function(){var e=new o.ParticleBasicMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},o.ParticleCanvasMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.program=function(e,t){},this.setValues(e)},o.ParticleCanvasMaterial.prototype=Object.create(o.Material.prototype),o.ParticleCanvasMaterial.prototype.clone=function(){var e=new o.ParticleCanvasMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},o.ShaderMaterial=function(e){o.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.ShaderMaterial.prototype=Object.create(o.Material.prototype),o.ShaderMaterial.prototype.clone=function(){var e=new o.ShaderMaterial;return o.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=o.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},o.SpriteMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.map=new o.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=o.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new o.Vector2(0,0),this.uvScale=new o.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},o.SpriteMaterial.prototype=Object.create(o.Material.prototype),o.SpriteMaterial.prototype.clone=function(){var e=new o.SpriteMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},o.SpriteAlignment={},o.SpriteAlignment.topLeft=new o.Vector2(1,-1),o.SpriteAlignment.topCenter=new o.Vector2(0,-1),o.SpriteAlignment.topRight=new o.Vector2(-1,-1),o.SpriteAlignment.centerLeft=new o.Vector2(1,0),o.SpriteAlignment.center=new o.Vector2(0,0),o.SpriteAlignment.centerRight=new o.Vector2(-1,0),o.SpriteAlignment.bottomLeft=new o.Vector2(1,1),o.SpriteAlignment.bottomCenter=new o.Vector2(0,1),o.SpriteAlignment.bottomRight=new o.Vector2(-1,1),o.Texture=function(e,t,i,r,a,n,s,l,h){o.EventDispatcher.call(this),this.id=o.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new o.UVMapping,this.wrapS=void 0!==i?i:o.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:o.ClampToEdgeWrapping,this.magFilter=void 0!==a?a:o.LinearFilter,this.minFilter=void 0!==n?n:o.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==s?s:o.RGBAFormat,this.type=void 0!==l?l:o.UnsignedByteType,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},o.Texture.prototype={constructor:o.Texture,clone:function(e){return void 0===e&&(e=new o.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.TextureIdCount=0,o.CompressedTexture=function(e,t,i,r,a,n,s,l,h,c,p){o.Texture.call(this,null,n,s,l,h,c,r,a,p),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},o.CompressedTexture.prototype=Object.create(o.Texture.prototype),o.CompressedTexture.prototype.clone=function(){var e=new o.CompressedTexture;return o.Texture.prototype.clone.call(this,e),e},o.DataTexture=function(e,t,i,r,a,n,s,l,h,c,p){o.Texture.call(this,null,n,s,l,h,c,r,a,p),this.image={data:e,width:t,height:i}},o.DataTexture.prototype=Object.create(o.Texture.prototype),o.DataTexture.prototype.clone=function(){var e=new o.DataTexture;return o.Texture.prototype.clone.call(this,e),e},o.Particle=function(e){o.Object3D.call(this),this.material=e},o.Particle.prototype=Object.create(o.Object3D.prototype),o.Particle.prototype.clone=function(e){return void 0===e&&(e=new o.Particle(this.material)),o.Object3D.prototype.clone.call(this,e),e},o.ParticleSystem=function(e,t){o.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new o.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},o.ParticleSystem.prototype=Object.create(o.Object3D.prototype),o.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new o.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,o.Object3D.prototype.clone.call(this,e),e},o.Line=function(e,t,i){o.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new o.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:o.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},o.LineStrip=0,o.LinePieces=1,o.Line.prototype=Object.create(o.Object3D.prototype),o.Line.prototype.clone=function(e){return void 0===e&&(e=new o.Line(this.geometry,this.material,this.type)),o.Object3D.prototype.clone.call(this,e),e},o.Mesh=function(e,t){o.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new o.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),void 0!==this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},o.Mesh.prototype=Object.create(o.Object3D.prototype),o.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},o.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},o.Mesh.prototype.clone=function(e){return void 0===e&&(e=new o.Mesh(this.geometry,this.material)),o.Object3D.prototype.clone.call(this,e),e},o.Bone=function(e){o.Object3D.call(this),this.skin=e,this.skinMatrix=new o.Matrix4},o.Bone.prototype=Object.create(o.Object3D.prototype),o.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,r=this.children.length;for(i=0;i<r;i++)this.children[i].update(this.skinMatrix,t)},o.SkinnedMesh=function(e,t,i){var r,a,n,s,l,h;if(o.Mesh.call(this,e,t),this.useVertexTexture=void 0===i||i,this.identityMatrix=new o.Matrix4,this.bones=[],this.boneMatrices=[],this.geometry&&void 0!==this.geometry.bones){for(r=0;r<this.geometry.bones.length;r++)n=this.geometry.bones[r],s=n.pos,l=n.rotq,h=n.scl,a=this.addBone(),a.name=n.name,a.position.set(s[0],s[1],s[2]),a.quaternion.set(l[0],l[1],l[2],l[3]),a.useQuaternion=!0,void 0!==h?a.scale.set(h[0],h[1],h[2]):a.scale.set(1,1,1);for(r=0;r<this.bones.length;r++)n=this.geometry.bones[r],a=this.bones[r],-1===n.parent?this.add(a):this.bones[n.parent].add(a);var c,p=this.bones.length;if(this.useVertexTexture)c=p>256?64:p>64?32:p>16?16:8,this.boneTextureWidth=c,this.boneTextureHeight=c,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new o.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,o.RGBAFormat,o.FloatType),this.boneTexture.minFilter=o.NearestFilter,this.boneTexture.magFilter=o.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1;else this.boneMatrices=new Float32Array(16*p);this.pose()}},o.SkinnedMesh.prototype=Object.create(o.Mesh.prototype),o.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new o.Bone(this)),this.bones.push(e),e},o.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++){var r=this.children[t];r instanceof o.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var a=0,n=this.bones.length;a<n;a++){var s=new o.Matrix4;s.getInverse(this.bones[a].skinMatrix),this.boneInverses.push(s)}}for(a=0,n=this.bones.length;a<n;a++)o.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[a].skinMatrix,this.boneInverses[a]),o.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*a);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},o.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();i!==1/0?t.multiplyScalar(i):t.set(1)}},o.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new o.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),o.Mesh.prototype.clone.call(this,e),e},o.SkinnedMesh.offsetMatrix=new o.Matrix4,o.MorphAnimMesh=function(e,t){o.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},o.MorphAnimMesh.prototype=Object.create(o.Mesh.prototype),o.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},o.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},o.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},o.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,r=/([a-z]+)(\d+)/,a=0,o=e.morphTargets.length;a<o;a++){var n=e.morphTargets[a],s=n.name.match(r);if(s&&s.length>1){var l=s[1];s[2];i[l]||(i[l]={start:1/0,end:-1/0});var h=i[l];a<h.start&&(h.start=a),a>h.end&&(h.end=a),t||(t=l)}}e.firstAnimation=t},o.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},o.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=(i.end-i.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},o.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+o.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var r=this.time%t/t;this.directionBackwards&&(r=1-r),this.morphTargetInfluences[this.currentKeyframe]=r,this.morphTargetInfluences[this.lastKeyframe]=1-r},o.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new o.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,o.Mesh.prototype.clone.call(this,e),e},o.Ribbon=function(e,t){o.Object3D.call(this),this.geometry=e,this.material=t},o.Ribbon.prototype=Object.create(o.Object3D.prototype),o.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new o.Ribbon(this.geometry,this.material)),o.Object3D.prototype.clone.call(this,e),e},o.LOD=function(){o.Object3D.call(this),this.LODs=[]},o.LOD.prototype=Object.create(o.Object3D.prototype),o.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.LODs.length;i++)if(t<this.LODs[i].visibleAtDistance)break;this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e}),this.add(e)},o.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld);var t=e.matrixWorldInverse,i=-(t.elements[2]*this.matrixWorld.elements[12]+t.elements[6]*this.matrixWorld.elements[13]+t.elements[10]*this.matrixWorld.elements[14]+t.elements[14]);this.LODs[0].object3D.visible=!0;for(var r=1;r<this.LODs.length;r++){if(!(i>=this.LODs[r].visibleAtDistance))break;this.LODs[r-1].object3D.visible=!1,this.LODs[r].object3D.visible=!0}for(;r<this.LODs.length;r++)this.LODs[r].object3D.visible=!1}},o.LOD.prototype.clone=function(){},o.Sprite=function(e){o.Object3D.call(this),this.material=void 0!==e?e:new o.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},o.Sprite.prototype=Object.create(o.Object3D.prototype),o.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},o.Sprite.prototype.clone=function(e){return void 0===e&&(e=new o.Sprite(this.material)),o.Object3D.prototype.clone.call(this,e),e},o.Scene=function(){o.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},o.Scene.prototype=Object.create(o.Object3D.prototype),o.Scene.prototype.__addObject=function(e){if(e instanceof o.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof o.Camera||e instanceof o.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var i=0;i<e.children.length;i++)this.__addObject(e.children[i])},o.Scene.prototype.__removeObject=function(e){if(e instanceof o.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else if(!(e instanceof o.Camera)){t=this.__objects.indexOf(e);if(-1!==t){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var i=this.__objectsAdded.indexOf(e);-1!==i&&this.__objectsAdded.splice(i,1)}}for(var r=0;r<e.children.length;r++)this.__removeObject(e.children[r])},o.Fog=function(e,t,i){this.name="",this.color=new o.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},o.Fog.prototype.clone=function(){return new o.Fog(this.color.getHex(),this.near,this.far)},o.FogExp2=function(e,t){this.name="",this.color=new o.Color(e),this.density=void 0!==t?t:25e-5},o.FogExp2.prototype.clone=function(){return new o.FogExp2(this.color.getHex(),this.density)},o.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",o.REVISION),e=e||{};var t,i,a,n,s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C,E,P,L,R,D,F,U,z,V,B,N,O,I,k,G=this,H=new o.Projector,W=void 0!==e.canvas?e.canvas:document.createElement("canvas"),j=W.getContext("2d"),X=new o.Color(0),Y=0,q=1,K=0,Q=null,Z=null,J=null,$=null,ee=null,te=new o.RenderableVertex,ie=new o.RenderableVertex,re=new o.Color,ae=new o.Color,oe=new o.Color,ne=new o.Color,se=new o.Color,le=new o.Color,he=new o.Color,ce=new o.Color,pe={},ue={},fe=new o.Box2,de=new o.Box2,me=new o.Box2,ge=!1,ve=new o.Color,ye=new o.Color,xe=new o.Color,_e=(Math.PI,new o.Vector3),we=16;function be(e){q!==e&&(j.globalAlpha=e,q=e)}function Se(e){K!==e&&(e===o.NormalBlending?j.globalCompositeOperation="source-over":e===o.AdditiveBlending?j.globalCompositeOperation="lighter":e===o.SubtractiveBlending&&(j.globalCompositeOperation="darker"),K=e)}function Me(e){J!==e&&(j.lineWidth=e,J=e)}function Ae(e){$!==e&&(j.lineCap=e,$=e)}function Te(e){ee!==e&&(j.lineJoin=e,ee=e)}function Ce(e){Q!==e&&(j.strokeStyle=e,Q=e)}function Ee(e){Z!==e&&(j.fillStyle=e,Z=e)}V=document.createElement("canvas"),V.width=V.height=2,B=V.getContext("2d"),B.fillStyle="rgba(0,0,0,1)",B.fillRect(0,0,2,2),N=B.getImageData(0,0,2,2),O=N.data,I=document.createElement("canvas"),I.width=I.height=we,k=I.getContext("2d"),k.translate(-we/2,-we/2),k.scale(we,we),we--,this.domElement=W,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==r.devicePixelRatio?r.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t){n=e*this.devicePixelRatio,s=t*this.devicePixelRatio,l=Math.floor(n/2),h=Math.floor(s/2),W.width=n,W.height=s,W.style.width=e+"px",W.style.height=t+"px",fe.set(new o.Vector2(-l,-h),new o.Vector2(l,h)),de.set(new o.Vector2(-l,-h),new o.Vector2(l,h)),q=1,K=0,Q=null,Z=null,J=null,$=null,ee=null},this.setClearColor=function(e,t){X.copy(e),Y=void 0!==t?t:1,de.set(new o.Vector2(-l,-h),new o.Vector2(l,h))},this.setClearColorHex=function(e,t){X.setHex(e),Y=void 0!==t?t:1,de.set(new o.Vector2(-l,-h),new o.Vector2(l,h))},this.getMaxAnisotropy=function(){return 0},this.clear=function(){j.setTransform(1,0,0,-1,l,h),!1===de.empty()&&(de.intersect(fe),de.expandByScalar(2),Y<1&&j.clearRect(0|de.min.x,0|de.min.y,de.max.x-de.min.x|0,de.max.y-de.min.y|0),Y>0&&(Se(o.NormalBlending),be(1),Ee("rgba("+Math.floor(255*X.r)+","+Math.floor(255*X.g)+","+Math.floor(255*X.b)+","+Y+")"),j.fillRect(0|de.min.x,0|de.min.y,de.max.x-de.min.x|0,de.max.y-de.min.y|0)),de.makeEmpty())},this.render=function(e,r){if(r instanceof o.Camera!==!1){!0===this.autoClear&&this.clear(),j.setTransform(1,0,0,-1,l,h),G.info.render.vertices=0,G.info.render.faces=0,t=H.projectScene(e,r,this.sortObjects,this.sortElements),i=t.elements,a=t.lights,ge=a.length>0,!0===ge&&Y();for(var n=0,s=i.length;n<s;n++){var W=i[n],X=W.material;if(void 0!==X&&!1!==X.visible){if(me.makeEmpty(),W instanceof o.RenderableParticle)c=W,c.x*=l,c.y*=h,K(c,W,X,e);else if(W instanceof o.RenderableLine)c=W.v1,p=W.v2,c.positionScreen.x*=l,c.positionScreen.y*=h,p.positionScreen.x*=l,p.positionScreen.y*=h,me.setFromPoints([c.positionScreen,p.positionScreen]),!0===fe.isIntersectionBox(me)&&Q(c,p,W,X,e);else if(W instanceof o.RenderableFace3){if(c=W.v1,p=W.v2,u=W.v3,c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(p.positionScreen.z<-1||p.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;c.positionScreen.x*=l,c.positionScreen.y*=h,p.positionScreen.x*=l,p.positionScreen.y*=h,u.positionScreen.x*=l,u.positionScreen.y*=h,!0===X.overdraw&&(Ue(c.positionScreen,p.positionScreen),Ue(p.positionScreen,u.positionScreen),Ue(u.positionScreen,c.positionScreen)),me.setFromPoints([c.positionScreen,p.positionScreen,u.positionScreen]),Z(c,p,u,0,1,2,W,X,e)}else if(W instanceof o.RenderableFace4){if(c=W.v1,p=W.v2,u=W.v3,f=W.v4,c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(p.positionScreen.z<-1||p.positionScreen.z>1)continue;if(u.positionScreen.z<-1||u.positionScreen.z>1)continue;if(f.positionScreen.z<-1||f.positionScreen.z>1)continue;c.positionScreen.x*=l,c.positionScreen.y*=h,p.positionScreen.x*=l,p.positionScreen.y*=h,u.positionScreen.x*=l,u.positionScreen.y*=h,f.positionScreen.x*=l,f.positionScreen.y*=h,te.positionScreen.copy(p.positionScreen),ie.positionScreen.copy(f.positionScreen),!0===X.overdraw&&(Ue(c.positionScreen,p.positionScreen),Ue(p.positionScreen,f.positionScreen),Ue(f.positionScreen,c.positionScreen),Ue(u.positionScreen,te.positionScreen),Ue(u.positionScreen,ie.positionScreen)),me.setFromPoints([c.positionScreen,p.positionScreen,u.positionScreen,f.positionScreen]),J(c,p,u,f,te,ie,W,X,e)}de.union(me)}}j.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");function Y(){ve.setRGB(0,0,0),ye.setRGB(0,0,0),xe.setRGB(0,0,0);for(var e=0,t=a.length;e<t;e++){var i=a[e],r=i.color;i instanceof o.AmbientLight?ve.add(r):i instanceof o.DirectionalLight?ye.add(r):i instanceof o.PointLight&&xe.add(r)}}function q(e,t,i){for(var r=0,n=a.length;r<n;r++){var s=a[r];if(ce.copy(s.color),s instanceof o.DirectionalLight){var l=s.matrixWorld.getPosition().normalize(),h=t.dot(l);if(h<=0)continue;h*=s.intensity,i.add(ce.multiplyScalar(h))}else if(s instanceof o.PointLight){l=s.matrixWorld.getPosition(),h=t.dot(_e.subVectors(l,e).normalize());if(h<=0)continue;if(h*=0==s.distance?1:1-Math.min(e.distanceTo(l)/s.distance,1),0==h)continue;h*=s.intensity,i.add(ce.multiplyScalar(h))}}}function K(e,t,i,r){var a,n,s,c,p,u,f;if(be(i.opacity),Se(i.blending),i instanceof o.ParticleBasicMaterial)if(null===i.map){if(s=t.object.scale.x,c=t.object.scale.y,s*=t.scale.x*l,c*=t.scale.y*h,me.min.set(e.x-s,e.y-c),me.max.set(e.x+s,e.y+c),!1===fe.isIntersectionBox(me))return;Ee(i.color.getStyle()),j.save(),j.translate(e.x,e.y),j.rotate(-t.rotation),j.scale(s,c),j.fillRect(-1,-1,2,2),j.restore()}else{if(p=i.map.image,u=p.width>>1,f=p.height>>1,s=t.scale.x*l,c=t.scale.y*h,a=s*u,n=c*f,me.min.set(e.x-a,e.y-n),me.max.set(e.x+a,e.y+n),!1===fe.isIntersectionBox(me))return;j.save(),j.translate(e.x,e.y),j.rotate(-t.rotation),j.scale(s,-c),j.translate(-u,-f),j.drawImage(p,0,0),j.restore()}else if(i instanceof o.ParticleCanvasMaterial){if(a=t.scale.x*l,n=t.scale.y*h,me.min.set(e.x-a,e.y-n),me.max.set(e.x+a,e.y+n),!1===fe.isIntersectionBox(me))return;Ce(i.color.getStyle()),Ee(i.color.getStyle()),j.save(),j.translate(e.x,e.y),j.rotate(-t.rotation),j.scale(a,n),i.program(j),j.restore()}}function Q(e,t,i,r,a){be(r.opacity),Se(r.blending),j.beginPath(),j.moveTo(e.positionScreen.x,e.positionScreen.y),j.lineTo(t.positionScreen.x,t.positionScreen.y),r instanceof o.LineBasicMaterial&&(Me(r.linewidth),Ae(r.linecap),Te(r.linejoin),Ce(r.color.getStyle()),j.stroke(),me.expandByScalar(2*r.linewidth))}function Z(e,t,i,a,n,s,l,h,c){if(G.info.render.vertices+=3,G.info.render.faces++,be(h.opacity),Se(h.blending),d=e.positionScreen.x,m=e.positionScreen.y,g=t.positionScreen.x,v=t.positionScreen.y,y=i.positionScreen.x,x=i.positionScreen.y,$(d,m,g,v,y,x),(h instanceof o.MeshLambertMaterial||h instanceof o.MeshPhongMaterial)&&null===h.map&&null===h.map)le.copy(h.color),he.copy(h.emissive),h.vertexColors===o.FaceColors&&le.multiply(l.color),!0===ge?!1===h.wireframe&&h.shading==o.SmoothShading&&3==l.vertexNormalsLength?(ae.copy(ve),oe.copy(ve),ne.copy(ve),q(l.v1.positionWorld,l.vertexNormalsModel[0],ae),q(l.v2.positionWorld,l.vertexNormalsModel[1],oe),q(l.v3.positionWorld,l.vertexNormalsModel[2],ne),ae.multiply(le).add(he),oe.multiply(le).add(he),ne.multiply(le).add(he),se.addColors(oe,ne).multiplyScalar(.5),E=De(ae,oe,ne,se),Re(d,m,g,v,y,x,0,0,1,0,0,1,E)):(re.copy(ve),q(l.centroidModel,l.normalModel,re),re.multiply(le).add(he),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re)):!0===h.wireframe?we(h.color,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(h.color);else if(h instanceof o.MeshBasicMaterial||h instanceof o.MeshLambertMaterial||h instanceof o.MeshPhongMaterial)null!==h.map?h.map.mapping instanceof o.UVMapping&&(P=l.uvs[0],Le(d,m,g,v,y,x,P[a].x,P[a].y,P[n].x,P[n].y,P[s].x,P[s].y,h.map)):null!==h.envMap?h.envMap.mapping instanceof o.SphericalReflectionMapping&&(_e.copy(l.vertexNormalsModelView[a]),L=.5*_e.x+.5,R=.5*_e.y+.5,_e.copy(l.vertexNormalsModelView[n]),D=.5*_e.x+.5,F=.5*_e.y+.5,_e.copy(l.vertexNormalsModelView[s]),U=.5*_e.x+.5,z=.5*_e.y+.5,Le(d,m,g,v,y,x,L,R,D,F,U,z,h.envMap)):(re.copy(h.color),h.vertexColors===o.FaceColors&&re.multiply(l.color),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re));else if(h instanceof o.MeshDepthMaterial){var p;T=r.near,C=r.far,p=1-Fe(e.positionScreen.z*e.positionScreen.w,T,C),ae.setRGB(p,p,p),p=1-Fe(t.positionScreen.z*t.positionScreen.w,T,C),oe.setRGB(p,p,p),p=1-Fe(i.positionScreen.z*i.positionScreen.w,T,C),ne.setRGB(p,p,p),se.addColors(oe,ne).multiplyScalar(.5),E=De(ae,oe,ne,se),Re(d,m,g,v,y,x,0,0,1,0,0,1,E)}else if(h instanceof o.MeshNormalMaterial){var u;h.shading==o.FlatShading?(u=l.normalModelView,re.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re)):h.shading==o.SmoothShading&&(u=l.vertexNormalsModelView[a],ae.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[n],oe.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),u=l.vertexNormalsModelView[s],ne.setRGB(u.x,u.y,u.z).multiplyScalar(.5).addScalar(.5),se.addColors(oe,ne).multiplyScalar(.5),E=De(ae,oe,ne,se),Re(d,m,g,v,y,x,0,0,1,0,0,1,E))}}function J(e,t,i,a,n,s,l,h,c){if(G.info.render.vertices+=4,G.info.render.faces++,be(h.opacity),Se(h.blending),void 0!==h.map&&null!==h.map||void 0!==h.envMap&&null!==h.envMap)return Z(e,t,a,0,1,3,l,h,c),void Z(n,i,s,1,2,3,l,h,c);if(d=e.positionScreen.x,m=e.positionScreen.y,g=t.positionScreen.x,v=t.positionScreen.y,y=i.positionScreen.x,x=i.positionScreen.y,_=a.positionScreen.x,w=a.positionScreen.y,b=n.positionScreen.x,S=n.positionScreen.y,M=s.positionScreen.x,A=s.positionScreen.y,h instanceof o.MeshLambertMaterial||h instanceof o.MeshPhongMaterial)le.copy(h.color),he.copy(h.emissive),h.vertexColors===o.FaceColors&&le.multiply(l.color),!0===ge?!1===h.wireframe&&h.shading==o.SmoothShading&&4==l.vertexNormalsLength?(ae.copy(ve),oe.copy(ve),ne.copy(ve),se.copy(ve),q(l.v1.positionWorld,l.vertexNormalsModel[0],ae),q(l.v2.positionWorld,l.vertexNormalsModel[1],oe),q(l.v4.positionWorld,l.vertexNormalsModel[3],ne),q(l.v3.positionWorld,l.vertexNormalsModel[2],se),ae.multiply(le).add(he),oe.multiply(le).add(he),ne.multiply(le).add(he),se.multiply(le).add(he),E=De(ae,oe,ne,se),$(d,m,g,v,_,w),Re(d,m,g,v,_,w,0,0,1,0,0,1,E),$(b,S,y,x,M,A),Re(b,S,y,x,M,A,1,0,1,1,0,1,E)):(re.copy(ve),q(l.centroidModel,l.normalModel,re),re.multiply(le).add(he),ee(d,m,g,v,y,x,_,w),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re)):(re.addColors(le,he),ee(d,m,g,v,y,x,_,w),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re));else if(h instanceof o.MeshBasicMaterial)re.copy(h.color),h.vertexColors===o.FaceColors&&re.multiply(l.color),ee(d,m,g,v,y,x,_,w),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re);else if(h instanceof o.MeshNormalMaterial){var p;h.shading==o.FlatShading?(p=l.normalModelView,re.setRGB(p.x,p.y,p.z).multiplyScalar(.5).addScalar(.5),ee(d,m,g,v,y,x,_,w),!0===h.wireframe?we(re,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):Pe(re)):h.shading==o.SmoothShading&&(p=l.vertexNormalsModelView[0],ae.setRGB(p.x,p.y,p.z).multiplyScalar(.5).addScalar(.5),p=l.vertexNormalsModelView[1],oe.setRGB(p.x,p.y,p.z).multiplyScalar(.5).addScalar(.5),p=l.vertexNormalsModelView[3],ne.setRGB(p.x,p.y,p.z).multiplyScalar(.5).addScalar(.5),p=l.vertexNormalsModelView[2],se.setRGB(p.x,p.y,p.z).multiplyScalar(.5).addScalar(.5),E=De(ae,oe,ne,se),$(d,m,g,v,_,w),Re(d,m,g,v,_,w,0,0,1,0,0,1,E),$(b,S,y,x,M,A),Re(b,S,y,x,M,A,1,0,1,1,0,1,E))}else h instanceof o.MeshDepthMaterial&&(T=r.near,C=r.far,ae.r=ae.g=ae.b=1-Fe(e.positionScreen.z*e.positionScreen.w,T,C),oe.r=oe.g=oe.b=1-Fe(t.positionScreen.z*t.positionScreen.w,T,C),ne.r=ne.g=ne.b=1-Fe(a.positionScreen.z*a.positionScreen.w,T,C),se.r=se.g=se.b=1-Fe(i.positionScreen.z*i.positionScreen.w,T,C),E=De(ae,oe,ne,se),$(d,m,g,v,_,w),Re(d,m,g,v,_,w,0,0,1,0,0,1,E),$(b,S,y,x,M,A),Re(b,S,y,x,M,A,1,0,1,1,0,1,E))}function $(e,t,i,r,a,o){j.beginPath(),j.moveTo(e,t),j.lineTo(i,r),j.lineTo(a,o),j.closePath()}function ee(e,t,i,r,a,o,n,s){j.beginPath(),j.moveTo(e,t),j.lineTo(i,r),j.lineTo(a,o),j.lineTo(n,s),j.closePath()}function we(e,t,i,r){Me(t),Ae(i),Te(r),Ce(e.getStyle()),j.stroke(),me.expandByScalar(2*t)}function Pe(e){Ee(e.getStyle()),j.fill()}function Le(e,t,i,r,a,n,s,l,h,c,p,u,f){if(!(f instanceof o.DataTexture||void 0===f.image||0==f.image.width)){if(!0===f.needsUpdate){var d=f.wrapS==o.RepeatWrapping,m=f.wrapT==o.RepeatWrapping;pe[f.id]=j.createPattern(f.image,!0===d&&!0===m?"repeat":!0===d&&!1===m?"repeat-x":!1===d&&!0===m?"repeat-y":"no-repeat"),f.needsUpdate=!1}void 0===pe[f.id]?Ee("rgba(0,0,0,1)"):Ee(pe[f.id]);var g,v,y,x,_,w,b,S,M=f.offset.x/f.repeat.x,A=f.offset.y/f.repeat.y,T=f.image.width*f.repeat.x,C=f.image.height*f.repeat.y;if(s=(s+M)*T,l=(1-l+A)*C,h=(h+M)*T,c=(1-c+A)*C,p=(p+M)*T,u=(1-u+A)*C,i-=e,r-=t,a-=e,n-=t,h-=s,c-=l,p-=s,u-=l,b=h*u-p*c,0===b){if(void 0===ue[f.id]){var E=document.createElement("canvas");E.width=f.image.width,E.height=f.image.height;var P=E.getContext("2d");P.drawImage(f.image,0,0),ue[f.id]=P.getImageData(0,0,f.image.width,f.image.height).data}var L=ue[f.id],R=4*(Math.floor(s)+Math.floor(l)*f.image.width);return re.setRGB(L[R]/255,L[R+1]/255,L[R+2]/255),void Pe(re)}S=1/b,g=(u*i-c*a)*S,v=(u*r-c*n)*S,y=(h*a-p*i)*S,x=(h*n-p*r)*S,_=e-g*s-y*l,w=t-v*s-x*l,j.save(),j.transform(g,v,y,x,_,w),j.fill(),j.restore()}}function Re(e,t,i,r,a,o,n,s,l,h,c,p,u){var f,d,m,g,v,y,x,_,w=u.width-1,b=u.height-1;n*=w,s*=b,l*=w,h*=b,c*=w,p*=b,i-=e,r-=t,a-=e,o-=t,l-=n,h-=s,c-=n,p-=s,x=l*p-c*h,_=1/x,f=(p*i-h*a)*_,d=(p*r-h*o)*_,m=(l*a-c*i)*_,g=(l*o-c*r)*_,v=e-f*n-m*s,y=t-d*n-g*s,j.save(),j.transform(f,d,m,g,v,y),j.clip(),j.drawImage(u,0,0),j.restore()}function De(e,t,i,r){return O[0]=255*e.r|0,O[1]=255*e.g|0,O[2]=255*e.b|0,O[4]=255*t.r|0,O[5]=255*t.g|0,O[6]=255*t.b|0,O[8]=255*i.r|0,O[9]=255*i.g|0,O[10]=255*i.b|0,O[12]=255*r.r|0,O[13]=255*r.g|0,O[14]=255*r.b|0,B.putImageData(N,0,0),k.drawImage(V,0,0),I}function Fe(e,t,i){var r=(e-t)/(i-t);return r*r*(3-2*r)}function Ue(e,t){var i,r=t.x-e.x,a=t.y-e.y,o=r*r+a*a;0!==o&&(i=1/Math.sqrt(o),r*=i,a*=i,t.x+=r,t.y+=a,e.x-=r,e.y-=a)}}},o.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},o.UniformsUtils={merge:function(e){var t,i,r,a={};for(t=0;t<e.length;t++)for(i in r=this.clone(e[t]),r)a[i]=r[i];return a},clone:function(e){var t,i,r,a={};for(t in e)for(i in a[t]={},e[t])r=e[t][i],r instanceof o.Color||r instanceof o.Vector2||r instanceof o.Vector3||r instanceof o.Vector4||r instanceof o.Matrix4||r instanceof o.Texture?a[t][i]=r.clone():a[t][i]=r instanceof Array?r.slice():r;return a}},o.UniformsLib={common:{diffuse:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new o.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new o.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},o.ShaderLib={basic:{uniforms:o.UniformsUtils.merge([o.UniformsLib["common"],o.UniformsLib["fog"],o.UniformsLib["shadowmap"]]),vertexShader:[o.ShaderChunk["map_pars_vertex"],o.ShaderChunk["lightmap_pars_vertex"],o.ShaderChunk["envmap_pars_vertex"],o.ShaderChunk["color_pars_vertex"],o.ShaderChunk["morphtarget_pars_vertex"],o.ShaderChunk["skinning_pars_vertex"],o.ShaderChunk["shadowmap_pars_vertex"],"void main() {",o.ShaderChunk["map_vertex"],o.ShaderChunk["lightmap_vertex"],o.ShaderChunk["color_vertex"],o.ShaderChunk["skinbase_vertex"],"#ifdef USE_ENVMAP",o.ShaderChunk["morphnormal_vertex"],o.ShaderChunk["skinnormal_vertex"],o.ShaderChunk["defaultnormal_vertex"],"#endif",o.ShaderChunk["morphtarget_vertex"],o.ShaderChunk["skinning_vertex"],o.ShaderChunk["default_vertex"],o.ShaderChunk["worldpos_vertex"],o.ShaderChunk["envmap_vertex"],o.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",o.ShaderChunk["color_pars_fragment"],o.ShaderChunk["map_pars_fragment"],o.ShaderChunk["lightmap_pars_fragment"],o.ShaderChunk["envmap_pars_fragment"],o.ShaderChunk["fog_pars_fragment"],o.ShaderChunk["shadowmap_pars_fragment"],o.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( diffuse, opacity );",o.ShaderChunk["map_fragment"],o.ShaderChunk["alphatest_fragment"],o.ShaderChunk["specularmap_fragment"],o.ShaderChunk["lightmap_fragment"],o.ShaderChunk["color_fragment"],o.ShaderChunk["envmap_fragment"],o.ShaderChunk["shadowmap_fragment"],o.ShaderChunk["linear_to_gamma_fragment"],o.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:o.UniformsUtils.merge([o.UniformsLib["common"],o.UniformsLib["fog"],o.UniformsLib["lights"],o.UniformsLib["shadowmap"],{ambient:{type:"c",value:new o.Color(16777215)},emissive:{type:"c",value:new o.Color(0)},wrapRGB:{type:"v3",value:new o.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",o.ShaderChunk["map_pars_vertex"],o.ShaderChunk["lightmap_pars_vertex"],o.ShaderChunk["envmap_pars_vertex"],o.ShaderChunk["lights_lambert_pars_vertex"],o.ShaderChunk["color_pars_vertex"],o.ShaderChunk["morphtarget_pars_vertex"],o.ShaderChunk["skinning_pars_vertex"],o.ShaderChunk["shadowmap_pars_vertex"],"void main() {",o.ShaderChunk["map_vertex"],o.ShaderChunk["lightmap_vertex"],o.ShaderChunk["color_vertex"],o.ShaderChunk["morphnormal_vertex"],o.ShaderChunk["skinbase_vertex"],o.ShaderChunk["skinnormal_vertex"],o.ShaderChunk["defaultnormal_vertex"],o.ShaderChunk["morphtarget_vertex"],o.ShaderChunk["skinning_vertex"],o.ShaderChunk["default_vertex"],o.ShaderChunk["worldpos_vertex"],o.ShaderChunk["envmap_vertex"],o.ShaderChunk["lights_lambert_vertex"],o.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",o.ShaderChunk["color_pars_fragment"],o.ShaderChunk["map_pars_fragment"],o.ShaderChunk["lightmap_pars_fragment"],o.ShaderChunk["envmap_pars_fragment"],o.ShaderChunk["fog_pars_fragment"],o.ShaderChunk["shadowmap_pars_fragment"],o.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",o.ShaderChunk["map_fragment"],o.ShaderChunk["alphatest_fragment"],o.ShaderChunk["specularmap_fragment"],"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",o.ShaderChunk["lightmap_fragment"],o.ShaderChunk["color_fragment"],o.ShaderChunk["envmap_fragment"],o.ShaderChunk["shadowmap_fragment"],o.ShaderChunk["linear_to_gamma_fragment"],o.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:o.UniformsUtils.merge([o.UniformsLib["common"],o.UniformsLib["bump"],o.UniformsLib["normalmap"],o.UniformsLib["fog"],o.UniformsLib["lights"],o.UniformsLib["shadowmap"],{ambient:{type:"c",value:new o.Color(16777215)},emissive:{type:"c",value:new o.Color(0)},specular:{type:"c",value:new o.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new o.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",o.ShaderChunk["map_pars_vertex"],o.ShaderChunk["lightmap_pars_vertex"],o.ShaderChunk["envmap_pars_vertex"],o.ShaderChunk["lights_phong_pars_vertex"],o.ShaderChunk["color_pars_vertex"],o.ShaderChunk["morphtarget_pars_vertex"],o.ShaderChunk["skinning_pars_vertex"],o.ShaderChunk["shadowmap_pars_vertex"],"void main() {",o.ShaderChunk["map_vertex"],o.ShaderChunk["lightmap_vertex"],o.ShaderChunk["color_vertex"],o.ShaderChunk["morphnormal_vertex"],o.ShaderChunk["skinbase_vertex"],o.ShaderChunk["skinnormal_vertex"],o.ShaderChunk["defaultnormal_vertex"],"vNormal = normalize( transformedNormal );",o.ShaderChunk["morphtarget_vertex"],o.ShaderChunk["skinning_vertex"],o.ShaderChunk["default_vertex"],"vViewPosition = -mvPosition.xyz;",o.ShaderChunk["worldpos_vertex"],o.ShaderChunk["envmap_vertex"],o.ShaderChunk["lights_phong_vertex"],o.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",o.ShaderChunk["color_pars_fragment"],o.ShaderChunk["map_pars_fragment"],o.ShaderChunk["lightmap_pars_fragment"],o.ShaderChunk["envmap_pars_fragment"],o.ShaderChunk["fog_pars_fragment"],o.ShaderChunk["lights_phong_pars_fragment"],o.ShaderChunk["shadowmap_pars_fragment"],o.ShaderChunk["bumpmap_pars_fragment"],o.ShaderChunk["normalmap_pars_fragment"],o.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",o.ShaderChunk["map_fragment"],o.ShaderChunk["alphatest_fragment"],o.ShaderChunk["specularmap_fragment"],o.ShaderChunk["lights_phong_fragment"],o.ShaderChunk["lightmap_fragment"],o.ShaderChunk["color_fragment"],o.ShaderChunk["envmap_fragment"],o.ShaderChunk["shadowmap_fragment"],o.ShaderChunk["linear_to_gamma_fragment"],o.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:o.UniformsUtils.merge([o.UniformsLib["particle"],o.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",o.ShaderChunk["color_pars_vertex"],o.ShaderChunk["shadowmap_pars_vertex"],"void main() {",o.ShaderChunk["color_vertex"],"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",o.ShaderChunk["worldpos_vertex"],o.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",o.ShaderChunk["color_pars_fragment"],o.ShaderChunk["map_particle_pars_fragment"],o.ShaderChunk["fog_pars_fragment"],o.ShaderChunk["shadowmap_pars_fragment"],"void main() {","gl_FragColor = vec4( psColor, opacity );",o.ShaderChunk["map_particle_fragment"],o.ShaderChunk["alphatest_fragment"],o.ShaderChunk["color_fragment"],o.ShaderChunk["shadowmap_fragment"],o.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:o.UniformsUtils.merge([o.UniformsLib["common"],o.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",o.ShaderChunk["color_pars_vertex"],"void main() {",o.ShaderChunk["color_vertex"],"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",o.ShaderChunk["color_pars_fragment"],o.ShaderChunk["fog_pars_fragment"],"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",o.ShaderChunk["color_fragment"],o.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:o.UniformsUtils.merge([o.UniformsLib["fog"],o.UniformsLib["lights"],o.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new o.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new o.Color(16777215)},uSpecularColor:{type:"c",value:new o.Color(1118481)},uAmbientColor:{type:"c",value:new o.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new o.Vector2(0,0)},uRepeat:{type:"v2",value:new o.Vector2(1,1)},wrapRGB:{type:"v3",value:new o.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",o.ShaderChunk["shadowmap_pars_fragment"],o.ShaderChunk["fog_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",o.ShaderChunk["shadowmap_fragment"],o.ShaderChunk["linear_to_gamma_fragment"],o.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",o.ShaderChunk["skinning_pars_vertex"],o.ShaderChunk["shadowmap_pars_vertex"],"void main() {",o.ShaderChunk["skinbase_vertex"],o.ShaderChunk["skinnormal_vertex"],"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[o.ShaderChunk["morphtarget_pars_vertex"],o.ShaderChunk["skinning_pars_vertex"],"void main() {",o.ShaderChunk["skinbase_vertex"],o.ShaderChunk["morphtarget_vertex"],o.ShaderChunk["skinning_vertex"],o.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},o.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",o.REVISION),e=e||{};var t=void 0!==e.canvas?e.canvas:document.createElement("canvas"),i=void 0!==e.precision?e.precision:"highp",a=void 0===e.alpha||e.alpha,n=void 0===e.premultipliedAlpha||e.premultipliedAlpha,s=void 0!==e.antialias&&e.antialias,l=void 0===e.stencil||e.stencil,h=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.clearColor?new o.Color(e.clearColor):new o.Color(0),p=void 0!==e.clearAlpha?e.clearAlpha:0;this.domElement=t,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==r.devicePixelRatio?r.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=o.PCFShadowMap,this.shadowMapCullFace=o.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var u,f,d,m,g,v=this,y=[],x=0,_=null,w=null,b=-1,S=null,M=null,A=0,T=0,C=-1,E=-1,P=-1,L=-1,R=-1,D=-1,F=-1,U=-1,z=null,V=null,B=null,N=null,O=0,I=0,k=0,G=0,H=0,W=0,j={},X=new o.Frustum,Y=new o.Matrix4,q=new o.Matrix4,K=new o.Vector3,Q=new o.Vector3,Z=!0,J={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};jt(),Xt(),this.context=u;var $=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),ee=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),te=(u.getParameter(u.MAX_TEXTURE_SIZE),u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE)),ie=m?u.getParameter(m.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,re=ee>0,ae=re&&f,oe=(g&&u.getParameter(u.COMPRESSED_TEXTURE_FORMATS),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT)),ne=u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT),se=(u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT)),le=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT),he=(u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_INT),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_INT),u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_INT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_INT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_INT),u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_INT),oe.precision>0&&se.precision>0),ce=ne.precision>0&&le.precision>0;function pe(e){e.__webglVertexBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),v.info.memory.geometries++}function ue(e){e.__webglVertexBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),e.__webglLineDistanceBuffer=u.createBuffer(),v.info.memory.geometries++}function fe(e){e.__webglVertexBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),e.__webglNormalBuffer=u.createBuffer(),v.info.memory.geometries++}function de(e){var t,i;if(e.__webglVertexBuffer=u.createBuffer(),e.__webglNormalBuffer=u.createBuffer(),e.__webglTangentBuffer=u.createBuffer(),e.__webglColorBuffer=u.createBuffer(),e.__webglUVBuffer=u.createBuffer(),e.__webglUV2Buffer=u.createBuffer(),e.__webglSkinIndicesBuffer=u.createBuffer(),e.__webglSkinWeightsBuffer=u.createBuffer(),e.__webglFaceBuffer=u.createBuffer(),e.__webglLineBuffer=u.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;t<i;t++)e.__webglMorphTargetsBuffers.push(u.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;t<i;t++)e.__webglMorphNormalsBuffers.push(u.createBuffer());v.info.memory.geometries++}"highp"!==i||he||(ce?(i="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(i="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==i||ce||(i="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return u},this.supportsVertexTextures=function(){return re},this.supportsFloatTextures=function(){return f},this.supportsStandardDerivatives=function(){return d},this.supportsCompressedTextureS3TC=function(){return g},this.getMaxAnisotropy=function(){return ie},this.getPrecision=function(){return i},this.setSize=function(e,i){t.width=e*this.devicePixelRatio,t.height=i*this.devicePixelRatio,t.style.width=e+"px",t.style.height=i+"px",this.setViewport(0,0,t.width,t.height)},this.setViewport=function(e,i,r,a){O=void 0!==e?e:0,I=void 0!==i?i:0,k=void 0!==r?r:t.width,G=void 0!==a?a:t.height,u.viewport(O,I,k,G)},this.setScissor=function(e,t,i,r){u.scissor(e,t,i,r)},this.enableScissorTest=function(e){e?u.enable(u.SCISSOR_TEST):u.disable(u.SCISSOR_TEST)},this.setClearColorHex=function(e,t){c.setHex(e),p=t,u.clearColor(c.r,c.g,c.b,p)},this.setClearColor=function(e,t){c.copy(e),p=t,u.clearColor(c.r,c.g,c.b,p)},this.getClearColor=function(){return c},this.getClearAlpha=function(){return p},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=u.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=u.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=u.STENCIL_BUFFER_BIT),u.clear(r)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){_=null,P=-1,F=-1,U=-1,S=-1,b=-1,Z=!0,C=-1,E=-1,this.shadowMapPlugin.update(e,t)};var me=function(e){var t=e.target;t.removeEventListener("dispose",me),xe(t),v.info.memory.geometries--},ge=function(e){var t=e.target;t.removeEventListener("dispose",ge),_e(t),v.info.memory.textures--},ve=function(e){var t=e.target;t.removeEventListener("dispose",ve),we(t),v.info.memory.textures--},ye=function(e){var t=e.target;t.removeEventListener("dispose",ye),be(t)},xe=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&u.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&u.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&u.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&u.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&u.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&u.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&u.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&u.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&u.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&u.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&u.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var i=e.geometryGroups[t];if(void 0!==i.numMorphTargets)for(var r=0,a=i.numMorphTargets;r<a;r++)u.deleteBuffer(i.__webglMorphTargetsBuffers[r]);if(void 0!==i.numMorphNormals)for(r=0,a=i.numMorphNormals;r<a;r++)u.deleteBuffer(i.__webglMorphNormalsBuffers[r]);Se(i)}Se(e)},_e=function(e){if(e.image&&e.image.__webglTextureCube)u.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,u.deleteTexture(e.__webglTexture)}},we=function(e){if(e&&e.__webglTexture)if(u.deleteTexture(e.__webglTexture),e instanceof o.WebGLRenderTargetCube)for(var t=0;t<6;t++)u.deleteFramebuffer(e.__webglFramebuffer[t]),u.deleteRenderbuffer(e.__webglRenderbuffer[t]);else u.deleteFramebuffer(e.__webglFramebuffer),u.deleteRenderbuffer(e.__webglRenderbuffer)},be=function(e){var t=e.program;if(void 0!==t){var i,r,a;e.program=void 0;var o=!1;for(i=0,r=y.length;i<r;i++)if(a=y[i],a.program===t){a.usedTimes--,0===a.usedTimes&&(o=!0);break}if(!0===o){var n=[];for(i=0,r=y.length;i<r;i++)a=y[i],a.program!==t&&n.push(a);y=n,u.deleteProgram(t),v.info.memory.programs--}}};function Se(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)u.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function Me(e,t){var i=e.vertices.length,r=t.material;if(r.attributes)for(var a in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),r.attributes){var o=r.attributes[a];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var n=1;"v2"===o.type?n=2:"v3"===o.type?n=3:"v4"===o.type?n=4:"c"===o.type&&(n=3),o.size=n,o.array=new Float32Array(i*n),o.buffer=u.createBuffer(),o.buffer.belongsToAttribute=a,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function Ae(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i,Me(e,t)}function Te(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,Me(e,t)}function Ce(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__normalArray=new Float32Array(3*i),e.__webglVertexCount=i,Me(e,t)}function Ee(e,t){var i,r,a=t.geometry,o=e.faces3,n=e.faces4,s=3*o.length+4*n.length,l=1*o.length+2*n.length,h=3*o.length+4*n.length,c=Pe(t,e),p=Fe(c),f=Re(c),d=De(c);if(e.__vertexArray=new Float32Array(3*s),f&&(e.__normalArray=new Float32Array(3*s)),a.hasTangents&&(e.__tangentArray=new Float32Array(4*s)),d&&(e.__colorArray=new Float32Array(3*s)),p&&((a.faceUvs.length>0||a.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*s)),(a.faceUvs.length>1||a.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*s))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*s),e.__skinWeightArray=new Float32Array(4*s)),e.__faceArray=new Uint16Array(3*l),e.__lineArray=new Uint16Array(2*h),e.numMorphTargets)for(e.__morphTargetsArrays=[],i=0,r=e.numMorphTargets;i<r;i++)e.__morphTargetsArrays.push(new Float32Array(3*s));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],i=0,r=e.numMorphNormals;i<r;i++)e.__morphNormalsArrays.push(new Float32Array(3*s));if(e.__webglFaceCount=3*l,e.__webglLineCount=2*h,c.attributes)for(var m in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),c.attributes){var g=c.attributes[m],v={};for(var y in g)v[y]=g[y];if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=!0;var x=1;"v2"===v.type?x=2:"v3"===v.type?x=3:"v4"===v.type?x=4:"c"===v.type&&(x=3),v.size=x,v.array=new Float32Array(s*x),v.buffer=u.createBuffer(),v.buffer.belongsToAttribute=m,g.needsUpdate=!0,v.__original=g}e.__webglCustomAttributesList.push(v)}e.__inittedArrays=!0}function Pe(e,t){return e.material instanceof o.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function Le(e){return e&&void 0!==e.shading&&e.shading===o.SmoothShading}function Re(e){return!(e instanceof o.MeshBasicMaterial&&!e.envMap||e instanceof o.MeshDepthMaterial)&&(Le(e)?o.SmoothShading:o.FlatShading)}function De(e){return!!e.vertexColors&&e.vertexColors}function Fe(e){return!!(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof o.ShaderMaterial)}function Ue(e){var t,i,r;for(t in e.attributes)r="index"===t?u.ELEMENT_ARRAY_BUFFER:u.ARRAY_BUFFER,i=e.attributes[t],i.buffer=u.createBuffer(),u.bindBuffer(r,i.buffer),u.bufferData(r,i.array,u.STATIC_DRAW)}function ze(e,t,i){var r,a,o,n,s,l,h,c,p,f,d,m,g=e.vertices,v=g.length,y=e.colors,x=y.length,_=e.__vertexArray,w=e.__colorArray,b=e.__sortArray,S=e.verticesNeedUpdate,M=(e.elementsNeedUpdate,e.colorsNeedUpdate),A=e.__webglCustomAttributesList;if(i.sortParticles){for(q.copy(Y),q.multiply(i.matrixWorld),r=0;r<v;r++)o=g[r],K.copy(o),K.applyProjection(q),b[r]=[K.z,r];for(b.sort(We),r=0;r<v;r++)o=g[b[r][1]],n=3*r,_[n]=o.x,_[n+1]=o.y,_[n+2]=o.z;for(a=0;a<x;a++)n=3*a,l=y[b[a][1]],w[n]=l.r,w[n+1]=l.g,w[n+2]=l.b;if(A)for(h=0,c=A.length;h<c;h++)if(m=A[h],void 0===m.boundTo||"vertices"===m.boundTo)if(n=0,f=m.value.length,1===m.size)for(p=0;p<f;p++)s=b[p][1],m.array[p]=m.value[s];else if(2===m.size)for(p=0;p<f;p++)s=b[p][1],d=m.value[s],m.array[n]=d.x,m.array[n+1]=d.y,n+=2;else if(3===m.size)if("c"===m.type)for(p=0;p<f;p++)s=b[p][1],d=m.value[s],m.array[n]=d.r,m.array[n+1]=d.g,m.array[n+2]=d.b,n+=3;else for(p=0;p<f;p++)s=b[p][1],d=m.value[s],m.array[n]=d.x,m.array[n+1]=d.y,m.array[n+2]=d.z,n+=3;else if(4===m.size)for(p=0;p<f;p++)s=b[p][1],d=m.value[s],m.array[n]=d.x,m.array[n+1]=d.y,m.array[n+2]=d.z,m.array[n+3]=d.w,n+=4}else{if(S)for(r=0;r<v;r++)o=g[r],n=3*r,_[n]=o.x,_[n+1]=o.y,_[n+2]=o.z;if(M)for(a=0;a<x;a++)l=y[a],n=3*a,w[n]=l.r,w[n+1]=l.g,w[n+2]=l.b;if(A)for(h=0,c=A.length;h<c;h++)if(m=A[h],m.needsUpdate&&(void 0===m.boundTo||"vertices"===m.boundTo))if(f=m.value.length,n=0,1===m.size)for(p=0;p<f;p++)m.array[p]=m.value[p];else if(2===m.size)for(p=0;p<f;p++)d=m.value[p],m.array[n]=d.x,m.array[n+1]=d.y,n+=2;else if(3===m.size)if("c"===m.type)for(p=0;p<f;p++)d=m.value[p],m.array[n]=d.r,m.array[n+1]=d.g,m.array[n+2]=d.b,n+=3;else for(p=0;p<f;p++)d=m.value[p],m.array[n]=d.x,m.array[n+1]=d.y,m.array[n+2]=d.z,n+=3;else if(4===m.size)for(p=0;p<f;p++)d=m.value[p],m.array[n]=d.x,m.array[n+1]=d.y,m.array[n+2]=d.z,m.array[n+3]=d.w,n+=4}if((S||i.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,_,t)),(M||i.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,w,t)),A)for(h=0,c=A.length;h<c;h++)m=A[h],(m.needsUpdate||i.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,m.buffer),u.bufferData(u.ARRAY_BUFFER,m.array,t))}function Ve(e,t){var i,r,a,o,n,s,l,h,c,p,f,d,m=e.vertices,g=e.colors,v=e.lineDistances,y=m.length,x=g.length,_=v.length,w=e.__vertexArray,b=e.__colorArray,S=e.__lineDistanceArray,M=e.verticesNeedUpdate,A=e.colorsNeedUpdate,T=e.lineDistancesNeedUpdate,C=e.__webglCustomAttributesList;if(M){for(i=0;i<y;i++)o=m[i],n=3*i,w[n]=o.x,w[n+1]=o.y,w[n+2]=o.z;u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,w,t)}if(A){for(r=0;r<x;r++)s=g[r],n=3*r,b[n]=s.r,b[n+1]=s.g,b[n+2]=s.b;u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,b,t)}if(T){for(a=0;a<_;a++)S[a]=v[a];u.bindBuffer(u.ARRAY_BUFFER,e.__webglLineDistanceBuffer),u.bufferData(u.ARRAY_BUFFER,S,t)}if(C)for(l=0,h=C.length;l<h;l++)if(d=C[l],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(n=0,p=d.value.length,1===d.size)for(c=0;c<p;c++)d.array[c]=d.value[c];else if(2===d.size)for(c=0;c<p;c++)f=d.value[c],d.array[n]=f.x,d.array[n+1]=f.y,n+=2;else if(3===d.size)if("c"===d.type)for(c=0;c<p;c++)f=d.value[c],d.array[n]=f.r,d.array[n+1]=f.g,d.array[n+2]=f.b,n+=3;else for(c=0;c<p;c++)f=d.value[c],d.array[n]=f.x,d.array[n+1]=f.y,d.array[n+2]=f.z,n+=3;else if(4===d.size)for(c=0;c<p;c++)f=d.value[c],d.array[n]=f.x,d.array[n+1]=f.y,d.array[n+2]=f.z,d.array[n+3]=f.w,n+=4;u.bindBuffer(u.ARRAY_BUFFER,d.buffer),u.bufferData(u.ARRAY_BUFFER,d.array,t)}}function Be(e,t){var i,r,a,o,n,s,l,h,c,p,f,d,m,g=e.vertices,v=e.colors,y=e.normals,x=g.length,_=v.length,w=y.length,b=e.__vertexArray,S=e.__colorArray,M=e.__normalArray,A=e.verticesNeedUpdate,T=e.colorsNeedUpdate,C=e.normalsNeedUpdate,E=e.__webglCustomAttributesList;if(A){for(i=0;i<x;i++)o=g[i],n=3*i,b[n]=o.x,b[n+1]=o.y,b[n+2]=o.z;u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,b,t)}if(T){for(r=0;r<_;r++)s=v[r],n=3*r,S[n]=s.r,S[n+1]=s.g,S[n+2]=s.b;u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,S,t)}if(C){for(a=0;a<w;a++)l=y[a],n=3*a,M[n]=l.x,M[n+1]=l.y,M[n+2]=l.z;u.bindBuffer(u.ARRAY_BUFFER,e.__webglNormalBuffer),u.bufferData(u.ARRAY_BUFFER,M,t)}if(E)for(h=0,c=E.length;h<c;h++)if(d=E[h],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo)){if(n=0,f=d.value.length,1===d.size)for(p=0;p<f;p++)d.array[p]=d.value[p];else if(2===d.size)for(p=0;p<f;p++)m=d.value[p],d.array[n]=m.x,d.array[n+1]=m.y,n+=2;else if(3===d.size)if("c"===d.type)for(p=0;p<f;p++)m=d.value[p],d.array[n]=m.r,d.array[n+1]=m.g,d.array[n+2]=m.b,n+=3;else for(p=0;p<f;p++)m=d.value[p],d.array[n]=m.x,d.array[n+1]=m.y,d.array[n+2]=m.z,n+=3;else if(4===d.size)for(p=0;p<f;p++)m=d.value[p],d.array[n]=m.x,d.array[n+1]=m.y,d.array[n+2]=m.z,d.array[n+3]=m.w,n+=4;u.bindBuffer(u.ARRAY_BUFFER,d.buffer),u.bufferData(u.ARRAY_BUFFER,d.array,t)}}function Ne(e,t,i,r,a){if(e.__inittedArrays){var n,s,l,h,c,p,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C,E,P,L,R,D,F,U,z,V,B,N,O,I,k,G,H,W,j,X,Y,q,K,Q,Z,J,$,ee,te=Re(a),ie=De(a),re=Fe(a),ae=te===o.SmoothShading,oe=0,ne=0,se=0,le=0,he=0,ce=0,pe=0,ue=0,fe=0,de=0,me=0,ge=0,ve=e.__vertexArray,ye=e.__uvArray,xe=e.__uv2Array,_e=e.__normalArray,we=e.__tangentArray,be=e.__colorArray,Se=e.__skinIndexArray,Me=e.__skinWeightArray,Ae=e.__morphTargetsArrays,Te=e.__morphNormalsArrays,Ce=e.__webglCustomAttributesList,Ee=e.__faceArray,Pe=e.__lineArray,Le=t.geometry,Ue=Le.verticesNeedUpdate,ze=Le.elementsNeedUpdate,Ve=Le.uvsNeedUpdate,Be=Le.normalsNeedUpdate,Ne=Le.tangentsNeedUpdate,Oe=Le.colorsNeedUpdate,Ie=Le.morphTargetsNeedUpdate,ke=Le.vertices,Ge=e.faces3,He=e.faces4,We=Le.faces,je=Le.faceVertexUvs[0],Xe=Le.faceVertexUvs[1],Ye=(Le.colors,Le.skinIndices),qe=Le.skinWeights,Ke=Le.morphTargets,Qe=Le.morphNormals;if(Ue){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],y=ke[h.a],x=ke[h.b],_=ke[h.c],ve[ne]=y.x,ve[ne+1]=y.y,ve[ne+2]=y.z,ve[ne+3]=x.x,ve[ne+4]=x.y,ve[ne+5]=x.z,ve[ne+6]=_.x,ve[ne+7]=_.y,ve[ne+8]=_.z,ne+=9;for(n=0,s=He.length;n<s;n++)h=We[He[n]],y=ke[h.a],x=ke[h.b],_=ke[h.c],w=ke[h.d],ve[ne]=y.x,ve[ne+1]=y.y,ve[ne+2]=y.z,ve[ne+3]=x.x,ve[ne+4]=x.y,ve[ne+5]=x.z,ve[ne+6]=_.x,ve[ne+7]=_.y,ve[ne+8]=_.z,ve[ne+9]=w.x,ve[ne+10]=w.y,ve[ne+11]=w.z,ne+=12;u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,ve,i)}if(Ie)for(Y=0,q=Ke.length;Y<q;Y++){for(me=0,n=0,s=Ge.length;n<s;n++)Z=Ge[n],h=We[Z],y=Ke[Y].vertices[h.a],x=Ke[Y].vertices[h.b],_=Ke[Y].vertices[h.c],K=Ae[Y],K[me]=y.x,K[me+1]=y.y,K[me+2]=y.z,K[me+3]=x.x,K[me+4]=x.y,K[me+5]=x.z,K[me+6]=_.x,K[me+7]=_.y,K[me+8]=_.z,a.morphNormals&&(ae?(J=Qe[Y].vertexNormals[Z],T=J.a,C=J.b,E=J.c):(T=Qe[Y].faceNormals[Z],C=T,E=T),Q=Te[Y],Q[me]=T.x,Q[me+1]=T.y,Q[me+2]=T.z,Q[me+3]=C.x,Q[me+4]=C.y,Q[me+5]=C.z,Q[me+6]=E.x,Q[me+7]=E.y,Q[me+8]=E.z),me+=9;for(n=0,s=He.length;n<s;n++)Z=He[n],h=We[Z],y=Ke[Y].vertices[h.a],x=Ke[Y].vertices[h.b],_=Ke[Y].vertices[h.c],w=Ke[Y].vertices[h.d],K=Ae[Y],K[me]=y.x,K[me+1]=y.y,K[me+2]=y.z,K[me+3]=x.x,K[me+4]=x.y,K[me+5]=x.z,K[me+6]=_.x,K[me+7]=_.y,K[me+8]=_.z,K[me+9]=w.x,K[me+10]=w.y,K[me+11]=w.z,a.morphNormals&&(ae?(J=Qe[Y].vertexNormals[Z],T=J.a,C=J.b,E=J.c,P=J.d):(T=Qe[Y].faceNormals[Z],C=T,E=T,P=T),Q=Te[Y],Q[me]=T.x,Q[me+1]=T.y,Q[me+2]=T.z,Q[me+3]=C.x,Q[me+4]=C.y,Q[me+5]=C.z,Q[me+6]=E.x,Q[me+7]=E.y,Q[me+8]=E.z,Q[me+9]=P.x,Q[me+10]=P.y,Q[me+11]=P.z),me+=12;u.bindBuffer(u.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[Y]),u.bufferData(u.ARRAY_BUFFER,Ae[Y],i),a.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[Y]),u.bufferData(u.ARRAY_BUFFER,Te[Y],i))}if(qe.length){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],U=qe[h.a],z=qe[h.b],V=qe[h.c],Me[de]=U.x,Me[de+1]=U.y,Me[de+2]=U.z,Me[de+3]=U.w,Me[de+4]=z.x,Me[de+5]=z.y,Me[de+6]=z.z,Me[de+7]=z.w,Me[de+8]=V.x,Me[de+9]=V.y,Me[de+10]=V.z,Me[de+11]=V.w,N=Ye[h.a],O=Ye[h.b],I=Ye[h.c],Se[de]=N.x,Se[de+1]=N.y,Se[de+2]=N.z,Se[de+3]=N.w,Se[de+4]=O.x,Se[de+5]=O.y,Se[de+6]=O.z,Se[de+7]=O.w,Se[de+8]=I.x,Se[de+9]=I.y,Se[de+10]=I.z,Se[de+11]=I.w,de+=12;for(n=0,s=He.length;n<s;n++)h=We[He[n]],U=qe[h.a],z=qe[h.b],V=qe[h.c],B=qe[h.d],Me[de]=U.x,Me[de+1]=U.y,Me[de+2]=U.z,Me[de+3]=U.w,Me[de+4]=z.x,Me[de+5]=z.y,Me[de+6]=z.z,Me[de+7]=z.w,Me[de+8]=V.x,Me[de+9]=V.y,Me[de+10]=V.z,Me[de+11]=V.w,Me[de+12]=B.x,Me[de+13]=B.y,Me[de+14]=B.z,Me[de+15]=B.w,N=Ye[h.a],O=Ye[h.b],I=Ye[h.c],k=Ye[h.d],Se[de]=N.x,Se[de+1]=N.y,Se[de+2]=N.z,Se[de+3]=N.w,Se[de+4]=O.x,Se[de+5]=O.y,Se[de+6]=O.z,Se[de+7]=O.w,Se[de+8]=I.x,Se[de+9]=I.y,Se[de+10]=I.z,Se[de+11]=I.w,Se[de+12]=k.x,Se[de+13]=k.y,Se[de+14]=k.z,Se[de+15]=k.w,de+=16;de>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),u.bufferData(u.ARRAY_BUFFER,Se,i),u.bindBuffer(u.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),u.bufferData(u.ARRAY_BUFFER,Me,i))}if(Oe&&ie){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],f=h.vertexColors,d=h.color,3===f.length&&ie===o.VertexColors?(L=f[0],R=f[1],D=f[2]):(L=d,R=d,D=d),be[fe]=L.r,be[fe+1]=L.g,be[fe+2]=L.b,be[fe+3]=R.r,be[fe+4]=R.g,be[fe+5]=R.b,be[fe+6]=D.r,be[fe+7]=D.g,be[fe+8]=D.b,fe+=9;for(n=0,s=He.length;n<s;n++)h=We[He[n]],f=h.vertexColors,d=h.color,4===f.length&&ie===o.VertexColors?(L=f[0],R=f[1],D=f[2],F=f[3]):(L=d,R=d,D=d,F=d),be[fe]=L.r,be[fe+1]=L.g,be[fe+2]=L.b,be[fe+3]=R.r,be[fe+4]=R.g,be[fe+5]=R.b,be[fe+6]=D.r,be[fe+7]=D.g,be[fe+8]=D.b,be[fe+9]=F.r,be[fe+10]=F.g,be[fe+11]=F.b,fe+=12;fe>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,be,i))}if(Ne&&Le.hasTangents){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],m=h.vertexTangents,b=m[0],S=m[1],M=m[2],we[pe]=b.x,we[pe+1]=b.y,we[pe+2]=b.z,we[pe+3]=b.w,we[pe+4]=S.x,we[pe+5]=S.y,we[pe+6]=S.z,we[pe+7]=S.w,we[pe+8]=M.x,we[pe+9]=M.y,we[pe+10]=M.z,we[pe+11]=M.w,pe+=12;for(n=0,s=He.length;n<s;n++)h=We[He[n]],m=h.vertexTangents,b=m[0],S=m[1],M=m[2],A=m[3],we[pe]=b.x,we[pe+1]=b.y,we[pe+2]=b.z,we[pe+3]=b.w,we[pe+4]=S.x,we[pe+5]=S.y,we[pe+6]=S.z,we[pe+7]=S.w,we[pe+8]=M.x,we[pe+9]=M.y,we[pe+10]=M.z,we[pe+11]=M.w,we[pe+12]=A.x,we[pe+13]=A.y,we[pe+14]=A.z,we[pe+15]=A.w,pe+=16;u.bindBuffer(u.ARRAY_BUFFER,e.__webglTangentBuffer),u.bufferData(u.ARRAY_BUFFER,we,i)}if(Be&&te){for(n=0,s=Ge.length;n<s;n++)if(h=We[Ge[n]],c=h.vertexNormals,p=h.normal,3===c.length&&ae)for(G=0;G<3;G++)W=c[G],_e[ce]=W.x,_e[ce+1]=W.y,_e[ce+2]=W.z,ce+=3;else for(G=0;G<3;G++)_e[ce]=p.x,_e[ce+1]=p.y,_e[ce+2]=p.z,ce+=3;for(n=0,s=He.length;n<s;n++)if(h=We[He[n]],c=h.vertexNormals,p=h.normal,4===c.length&&ae)for(G=0;G<4;G++)W=c[G],_e[ce]=W.x,_e[ce+1]=W.y,_e[ce+2]=W.z,ce+=3;else for(G=0;G<4;G++)_e[ce]=p.x,_e[ce+1]=p.y,_e[ce+2]=p.z,ce+=3;u.bindBuffer(u.ARRAY_BUFFER,e.__webglNormalBuffer),u.bufferData(u.ARRAY_BUFFER,_e,i)}if(Ve&&je&&re){for(n=0,s=Ge.length;n<s;n++)if(l=Ge[n],g=je[l],void 0!==g)for(G=0;G<3;G++)j=g[G],ye[se]=j.x,ye[se+1]=j.y,se+=2;for(n=0,s=He.length;n<s;n++)if(l=He[n],g=je[l],void 0!==g)for(G=0;G<4;G++)j=g[G],ye[se]=j.x,ye[se+1]=j.y,se+=2;se>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglUVBuffer),u.bufferData(u.ARRAY_BUFFER,ye,i))}if(Ve&&Xe&&re){for(n=0,s=Ge.length;n<s;n++)if(l=Ge[n],v=Xe[l],void 0!==v)for(G=0;G<3;G++)X=v[G],xe[le]=X.x,xe[le+1]=X.y,le+=2;for(n=0,s=He.length;n<s;n++)if(l=He[n],v=Xe[l],void 0!==v)for(G=0;G<4;G++)X=v[G],xe[le]=X.x,xe[le+1]=X.y,le+=2;le>0&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglUV2Buffer),u.bufferData(u.ARRAY_BUFFER,xe,i))}if(ze){for(n=0,s=Ge.length;n<s;n++)Ee[he]=oe,Ee[he+1]=oe+1,Ee[he+2]=oe+2,he+=3,Pe[ue]=oe,Pe[ue+1]=oe+1,Pe[ue+2]=oe,Pe[ue+3]=oe+2,Pe[ue+4]=oe+1,Pe[ue+5]=oe+2,ue+=6,oe+=3;for(n=0,s=He.length;n<s;n++)Ee[he]=oe,Ee[he+1]=oe+1,Ee[he+2]=oe+3,Ee[he+3]=oe+1,Ee[he+4]=oe+2,Ee[he+5]=oe+3,he+=6,Pe[ue]=oe,Pe[ue+1]=oe+1,Pe[ue+2]=oe,Pe[ue+3]=oe+3,Pe[ue+4]=oe+1,Pe[ue+5]=oe+2,Pe[ue+6]=oe+2,Pe[ue+7]=oe+3,ue+=8,oe+=4;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Ee,i),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Pe,i)}if(Ce)for(G=0,H=Ce.length;G<H;G++)if(ee=Ce[G],ee.__original.needsUpdate){if(ge=0,0,1===ee.size){if(void 0===ee.boundTo||"vertices"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],ee.array[ge]=ee.value[h.a],ee.array[ge+1]=ee.value[h.b],ee.array[ge+2]=ee.value[h.c],ge+=3;for(n=0,s=He.length;n<s;n++)h=We[He[n]],ee.array[ge]=ee.value[h.a],ee.array[ge+1]=ee.value[h.b],ee.array[ge+2]=ee.value[h.c],ee.array[ge+3]=ee.value[h.d],ge+=4}else if("faces"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)$=ee.value[Ge[n]],ee.array[ge]=$,ee.array[ge+1]=$,ee.array[ge+2]=$,ge+=3;for(n=0,s=He.length;n<s;n++)$=ee.value[He[n]],ee.array[ge]=$,ee.array[ge+1]=$,ee.array[ge+2]=$,ee.array[ge+3]=$,ge+=4}}else if(2===ee.size){if(void 0===ee.boundTo||"vertices"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],y=ee.value[h.a],x=ee.value[h.b],_=ee.value[h.c],ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=x.x,ee.array[ge+3]=x.y,ee.array[ge+4]=_.x,ee.array[ge+5]=_.y,ge+=6;for(n=0,s=He.length;n<s;n++)h=We[He[n]],y=ee.value[h.a],x=ee.value[h.b],_=ee.value[h.c],w=ee.value[h.d],ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=x.x,ee.array[ge+3]=x.y,ee.array[ge+4]=_.x,ee.array[ge+5]=_.y,ee.array[ge+6]=w.x,ee.array[ge+7]=w.y,ge+=8}else if("faces"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)$=ee.value[Ge[n]],y=$,x=$,_=$,ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=x.x,ee.array[ge+3]=x.y,ee.array[ge+4]=_.x,ee.array[ge+5]=_.y,ge+=6;for(n=0,s=He.length;n<s;n++)$=ee.value[He[n]],y=$,x=$,_=$,w=$,ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=x.x,ee.array[ge+3]=x.y,ee.array[ge+4]=_.x,ee.array[ge+5]=_.y,ee.array[ge+6]=w.x,ee.array[ge+7]=w.y,ge+=8}}else if(3===ee.size){var Ze;if(Ze="c"===ee.type?["r","g","b"]:["x","y","z"],void 0===ee.boundTo||"vertices"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],y=ee.value[h.a],x=ee.value[h.b],_=ee.value[h.c],ee.array[ge]=y[Ze[0]],ee.array[ge+1]=y[Ze[1]],ee.array[ge+2]=y[Ze[2]],ee.array[ge+3]=x[Ze[0]],ee.array[ge+4]=x[Ze[1]],ee.array[ge+5]=x[Ze[2]],ee.array[ge+6]=_[Ze[0]],ee.array[ge+7]=_[Ze[1]],ee.array[ge+8]=_[Ze[2]],ge+=9;for(n=0,s=He.length;n<s;n++)h=We[He[n]],y=ee.value[h.a],x=ee.value[h.b],_=ee.value[h.c],w=ee.value[h.d],ee.array[ge]=y[Ze[0]],ee.array[ge+1]=y[Ze[1]],ee.array[ge+2]=y[Ze[2]],ee.array[ge+3]=x[Ze[0]],ee.array[ge+4]=x[Ze[1]],ee.array[ge+5]=x[Ze[2]],ee.array[ge+6]=_[Ze[0]],ee.array[ge+7]=_[Ze[1]],ee.array[ge+8]=_[Ze[2]],ee.array[ge+9]=w[Ze[0]],ee.array[ge+10]=w[Ze[1]],ee.array[ge+11]=w[Ze[2]],ge+=12}else if("faces"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)$=ee.value[Ge[n]],y=$,x=$,_=$,ee.array[ge]=y[Ze[0]],ee.array[ge+1]=y[Ze[1]],ee.array[ge+2]=y[Ze[2]],ee.array[ge+3]=x[Ze[0]],ee.array[ge+4]=x[Ze[1]],ee.array[ge+5]=x[Ze[2]],ee.array[ge+6]=_[Ze[0]],ee.array[ge+7]=_[Ze[1]],ee.array[ge+8]=_[Ze[2]],ge+=9;for(n=0,s=He.length;n<s;n++)$=ee.value[He[n]],y=$,x=$,_=$,w=$,ee.array[ge]=y[Ze[0]],ee.array[ge+1]=y[Ze[1]],ee.array[ge+2]=y[Ze[2]],ee.array[ge+3]=x[Ze[0]],ee.array[ge+4]=x[Ze[1]],ee.array[ge+5]=x[Ze[2]],ee.array[ge+6]=_[Ze[0]],ee.array[ge+7]=_[Ze[1]],ee.array[ge+8]=_[Ze[2]],ee.array[ge+9]=w[Ze[0]],ee.array[ge+10]=w[Ze[1]],ee.array[ge+11]=w[Ze[2]],ge+=12}else if("faceVertices"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)$=ee.value[Ge[n]],y=$[0],x=$[1],_=$[2],ee.array[ge]=y[Ze[0]],ee.array[ge+1]=y[Ze[1]],ee.array[ge+2]=y[Ze[2]],ee.array[ge+3]=x[Ze[0]],ee.array[ge+4]=x[Ze[1]],ee.array[ge+5]=x[Ze[2]],ee.array[ge+6]=_[Ze[0]],ee.array[ge+7]=_[Ze[1]],ee.array[ge+8]=_[Ze[2]],ge+=9;for(n=0,s=He.length;n<s;n++)$=ee.value[He[n]],y=$[0],x=$[1],_=$[2],w=$[3],ee.array[ge]=y[Ze[0]],ee.array[ge+1]=y[Ze[1]],ee.array[ge+2]=y[Ze[2]],ee.array[ge+3]=x[Ze[0]],ee.array[ge+4]=x[Ze[1]],ee.array[ge+5]=x[Ze[2]],ee.array[ge+6]=_[Ze[0]],ee.array[ge+7]=_[Ze[1]],ee.array[ge+8]=_[Ze[2]],ee.array[ge+9]=w[Ze[0]],ee.array[ge+10]=w[Ze[1]],ee.array[ge+11]=w[Ze[2]],ge+=12}}else if(4===ee.size)if(void 0===ee.boundTo||"vertices"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)h=We[Ge[n]],y=ee.value[h.a],x=ee.value[h.b],_=ee.value[h.c],ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=y.z,ee.array[ge+3]=y.w,ee.array[ge+4]=x.x,ee.array[ge+5]=x.y,ee.array[ge+6]=x.z,ee.array[ge+7]=x.w,ee.array[ge+8]=_.x,ee.array[ge+9]=_.y,ee.array[ge+10]=_.z,ee.array[ge+11]=_.w,ge+=12;for(n=0,s=He.length;n<s;n++)h=We[He[n]],y=ee.value[h.a],x=ee.value[h.b],_=ee.value[h.c],w=ee.value[h.d],ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=y.z,ee.array[ge+3]=y.w,ee.array[ge+4]=x.x,ee.array[ge+5]=x.y,ee.array[ge+6]=x.z,ee.array[ge+7]=x.w,ee.array[ge+8]=_.x,ee.array[ge+9]=_.y,ee.array[ge+10]=_.z,ee.array[ge+11]=_.w,ee.array[ge+12]=w.x,ee.array[ge+13]=w.y,ee.array[ge+14]=w.z,ee.array[ge+15]=w.w,ge+=16}else if("faces"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)$=ee.value[Ge[n]],y=$,x=$,_=$,ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=y.z,ee.array[ge+3]=y.w,ee.array[ge+4]=x.x,ee.array[ge+5]=x.y,ee.array[ge+6]=x.z,ee.array[ge+7]=x.w,ee.array[ge+8]=_.x,ee.array[ge+9]=_.y,ee.array[ge+10]=_.z,ee.array[ge+11]=_.w,ge+=12;for(n=0,s=He.length;n<s;n++)$=ee.value[He[n]],y=$,x=$,_=$,w=$,ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=y.z,ee.array[ge+3]=y.w,ee.array[ge+4]=x.x,ee.array[ge+5]=x.y,ee.array[ge+6]=x.z,ee.array[ge+7]=x.w,ee.array[ge+8]=_.x,ee.array[ge+9]=_.y,ee.array[ge+10]=_.z,ee.array[ge+11]=_.w,ee.array[ge+12]=w.x,ee.array[ge+13]=w.y,ee.array[ge+14]=w.z,ee.array[ge+15]=w.w,ge+=16}else if("faceVertices"===ee.boundTo){for(n=0,s=Ge.length;n<s;n++)$=ee.value[Ge[n]],y=$[0],x=$[1],_=$[2],ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=y.z,ee.array[ge+3]=y.w,ee.array[ge+4]=x.x,ee.array[ge+5]=x.y,ee.array[ge+6]=x.z,ee.array[ge+7]=x.w,ee.array[ge+8]=_.x,ee.array[ge+9]=_.y,ee.array[ge+10]=_.z,ee.array[ge+11]=_.w,ge+=12;for(n=0,s=He.length;n<s;n++)$=ee.value[He[n]],y=$[0],x=$[1],_=$[2],w=$[3],ee.array[ge]=y.x,ee.array[ge+1]=y.y,ee.array[ge+2]=y.z,ee.array[ge+3]=y.w,ee.array[ge+4]=x.x,ee.array[ge+5]=x.y,ee.array[ge+6]=x.z,ee.array[ge+7]=x.w,ee.array[ge+8]=_.x,ee.array[ge+9]=_.y,ee.array[ge+10]=_.z,ee.array[ge+11]=_.w,ee.array[ge+12]=w.x,ee.array[ge+13]=w.y,ee.array[ge+14]=w.z,ee.array[ge+15]=w.w,ge+=16}u.bindBuffer(u.ARRAY_BUFFER,ee.buffer),u.bufferData(u.ARRAY_BUFFER,ee.array,i)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Oe(e,t,i){var r=e.attributes,a=r["index"],o=r["position"],n=r["normal"],s=r["uv"],l=r["color"],h=r["tangent"];if(e.elementsNeedUpdate&&void 0!==a&&(u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,a.array,t)),e.verticesNeedUpdate&&void 0!==o&&(u.bindBuffer(u.ARRAY_BUFFER,o.buffer),u.bufferData(u.ARRAY_BUFFER,o.array,t)),e.normalsNeedUpdate&&void 0!==n&&(u.bindBuffer(u.ARRAY_BUFFER,n.buffer),u.bufferData(u.ARRAY_BUFFER,n.array,t)),e.uvsNeedUpdate&&void 0!==s&&(u.bindBuffer(u.ARRAY_BUFFER,s.buffer),u.bufferData(u.ARRAY_BUFFER,s.array,t)),e.colorsNeedUpdate&&void 0!==l&&(u.bindBuffer(u.ARRAY_BUFFER,l.buffer),u.bufferData(u.ARRAY_BUFFER,l.array,t)),e.tangentsNeedUpdate&&void 0!==h&&(u.bindBuffer(u.ARRAY_BUFFER,h.buffer),u.bufferData(u.ARRAY_BUFFER,h.array,t)),i)for(var c in e.attributes)delete e.attributes[c].array}function Ie(e){j[e]||(u.enableVertexAttribArray(e),j[e]=!0)}function ke(){for(var e in j)j[e]&&(u.disableVertexAttribArray(e),j[e]=!1)}function Ge(e,t,i){var r=e.program.attributes;if(-1!==i.morphTargetBase&&r.position>=0?(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),Ie(r.position),u.vertexAttribPointer(r.position,3,u.FLOAT,!1,0,0)):r.position>=0&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglVertexBuffer),Ie(r.position),u.vertexAttribPointer(r.position,3,u.FLOAT,!1,0,0)),i.morphTargetForcedOrder.length){var a=0,o=i.morphTargetForcedOrder,n=i.morphTargetInfluences;while(a<e.numSupportedMorphTargets&&a<o.length)r["morphTarget"+a]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[a]]),Ie(r["morphTarget"+a]),u.vertexAttribPointer(r["morphTarget"+a],3,u.FLOAT,!1,0,0)),r["morphNormal"+a]>=0&&e.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[a]]),Ie(r["morphNormal"+a]),u.vertexAttribPointer(r["morphNormal"+a],3,u.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[a]=n[o[a]],a++}else{var s,l,h=[],c=(n=i.morphTargetInfluences,n.length);for(l=0;l<c;l++)s=n[l],s>0&&h.push([s,l]);h.length>e.numSupportedMorphTargets?(h.sort(We),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(We):0===h.length&&h.push([0,0]);var p;a=0;while(a<e.numSupportedMorphTargets)h[a]?(p=h[a][1],r["morphTarget"+a]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[p]),Ie(r["morphTarget"+a]),u.vertexAttribPointer(r["morphTarget"+a],3,u.FLOAT,!1,0,0)),r["morphNormal"+a]>=0&&e.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[p]),Ie(r["morphNormal"+a]),u.vertexAttribPointer(r["morphNormal"+a],3,u.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[a]=n[p]):i.__webglMorphTargetInfluences[a]=0,a++}null!==e.program.uniforms.morphTargetInfluences&&u.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function He(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}function We(e,t){return t[0]-e[0]}function je(e,t,i){if(e.length)for(var r=0,a=e.length;r<a;r++)_=null,M=null,P=-1,F=-1,U=-1,C=-1,E=-1,S=-1,b=-1,Z=!0,e[r].render(t,i,H,W),_=null,M=null,P=-1,F=-1,U=-1,C=-1,E=-1,S=-1,b=-1,Z=!0}function Xe(e,t,i,r,a,n,s,l){var h,c,p,u,f,d,m;t?(f=e.length-1,d=-1,m=-1):(f=0,d=e.length,m=1);for(var g=f;g!==d;g+=m)if(h=e[g],h.render){if(c=h.object,p=h.buffer,l)u=l;else{if(u=h[i],!u)continue;s&&v.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),v.setDepthTest(u.depthTest),v.setDepthWrite(u.depthWrite),At(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}v.setMaterialFaces(u),p instanceof o.BufferGeometry?v.renderBufferDirect(r,a,n,u,p,c):v.renderBuffer(r,a,n,u,p,c)}}function Ye(e,t,i,r,a,o,n){for(var s,l,h,c=0,p=e.length;c<p;c++)if(s=e[c],l=s.object,l.visible){if(n)h=n;else{if(h=s[t],!h)continue;o&&v.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),v.setDepthTest(h.depthTest),v.setDepthWrite(h.depthWrite),At(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}v.renderImmediateObject(i,r,a,h,l)}}function qe(e){var t=e.object,i=t.material;i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)}function Ke(e){var t,i,r,a=e.object,n=e.buffer;r=a.material,r instanceof o.MeshFaceMaterial?(i=n.materialIndex,t=r.materials[i],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=r,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function Qe(e,t){var i,r,a,n,s,l,h={},c=e.morphTargets.length,p=e.morphNormals.length,u=t instanceof o.MeshFaceMaterial;for(e.geometryGroups={},i=0,r=e.faces.length;i<r;i++)a=e.faces[i],n=u?a.materialIndex:0,void 0===h[n]&&(h[n]={hash:n,counter:0}),l=h[n].hash+"_"+h[n].counter,void 0===e.geometryGroups[l]&&(e.geometryGroups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0,numMorphTargets:c,numMorphNormals:p}),s=a instanceof o.Face3?3:4,e.geometryGroups[l].vertices+s>65535&&(h[n].counter+=1,l=h[n].hash+"_"+h[n].counter,void 0===e.geometryGroups[l]&&(e.geometryGroups[l]={faces3:[],faces4:[],materialIndex:n,vertices:0,numMorphTargets:c,numMorphNormals:p})),a instanceof o.Face3?e.geometryGroups[l].faces3.push(i):e.geometryGroups[l].faces4.push(i),e.geometryGroups[l].vertices+=s;for(var f in e.geometryGroupsList=[],e.geometryGroups)e.geometryGroups[f].id=A++,e.geometryGroupsList.push(e.geometryGroups[f])}function Ze(e,t){var i,r,a,n;if(!e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new o.Matrix4,e._normalMatrix=new o.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",me)),e instanceof o.Mesh)if(r=e.geometry,a=e.material,r instanceof o.Geometry)for(i in void 0===r.geometryGroups&&Qe(r,a),r.geometryGroups)n=r.geometryGroups[i],n.__webglVertexBuffer||(de(n),Ee(n,e),r.verticesNeedUpdate=!0,r.morphTargetsNeedUpdate=!0,r.elementsNeedUpdate=!0,r.uvsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.tangentsNeedUpdate=!0,r.colorsNeedUpdate=!0);else r instanceof o.BufferGeometry&&Ue(r);else e instanceof o.Ribbon?(r=e.geometry,r.__webglVertexBuffer||(fe(r),Ce(r,e),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0,r.normalsNeedUpdate=!0)):e instanceof o.Line?(r=e.geometry,r.__webglVertexBuffer||(r instanceof o.Geometry?(ue(r),Te(r,e),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0,r.lineDistancesNeedUpdate=!0):r instanceof o.BufferGeometry&&Ue(r))):e instanceof o.ParticleSystem&&(r=e.geometry,r.__webglVertexBuffer||(r instanceof o.Geometry?(pe(r),Ae(r,e),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0):r instanceof o.BufferGeometry&&Ue(r)));if(!e.__webglActive){if(e instanceof o.Mesh){if(r=e.geometry,r instanceof o.BufferGeometry)Je(t.__webglObjects,r,e);else if(r instanceof o.Geometry)for(i in r.geometryGroups)n=r.geometryGroups[i],Je(t.__webglObjects,n,e)}else e instanceof o.Ribbon||e instanceof o.Line||e instanceof o.ParticleSystem?(r=e.geometry,Je(t.__webglObjects,r,e)):e instanceof o.ImmediateRenderObject||e.immediateRenderCallback?$e(t.__webglObjectsImmediate,e):e instanceof o.Sprite?t.__webglSprites.push(e):e instanceof o.LensFlare&&t.__webglFlares.push(e);e.__webglActive=!0}}function Je(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function $e(e,t){e.push({object:t,opaque:null,transparent:null})}function et(e){var t,i,r,a=e.geometry;if(e instanceof o.Mesh)if(a instanceof o.BufferGeometry)(a.verticesNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate)&&Oe(a,u.DYNAMIC_DRAW,!a.dynamic),a.verticesNeedUpdate=!1,a.elementsNeedUpdate=!1,a.uvsNeedUpdate=!1,a.normalsNeedUpdate=!1,a.colorsNeedUpdate=!1,a.tangentsNeedUpdate=!1;else{for(var n=0,s=a.geometryGroupsList.length;n<s;n++)t=a.geometryGroupsList[n],r=Pe(e,t),a.buffersNeedUpdate&&Ee(t,e),i=r.attributes&&tt(r),(a.verticesNeedUpdate||a.morphTargetsNeedUpdate||a.elementsNeedUpdate||a.uvsNeedUpdate||a.normalsNeedUpdate||a.colorsNeedUpdate||a.tangentsNeedUpdate||i)&&Ne(t,e,u.DYNAMIC_DRAW,!a.dynamic,r);a.verticesNeedUpdate=!1,a.morphTargetsNeedUpdate=!1,a.elementsNeedUpdate=!1,a.uvsNeedUpdate=!1,a.normalsNeedUpdate=!1,a.colorsNeedUpdate=!1,a.tangentsNeedUpdate=!1,a.buffersNeedUpdate=!1,r.attributes&&it(r)}else e instanceof o.Ribbon?(r=Pe(e,a),i=r.attributes&&tt(r),(a.verticesNeedUpdate||a.colorsNeedUpdate||a.normalsNeedUpdate||i)&&Be(a,u.DYNAMIC_DRAW),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1,a.normalsNeedUpdate=!1,r.attributes&&it(r)):e instanceof o.Line?a instanceof o.BufferGeometry?((a.verticesNeedUpdate||a.colorsNeedUpdate)&&Oe(a,u.DYNAMIC_DRAW,!a.dynamic),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1):(r=Pe(e,a),i=r.attributes&&tt(r),(a.verticesNeedUpdate||a.colorsNeedUpdate||a.lineDistancesNeedUpdate||i)&&Ve(a,u.DYNAMIC_DRAW),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1,a.lineDistancesNeedUpdate=!1,r.attributes&&it(r)):e instanceof o.ParticleSystem&&(a instanceof o.BufferGeometry?((a.verticesNeedUpdate||a.colorsNeedUpdate)&&Oe(a,u.DYNAMIC_DRAW,!a.dynamic),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1):(r=Pe(e,a),i=r.attributes&&tt(r),(a.verticesNeedUpdate||a.colorsNeedUpdate||e.sortParticles||i)&&ze(a,u.DYNAMIC_DRAW,e),a.verticesNeedUpdate=!1,a.colorsNeedUpdate=!1,r.attributes&&it(r)))}function tt(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function it(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function rt(e,t){e instanceof o.Mesh||e instanceof o.ParticleSystem||e instanceof o.Ribbon||e instanceof o.Line?at(t.__webglObjects,e):e instanceof o.Sprite?ot(t.__webglSprites,e):e instanceof o.LensFlare?ot(t.__webglFlares,e):(e instanceof o.ImmediateRenderObject||e.immediateRenderCallback)&&at(t.__webglObjectsImmediate,e),e.__webglActive=!1}function at(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function ot(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function nt(e,t){e.uniforms=o.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function st(e,t,i,r,a){T=0,r.needsUpdate&&(r.program&&be(r),v.initMaterial(r,t,i,a),r.needsUpdate=!1),r.morphTargets&&(a.__webglMorphTargetInfluences||(a.__webglMorphTargetInfluences=new Float32Array(v.maxMorphTargets)));var n=!1,s=r.program,l=s.uniforms,h=r.uniforms;if(s!==_&&(u.useProgram(s),_=s,n=!0),r.id!==b&&(b=r.id,n=!0),(n||e!==M)&&(u.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),e!==M&&(M=e)),r.skinning)if(ae&&a.useVertexTexture){if(null!==l.boneTexture){var c=yt();u.uniform1i(l.boneTexture,c),v.setTexture(a.boneTexture,c)}}else null!==l.boneGlobalMatrices&&u.uniformMatrix4fv(l.boneGlobalMatrices,!1,a.boneMatrices);if(n){if(i&&r.fog&&ut(h,i),(r instanceof o.MeshPhongMaterial||r instanceof o.MeshLambertMaterial||r.lights)&&(Z&&(St(s,t),Z=!1),mt(h,J)),(r instanceof o.MeshBasicMaterial||r instanceof o.MeshLambertMaterial||r instanceof o.MeshPhongMaterial)&&lt(h,r),r instanceof o.LineBasicMaterial?ht(h,r):r instanceof o.LineDashedMaterial?(ht(h,r),ct(h,r)):r instanceof o.ParticleBasicMaterial?pt(h,r):r instanceof o.MeshPhongMaterial?ft(h,r):r instanceof o.MeshLambertMaterial?dt(h,r):r instanceof o.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=r.opacity):r instanceof o.MeshNormalMaterial&&(h.opacity.value=r.opacity),a.receiveShadow&&!r._shadowPass&&gt(h,t),xt(s,r.uniformsList),(r instanceof o.ShaderMaterial||r instanceof o.MeshPhongMaterial||r.envMap)&&null!==l.cameraPosition){var p=e.matrixWorld.getPosition();u.uniform3f(l.cameraPosition,p.x,p.y,p.z)}(r instanceof o.MeshPhongMaterial||r instanceof o.MeshLambertMaterial||r instanceof o.ShaderMaterial||r.skinning)&&null!==l.viewMatrix&&u.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)}return vt(l,a),null!==l.modelMatrix&&u.uniformMatrix4fv(l.modelMatrix,!1,a.matrixWorld.elements),s}function lt(e,t){var i;if(e.opacity.value=t.opacity,v.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap),void 0!==i){var r=i.offset,a=i.repeat;e.offsetRepeat.value.set(r.x,r.y,a.x,a.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof o.WebGLRenderTargetCube?1:-1,v.gammaInput,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof o.CubeRefractionMapping}function ht(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function ct(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function pt(e,i){e.psColor.value=i.color,e.opacity.value=i.opacity,e.size.value=i.size,e.scale.value=t.height/2,e.map.value=i.map}function ut(e,t){e.fogColor.value=t.color,t instanceof o.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof o.FogExp2&&(e.fogDensity.value=t.density)}function ft(e,t){e.shininess.value=t.shininess,v.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function dt(e,t){v.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function mt(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function gt(e,t){if(e.shadowMatrix)for(var i=0,r=0,a=t.length;r<a;r++){var n=t[r];n.castShadow&&((n instanceof o.SpotLight||n instanceof o.DirectionalLight&&!n.shadowCascade)&&(e.shadowMap.value[i]=n.shadowMap,e.shadowMapSize.value[i]=n.shadowMapSize,e.shadowMatrix.value[i]=n.shadowMatrix,e.shadowDarkness.value[i]=n.shadowDarkness,e.shadowBias.value[i]=n.shadowBias,i++))}}function vt(e,t){u.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&u.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function yt(){var e=T;return e>=$&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+$),T+=1,e}function xt(e,t){var i,r,a,n,s,l,h,c,p,f,d;for(p=0,f=t.length;p<f;p++)if(n=e.uniforms[t[p][1]],n)if(i=t[p][0],a=i.type,r=i.value,"i"===a)u.uniform1i(n,r);else if("f"===a)u.uniform1f(n,r);else if("v2"===a)u.uniform2f(n,r.x,r.y);else if("v3"===a)u.uniform3f(n,r.x,r.y,r.z);else if("v4"===a)u.uniform4f(n,r.x,r.y,r.z,r.w);else if("c"===a)u.uniform3f(n,r.r,r.g,r.b);else if("iv1"===a)u.uniform1iv(n,r);else if("iv"===a)u.uniform3iv(n,r);else if("fv1"===a)u.uniform1fv(n,r);else if("fv"===a)u.uniform3fv(n,r);else if("v2v"===a){for(void 0===i._array&&(i._array=new Float32Array(2*r.length)),h=0,c=r.length;h<c;h++)d=2*h,i._array[d]=r[h].x,i._array[d+1]=r[h].y;u.uniform2fv(n,i._array)}else if("v3v"===a){for(void 0===i._array&&(i._array=new Float32Array(3*r.length)),h=0,c=r.length;h<c;h++)d=3*h,i._array[d]=r[h].x,i._array[d+1]=r[h].y,i._array[d+2]=r[h].z;u.uniform3fv(n,i._array)}else if("v4v"===a){for(void 0===i._array&&(i._array=new Float32Array(4*r.length)),h=0,c=r.length;h<c;h++)d=4*h,i._array[d]=r[h].x,i._array[d+1]=r[h].y,i._array[d+2]=r[h].z,i._array[d+3]=r[h].w;u.uniform4fv(n,i._array)}else if("m4"===a)void 0===i._array&&(i._array=new Float32Array(16)),r.flattenToArray(i._array),u.uniformMatrix4fv(n,!1,i._array);else if("m4v"===a){for(void 0===i._array&&(i._array=new Float32Array(16*r.length)),h=0,c=r.length;h<c;h++)r[h].flattenToArrayOffset(i._array,16*h);u.uniformMatrix4fv(n,!1,i._array)}else if("t"===a){if(s=r,l=yt(),u.uniform1i(n,l),!s)continue;s.image instanceof Array&&6===s.image.length?zt(s,l):s instanceof o.WebGLRenderTargetCube?Vt(s,l):v.setTexture(s,l)}else if("tv"===a){for(void 0===i._array&&(i._array=[]),h=0,c=i.value.length;h<c;h++)i._array[h]=yt();for(u.uniform1iv(n,i._array),h=0,c=i.value.length;h<c;h++)s=i.value[h],l=i._array[h],s&&v.setTexture(s,l)}}function _t(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function wt(e,t,i,r){e[t]=i.r*i.r*r,e[t+1]=i.g*i.g*r,e[t+2]=i.b*i.b*r}function bt(e,t,i,r){e[t]=i.r*r,e[t+1]=i.g*r,e[t+2]=i.b*r}function St(e,t){var i,r,a,n,s,l,h,c,p,u,f=0,d=0,m=0,g=J,y=g.directional.colors,x=g.directional.positions,_=g.point.colors,w=g.point.positions,b=g.point.distances,S=g.spot.colors,M=g.spot.positions,A=g.spot.distances,T=g.spot.directions,C=g.spot.anglesCos,E=g.spot.exponents,P=g.hemi.skyColors,L=g.hemi.groundColors,R=g.hemi.positions,D=0,F=0,U=0,z=0,V=0,B=0,N=0,O=0,I=0,k=0,G=0,H=0;for(i=0,r=t.length;i<r;i++)if(a=t[i],!a.onlyShadow)if(n=a.color,h=a.intensity,u=a.distance,a instanceof o.AmbientLight){if(!a.visible)continue;v.gammaInput?(f+=n.r*n.r,d+=n.g*n.g,m+=n.b*n.b):(f+=n.r,d+=n.g,m+=n.b)}else if(a instanceof o.DirectionalLight){if(V+=1,!a.visible)continue;if(Q.copy(a.matrixWorld.getPosition()),Q.sub(a.target.matrixWorld.getPosition()),Q.normalize(),0===Q.x&&0===Q.y&&0===Q.z)continue;I=3*D,x[I]=Q.x,x[I+1]=Q.y,x[I+2]=Q.z,v.gammaInput?wt(y,I,n,h*h):bt(y,I,n,h),D+=1}else if(a instanceof o.PointLight){if(B+=1,!a.visible)continue;k=3*F,v.gammaInput?wt(_,k,n,h*h):bt(_,k,n,h),p=a.matrixWorld.getPosition(),w[k]=p.x,w[k+1]=p.y,w[k+2]=p.z,b[F]=u,F+=1}else if(a instanceof o.SpotLight){if(N+=1,!a.visible)continue;G=3*U,v.gammaInput?wt(S,G,n,h*h):bt(S,G,n,h),p=a.matrixWorld.getPosition(),M[G]=p.x,M[G+1]=p.y,M[G+2]=p.z,A[U]=u,Q.copy(p),Q.sub(a.target.matrixWorld.getPosition()),Q.normalize(),T[G]=Q.x,T[G+1]=Q.y,T[G+2]=Q.z,C[U]=Math.cos(a.angle),E[U]=a.exponent,U+=1}else if(a instanceof o.HemisphereLight){if(O+=1,!a.visible)continue;if(Q.copy(a.matrixWorld.getPosition()),Q.normalize(),0===Q.x&&0===Q.y&&0===Q.z)continue;H=3*z,R[H]=Q.x,R[H+1]=Q.y,R[H+2]=Q.z,s=a.color,l=a.groundColor,v.gammaInput?(c=h*h,wt(P,H,s,c),wt(L,H,l,c)):(bt(P,H,s,h),bt(L,H,l,h)),z+=1}for(i=3*D,r=Math.max(y.length,3*V);i<r;i++)y[i]=0;for(i=3*F,r=Math.max(_.length,3*B);i<r;i++)_[i]=0;for(i=3*U,r=Math.max(S.length,3*N);i<r;i++)S[i]=0;for(i=3*z,r=Math.max(P.length,3*O);i<r;i++)P[i]=0;for(i=3*z,r=Math.max(L.length,3*O);i<r;i++)L[i]=0;g.directional.length=D,g.point.length=F,g.spot.length=U,g.hemi.length=z,g.ambient[0]=f,g.ambient[1]=d,g.ambient[2]=m}function Mt(e){e!==N&&(u.lineWidth(e),N=e)}function At(e,t,i){z!==e&&(e?u.enable(u.POLYGON_OFFSET_FILL):u.disable(u.POLYGON_OFFSET_FILL),z=e),!e||V===t&&B===i||(u.polygonOffset(t,i),V=t,B=i)}function Tt(e){var t,i,r=[];for(var a in e)t=e[a],!1!==t&&(i="#define "+a+" "+t,r.push(i));return r.join("\n")}function Ct(e,t,r,a,n,s,l){var h,c,p,f,d,m=[];for(p in e?m.push(e):(m.push(t),m.push(r)),s)m.push(p),m.push(s[p]);for(h in l)m.push(h),m.push(l[h]);for(d=m.join(),h=0,c=y.length;h<c;h++){var g=y[h];if(g.code===d)return g.usedTimes++,g.program}var _="SHADOWMAP_TYPE_BASIC";l.shadowMapType===o.PCFShadowMap?_="SHADOWMAP_TYPE_PCF":l.shadowMapType===o.PCFSoftShadowMap&&(_="SHADOWMAP_TYPE_PCF_SOFT");var w=Tt(s);f=u.createProgram();var b,S,M,A,T=["precision "+i+" float;",w,re?"#define VERTEX_TEXTURES":"",v.gammaInput?"#define GAMMA_INPUT":"",v.gammaOutput?"#define GAMMA_OUTPUT":"",v.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,"#define MAX_BONES "+l.maxBones,l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.lightMap?"#define USE_LIGHTMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.vertexColors?"#define USE_COLOR":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.boneTextureWidth?"#define N_BONE_PIXEL_X "+l.boneTextureWidth.toFixed(1):"",l.boneTextureHeight?"#define N_BONE_PIXEL_Y "+l.boneTextureHeight.toFixed(1):"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals?"#define USE_MORPHNORMALS":"",l.perPixel?"#define PHONG_PER_PIXEL":"",l.wrapAround?"#define WRAP_AROUND":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+_:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),C=["precision "+i+" float;",l.bumpMap||l.normalMap?"#extension GL_OES_standard_derivatives : enable":"",w,"#define MAX_DIR_LIGHTS "+l.maxDirLights,"#define MAX_POINT_LIGHTS "+l.maxPointLights,"#define MAX_SPOT_LIGHTS "+l.maxSpotLights,"#define MAX_HEMI_LIGHTS "+l.maxHemiLights,"#define MAX_SHADOWS "+l.maxShadows,l.alphaTest?"#define ALPHATEST "+l.alphaTest:"",v.gammaInput?"#define GAMMA_INPUT":"",v.gammaOutput?"#define GAMMA_OUTPUT":"",v.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.lightMap?"#define USE_LIGHTMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.vertexColors?"#define USE_COLOR":"",l.metal?"#define METAL":"",l.perPixel?"#define PHONG_PER_PIXEL":"",l.wrapAround?"#define WRAP_AROUND":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+_:"",l.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",l.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),E=Rt("fragment",C+t),P=Rt("vertex",T+r);for(S in u.attachShader(f,P),u.attachShader(f,E),u.linkProgram(f),u.getProgramParameter(f,u.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+u.getProgramParameter(f,u.VALIDATE_STATUS)+", gl error ["+u.getError()+"]"),u.deleteShader(E),u.deleteShader(P),f.uniforms={},f.attributes={},b=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],l.useVertexTexture?b.push("boneTexture"):b.push("boneGlobalMatrices"),a)b.push(S);for(Et(f,b),b=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],A=0;A<l.maxMorphTargets;A++)b.push("morphTarget"+A);for(A=0;A<l.maxMorphNormals;A++)b.push("morphNormal"+A);for(M in n)b.push(M);return Pt(f,b),f.id=x++,y.push({program:f,code:d,usedTimes:1}),v.info.memory.programs=y.length,f}function Et(e,t){var i,r,a;for(i=0,r=t.length;i<r;i++)a=t[i],e.uniforms[a]=u.getUniformLocation(e,a)}function Pt(e,t){var i,r,a;for(i=0,r=t.length;i<r;i++)a=t[i],e.attributes[a]=u.getAttribLocation(e,a)}function Lt(e){for(var t=e.split("\n"),i=0,r=t.length;i<r;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function Rt(e,t){var i;return"fragment"===e?i=u.createShader(u.FRAGMENT_SHADER):"vertex"===e&&(i=u.createShader(u.VERTEX_SHADER)),u.shaderSource(i,t),u.compileShader(i),u.getShaderParameter(i,u.COMPILE_STATUS)?i:(console.error(u.getShaderInfoLog(i)),console.error(Lt(t)),null)}function Dt(e){return 0===(e&e-1)}function Ft(e,t,i){i?(u.texParameteri(e,u.TEXTURE_WRAP_S,kt(t.wrapS)),u.texParameteri(e,u.TEXTURE_WRAP_T,kt(t.wrapT)),u.texParameteri(e,u.TEXTURE_MAG_FILTER,kt(t.magFilter)),u.texParameteri(e,u.TEXTURE_MIN_FILTER,kt(t.minFilter))):(u.texParameteri(e,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(e,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(e,u.TEXTURE_MAG_FILTER,It(t.magFilter)),u.texParameteri(e,u.TEXTURE_MIN_FILTER,It(t.minFilter))),m&&t.type!==o.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(u.texParameterf(e,m.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,ie)),t.__oldAnisotropy=t.anisotropy)}function Ut(e,t){if(e.width<=t&&e.height<=t)return e;var i=Math.max(e.width,e.height),r=Math.floor(e.width*t/i),a=Math.floor(e.height*t/i),o=document.createElement("canvas");o.width=r,o.height=a;var n=o.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,r,a),o}function zt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.image.__webglTextureCube=u.createTexture(),v.info.memory.textures++),u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof o.CompressedTexture,r=[],a=0;a<6;a++)v.autoScaleCubemaps&&!i?r[a]=Ut(e.image[a],te):r[a]=e.image[a];var n=r[0],s=Dt(n.width)&&Dt(n.height),l=kt(e.format),h=kt(e.type);Ft(u.TEXTURE_CUBE_MAP,e,s);for(a=0;a<6;a++)if(i)for(var c,p=r[a].mipmaps,f=0,d=p.length;f<d;f++)c=p[f],u.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+a,f,l,c.width,c.height,0,c.data);else u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,l,l,h,r[a]);e.generateMipmaps&&s&&u.generateMipmap(u.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function Vt(e,t){u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_CUBE_MAP,e.__webglTexture)}function Bt(e,t,i){u.bindFramebuffer(u.FRAMEBUFFER,e),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function Nt(e,t){u.bindRenderbuffer(u.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,t.width,t.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,t.width,t.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,e)):u.renderbufferStorage(u.RENDERBUFFER,u.RGBA4,t.width,t.height)}function Ot(e){e instanceof o.WebGLRenderTargetCube?(u.bindTexture(u.TEXTURE_CUBE_MAP,e.__webglTexture),u.generateMipmap(u.TEXTURE_CUBE_MAP),u.bindTexture(u.TEXTURE_CUBE_MAP,null)):(u.bindTexture(u.TEXTURE_2D,e.__webglTexture),u.generateMipmap(u.TEXTURE_2D),u.bindTexture(u.TEXTURE_2D,null))}function It(e){return e===o.NearestFilter||e===o.NearestMipMapNearestFilter||e===o.NearestMipMapLinearFilter?u.NEAREST:u.LINEAR}function kt(e){if(e===o.RepeatWrapping)return u.REPEAT;if(e===o.ClampToEdgeWrapping)return u.CLAMP_TO_EDGE;if(e===o.MirroredRepeatWrapping)return u.MIRRORED_REPEAT;if(e===o.NearestFilter)return u.NEAREST;if(e===o.NearestMipMapNearestFilter)return u.NEAREST_MIPMAP_NEAREST;if(e===o.NearestMipMapLinearFilter)return u.NEAREST_MIPMAP_LINEAR;if(e===o.LinearFilter)return u.LINEAR;if(e===o.LinearMipMapNearestFilter)return u.LINEAR_MIPMAP_NEAREST;if(e===o.LinearMipMapLinearFilter)return u.LINEAR_MIPMAP_LINEAR;if(e===o.UnsignedByteType)return u.UNSIGNED_BYTE;if(e===o.UnsignedShort4444Type)return u.UNSIGNED_SHORT_4_4_4_4;if(e===o.UnsignedShort5551Type)return u.UNSIGNED_SHORT_5_5_5_1;if(e===o.UnsignedShort565Type)return u.UNSIGNED_SHORT_5_6_5;if(e===o.ByteType)return u.BYTE;if(e===o.ShortType)return u.SHORT;if(e===o.UnsignedShortType)return u.UNSIGNED_SHORT;if(e===o.IntType)return u.INT;if(e===o.UnsignedIntType)return u.UNSIGNED_INT;if(e===o.FloatType)return u.FLOAT;if(e===o.AlphaFormat)return u.ALPHA;if(e===o.RGBFormat)return u.RGB;if(e===o.RGBAFormat)return u.RGBA;if(e===o.LuminanceFormat)return u.LUMINANCE;if(e===o.LuminanceAlphaFormat)return u.LUMINANCE_ALPHA;if(e===o.AddEquation)return u.FUNC_ADD;if(e===o.SubtractEquation)return u.FUNC_SUBTRACT;if(e===o.ReverseSubtractEquation)return u.FUNC_REVERSE_SUBTRACT;if(e===o.ZeroFactor)return u.ZERO;if(e===o.OneFactor)return u.ONE;if(e===o.SrcColorFactor)return u.SRC_COLOR;if(e===o.OneMinusSrcColorFactor)return u.ONE_MINUS_SRC_COLOR;if(e===o.SrcAlphaFactor)return u.SRC_ALPHA;if(e===o.OneMinusSrcAlphaFactor)return u.ONE_MINUS_SRC_ALPHA;if(e===o.DstAlphaFactor)return u.DST_ALPHA;if(e===o.OneMinusDstAlphaFactor)return u.ONE_MINUS_DST_ALPHA;if(e===o.DstColorFactor)return u.DST_COLOR;if(e===o.OneMinusDstColorFactor)return u.ONE_MINUS_DST_COLOR;if(e===o.SrcAlphaSaturateFactor)return u.SRC_ALPHA_SATURATE;if(void 0!==g){if(e===o.RGB_S3TC_DXT1_Format)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT1_Format)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT3_Format)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===o.RGBA_S3TC_DXT5_Format)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Gt(e){if(ae&&e&&e.useVertexTexture)return 1024;var t=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),r=i;return void 0!==e&&e instanceof o.SkinnedMesh&&(r=Math.min(e.bones.length,r),r<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")),r}function Ht(e){var t,i,r,a,n,s,l;for(a=n=s=l=0,t=0,i=e.length;t<i;t++)r=e[t],r.onlyShadow||(r instanceof o.DirectionalLight&&a++,r instanceof o.PointLight&&n++,r instanceof o.SpotLight&&s++,r instanceof o.HemisphereLight&&l++);return{directional:a,point:n,spot:s,hemi:l}}function Wt(e){var t,i,r,a=0;for(t=0,i=e.length;t<i;t++)r=e[t],r.castShadow&&(r instanceof o.SpotLight&&a++,r instanceof o.DirectionalLight&&!r.shadowCascade&&a++);return a}function jt(){try{if(!(u=t.getContext("experimental-webgl",{alpha:a,premultipliedAlpha:n,antialias:s,stencil:l,preserveDrawingBuffer:h})))throw"Error creating WebGL context."}catch(e){console.error(e)}f=u.getExtension("OES_texture_float"),d=u.getExtension("OES_standard_derivatives"),m=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),g=u.getExtension("WEBGL_compressed_texture_s3tc")||u.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),f||console.log("THREE.WebGLRenderer: Float textures not supported."),d||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),m||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),g||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}function Xt(){u.clearColor(0,0,0,1),u.clearDepth(1),u.clearStencil(0),u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),u.frontFace(u.CCW),u.cullFace(u.BACK),u.enable(u.CULL_FACE),u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),u.clearColor(c.r,c.g,c.b,p)}this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=u.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=u.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=u.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=u.createBuffer()),e.hasPositions&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,e.positionArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.position),u.vertexAttribPointer(t.attributes.position,3,u.FLOAT,!1,0,0)),e.hasNormals){if(u.bindBuffer(u.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===o.FlatShading){var r,a,n,s,l,h,c,p,f,d,m,g,v,y,x=3*e.count;for(y=0;y<x;y+=9)v=e.normalArray,s=v[y],c=v[y+1],d=v[y+2],l=v[y+3],p=v[y+4],m=v[y+5],h=v[y+6],f=v[y+7],g=v[y+8],r=(s+l+h)/3,a=(c+p+f)/3,n=(d+m+g)/3,v[y]=r,v[y+1]=a,v[y+2]=n,v[y+3]=r,v[y+4]=a,v[y+5]=n,v[y+6]=r,v[y+7]=a,v[y+8]=n}u.bufferData(u.ARRAY_BUFFER,e.normalArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.normal),u.vertexAttribPointer(t.attributes.normal,3,u.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglUvBuffer),u.bufferData(u.ARRAY_BUFFER,e.uvArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.uv),u.vertexAttribPointer(t.attributes.uv,2,u.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==o.NoColors&&(u.bindBuffer(u.ARRAY_BUFFER,e.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,e.colorArray,u.DYNAMIC_DRAW),u.enableVertexAttribArray(t.attributes.color),u.vertexAttribPointer(t.attributes.color,3,u.FLOAT,!1,0,0)),u.drawArrays(u.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,a,n){if(!1!==r.visible){var s,l;s=st(e,t,i,r,n),l=s.attributes;var h=!1,c=r.wireframe?1:0,p=16777215*a.id+2*s.id+c;if(p!==S&&(S=p,h=!0),h&&ke(),n instanceof o.Mesh){var f=a.attributes["index"];if(f){var d=a.offsets;d.length>1&&(h=!0);for(var m=0,g=d.length;m<g;m++){var y=d[m].index;if(h){var x=a.attributes["position"],_=x.itemSize;u.bindBuffer(u.ARRAY_BUFFER,x.buffer),Ie(l.position),u.vertexAttribPointer(l.position,_,u.FLOAT,!1,0,y*_*4);var w=a.attributes["normal"];if(l.normal>=0&&w){var b=w.itemSize;u.bindBuffer(u.ARRAY_BUFFER,w.buffer),Ie(l.normal),u.vertexAttribPointer(l.normal,b,u.FLOAT,!1,0,y*b*4)}var M=a.attributes["uv"];if(l.uv>=0&&M){var A=M.itemSize;u.bindBuffer(u.ARRAY_BUFFER,M.buffer),Ie(l.uv),u.vertexAttribPointer(l.uv,A,u.FLOAT,!1,0,y*A*4)}var T=a.attributes["color"];if(l.color>=0&&T){var C=T.itemSize;u.bindBuffer(u.ARRAY_BUFFER,T.buffer),Ie(l.color),u.vertexAttribPointer(l.color,C,u.FLOAT,!1,0,y*C*4)}var E=a.attributes["tangent"];if(l.tangent>=0&&E){var P=E.itemSize;u.bindBuffer(u.ARRAY_BUFFER,E.buffer),Ie(l.tangent),u.vertexAttribPointer(l.tangent,P,u.FLOAT,!1,0,y*P*4)}u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,f.buffer)}u.drawElements(u.TRIANGLES,d[m].count,u.UNSIGNED_SHORT,2*d[m].start),v.info.render.calls++,v.info.render.vertices+=d[m].count,v.info.render.faces+=d[m].count/3}}else{if(h){x=a.attributes["position"],_=x.itemSize;u.bindBuffer(u.ARRAY_BUFFER,x.buffer),Ie(l.position),u.vertexAttribPointer(l.position,_,u.FLOAT,!1,0,0);w=a.attributes["normal"];if(l.normal>=0&&w){b=w.itemSize;u.bindBuffer(u.ARRAY_BUFFER,w.buffer),Ie(l.normal),u.vertexAttribPointer(l.normal,b,u.FLOAT,!1,0,0)}M=a.attributes["uv"];if(l.uv>=0&&M){A=M.itemSize;u.bindBuffer(u.ARRAY_BUFFER,M.buffer),Ie(l.uv),u.vertexAttribPointer(l.uv,A,u.FLOAT,!1,0,0)}T=a.attributes["color"];if(l.color>=0&&T){C=T.itemSize;u.bindBuffer(u.ARRAY_BUFFER,T.buffer),Ie(l.color),u.vertexAttribPointer(l.color,C,u.FLOAT,!1,0,0)}E=a.attributes["tangent"];if(l.tangent>=0&&E){P=E.itemSize;u.bindBuffer(u.ARRAY_BUFFER,E.buffer),Ie(l.tangent),u.vertexAttribPointer(l.tangent,P,u.FLOAT,!1,0,0)}}u.drawArrays(u.TRIANGLES,0,x.numItems/3),v.info.render.calls++,v.info.render.vertices+=x.numItems/3,v.info.render.faces+=x.numItems/3/3}}else if(n instanceof o.ParticleSystem){if(h){x=a.attributes["position"],_=x.itemSize;u.bindBuffer(u.ARRAY_BUFFER,x.buffer),Ie(l.position),u.vertexAttribPointer(l.position,_,u.FLOAT,!1,0,0);T=a.attributes["color"];if(l.color>=0&&T){C=T.itemSize;u.bindBuffer(u.ARRAY_BUFFER,T.buffer),Ie(l.color),u.vertexAttribPointer(l.color,C,u.FLOAT,!1,0,0)}u.drawArrays(u.POINTS,0,x.numItems/3),v.info.render.calls++,v.info.render.points+=x.numItems/3}}else if(n instanceof o.Line&&h){x=a.attributes["position"],_=x.itemSize;u.bindBuffer(u.ARRAY_BUFFER,x.buffer),Ie(l.position),u.vertexAttribPointer(l.position,_,u.FLOAT,!1,0,0);T=a.attributes["color"];if(l.color>=0&&T){C=T.itemSize;u.bindBuffer(u.ARRAY_BUFFER,T.buffer),Ie(l.color),u.vertexAttribPointer(l.color,C,u.FLOAT,!1,0,0)}u.drawArrays(u.LINE_STRIP,0,x.numItems/3),v.info.render.calls++,v.info.render.points+=x.numItems}}},this.renderBuffer=function(e,t,i,r,a,n){if(!1!==r.visible){var s,l,h,c,p,f;s=st(e,t,i,r,n),l=s.attributes;var d=!1,m=r.wireframe?1:0,g=16777215*a.id+2*s.id+m;if(g!==S&&(S=g,d=!0),d&&ke(),!r.morphTargets&&l.position>=0?d&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglVertexBuffer),Ie(l.position),u.vertexAttribPointer(l.position,3,u.FLOAT,!1,0,0)):n.morphTargetBase&&Ge(r,a,n),d){if(a.__webglCustomAttributesList)for(p=0,f=a.__webglCustomAttributesList.length;p<f;p++)c=a.__webglCustomAttributesList[p],l[c.buffer.belongsToAttribute]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,c.buffer),Ie(l[c.buffer.belongsToAttribute]),u.vertexAttribPointer(l[c.buffer.belongsToAttribute],c.size,u.FLOAT,!1,0,0));l.color>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglColorBuffer),Ie(l.color),u.vertexAttribPointer(l.color,3,u.FLOAT,!1,0,0)),l.normal>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglNormalBuffer),Ie(l.normal),u.vertexAttribPointer(l.normal,3,u.FLOAT,!1,0,0)),l.tangent>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglTangentBuffer),Ie(l.tangent),u.vertexAttribPointer(l.tangent,4,u.FLOAT,!1,0,0)),l.uv>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglUVBuffer),Ie(l.uv),u.vertexAttribPointer(l.uv,2,u.FLOAT,!1,0,0)),l.uv2>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglUV2Buffer),Ie(l.uv2),u.vertexAttribPointer(l.uv2,2,u.FLOAT,!1,0,0)),r.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglSkinIndicesBuffer),Ie(l.skinIndex),u.vertexAttribPointer(l.skinIndex,4,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,a.__webglSkinWeightsBuffer),Ie(l.skinWeight),u.vertexAttribPointer(l.skinWeight,4,u.FLOAT,!1,0,0)),l.lineDistance>=0&&(u.bindBuffer(u.ARRAY_BUFFER,a.__webglLineDistanceBuffer),Ie(l.lineDistance),u.vertexAttribPointer(l.lineDistance,1,u.FLOAT,!1,0,0))}n instanceof o.Mesh?(r.wireframe?(Mt(r.wireframeLinewidth),d&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),u.drawElements(u.LINES,a.__webglLineCount,u.UNSIGNED_SHORT,0)):(d&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),u.drawElements(u.TRIANGLES,a.__webglFaceCount,u.UNSIGNED_SHORT,0)),v.info.render.calls++,v.info.render.vertices+=a.__webglFaceCount,v.info.render.faces+=a.__webglFaceCount/3):n instanceof o.Line?(h=n.type===o.LineStrip?u.LINE_STRIP:u.LINES,Mt(r.linewidth),u.drawArrays(h,0,a.__webglLineCount),v.info.render.calls++):n instanceof o.ParticleSystem?(u.drawArrays(u.POINTS,0,a.__webglParticleCount),v.info.render.calls++,v.info.render.points+=a.__webglParticleCount):n instanceof o.Ribbon&&(u.drawArrays(u.TRIANGLE_STRIP,0,a.__webglVertexCount),v.info.render.calls++)}},this.render=function(e,t,i,r){if(t instanceof o.Camera!==!1){var a,n,s,l,h,c=e.__lights,p=e.fog;for(b=-1,Z=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),Y.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),X.setFromMatrix(Y),this.autoUpdateObjects&&this.initWebGLObjects(e),je(this.renderPluginsPre,e,t),v.info.render.calls=0,v.info.render.vertices=0,v.info.render.faces=0,v.info.render.points=0,this.setRenderTarget(i),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=e.__webglObjects,a=0,n=h.length;a<n;a++)s=h[a],l=s.object,s.render=!1,l.visible&&((l instanceof o.Mesh||l instanceof o.ParticleSystem)&&l.frustumCulled&&!X.intersectsObject(l)||(_t(l,t),Ke(s),s.render=!0,!0===this.sortObjects&&(null!==l.renderDepth?s.z=l.renderDepth:(K.copy(l.matrixWorld.getPosition()),K.applyProjection(Y),s.z=K.z),s.id=l.id)));for(this.sortObjects&&h.sort(He),h=e.__webglObjectsImmediate,a=0,n=h.length;a<n;a++)s=h[a],l=s.object,l.visible&&(_t(l,t),qe(s));if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),At(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),Xe(e.__webglObjects,!1,"",t,c,p,!0,u),Ye(e.__webglObjectsImmediate,"",t,c,p,!1,u)}else{u=null;this.setBlending(o.NoBlending),Xe(e.__webglObjects,!0,"opaque",t,c,p,!1,u),Ye(e.__webglObjectsImmediate,"opaque",t,c,p,!1,u),Xe(e.__webglObjects,!1,"transparent",t,c,p,!0,u),Ye(e.__webglObjectsImmediate,"transparent",t,c,p,!0,u)}je(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==o.NearestFilter&&i.minFilter!==o.LinearFilter&&Ot(i),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,i,r,a){var o=st(e,t,i,r,a);S=-1,v.setMaterialFaces(r),a.immediateRenderCallback?a.immediateRenderCallback(o,u,X):a.render((function(e){v.renderBufferImmediate(e,o,r)}))},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);while(e.__objectsAdded.length)Ze(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);while(e.__objectsRemoved.length)rt(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;t<i;t++)et(e.__webglObjects[t].object)},this.initMaterial=function(e,t,i,r){var a,n,s,l,h,c,p;e.addEventListener("dispose",ye),e instanceof o.MeshDepthMaterial?p="depth":e instanceof o.MeshNormalMaterial?p="normal":e instanceof o.MeshBasicMaterial?p="basic":e instanceof o.MeshLambertMaterial?p="lambert":e instanceof o.MeshPhongMaterial?p="phong":e instanceof o.LineBasicMaterial?p="basic":e instanceof o.LineDashedMaterial?p="dashed":e instanceof o.ParticleBasicMaterial&&(p="particle_basic"),p&&nt(e,o.ShaderLib[p]),l=Ht(t),c=Wt(t),h=Gt(r),s={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof o.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:h,useVertexTexture:ae&&r&&r.useVertexTexture,boneTextureWidth:r&&r.boneTextureWidth,boneTextureHeight:r&&r.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===o.DoubleSide,flipSided:e.side===o.BackSide},e.program=Ct(p,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,s);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var f="morphTarget";for(n=0;n<this.maxMorphTargets;n++)d=f+n,u[d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var d;f="morphNormal";for(n=0;n<this.maxMorphNormals;n++)d=f+n,u[d]>=0&&e.numSupportedMorphNormals++}for(a in e.uniformsList=[],e.uniforms)e.uniformsList.push([e.uniforms[a],a])},this.setFaceCulling=function(e,t){e===o.CullFaceNone?u.disable(u.CULL_FACE):(t===o.FrontFaceDirectionCW?u.frontFace(u.CW):u.frontFace(u.CCW),e===o.CullFaceBack?u.cullFace(u.BACK):e===o.CullFaceFront?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK),u.enable(u.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===o.DoubleSide,i=e.side===o.BackSide;C!==t&&(t?u.disable(u.CULL_FACE):u.enable(u.CULL_FACE),C=t),E!==i&&(i?u.frontFace(u.CW):u.frontFace(u.CCW),E=i)},this.setDepthTest=function(e){F!==e&&(e?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),F=e)},this.setDepthWrite=function(e){U!==e&&(u.depthMask(e),U=e)},this.setBlending=function(e,t,i,r){e!==P&&(e===o.NoBlending?u.disable(u.BLEND):e===o.AdditiveBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE)):e===o.SubtractiveBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ZERO,u.ONE_MINUS_SRC_COLOR)):e===o.MultiplyBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ZERO,u.SRC_COLOR)):e===o.CustomBlending?u.enable(u.BLEND):(u.enable(u.BLEND),u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA)),P=e),e===o.CustomBlending?(t!==L&&(u.blendEquation(kt(t)),L=t),i===R&&r===D||(u.blendFunc(kt(i),kt(r)),R=i,D=r)):(L=null,R=null,D=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",ge),e.__webglTexture=u.createTexture(),v.info.memory.textures++),u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_2D,e.__webglTexture),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,e.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,r=Dt(i.width)&&Dt(i.height),a=kt(e.format),n=kt(e.type);Ft(u.TEXTURE_2D,e,r);var s,l=e.mipmaps;if(e instanceof o.DataTexture)if(l.length>0&&r){for(var h=0,c=l.length;h<c;h++)s=l[h],u.texImage2D(u.TEXTURE_2D,h,a,s.width,s.height,0,a,n,s.data);e.generateMipmaps=!1}else u.texImage2D(u.TEXTURE_2D,0,a,i.width,i.height,0,a,n,i.data);else if(e instanceof o.CompressedTexture)for(h=0,c=l.length;h<c;h++)s=l[h],u.compressedTexImage2D(u.TEXTURE_2D,h,a,s.width,s.height,0,s.data);else if(l.length>0&&r){for(h=0,c=l.length;h<c;h++)s=l[h],u.texImage2D(u.TEXTURE_2D,h,a,a,n,s);e.generateMipmaps=!1}else u.texImage2D(u.TEXTURE_2D,0,a,a,n,e.image);e.generateMipmaps&&r&&u.generateMipmap(u.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else u.activeTexture(u.TEXTURE0+t),u.bindTexture(u.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,i,r,a,n,s=e instanceof o.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",ve),e.__webglTexture=u.createTexture(),v.info.memory.textures++;var l=Dt(e.width)&&Dt(e.height),h=kt(e.format),c=kt(e.type);if(s){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],u.bindTexture(u.TEXTURE_CUBE_MAP,e.__webglTexture),Ft(u.TEXTURE_CUBE_MAP,e,l);for(var p=0;p<6;p++)e.__webglFramebuffer[p]=u.createFramebuffer(),e.__webglRenderbuffer[p]=u.createRenderbuffer(),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+p,0,h,e.width,e.height,0,h,c,null),Bt(e.__webglFramebuffer[p],e,u.TEXTURE_CUBE_MAP_POSITIVE_X+p),Nt(e.__webglRenderbuffer[p],e);l&&u.generateMipmap(u.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=u.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=u.createRenderbuffer(),u.bindTexture(u.TEXTURE_2D,e.__webglTexture),Ft(u.TEXTURE_2D,e,l),u.texImage2D(u.TEXTURE_2D,0,h,e.width,e.height,0,h,c,null),Bt(e.__webglFramebuffer,e,u.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,e.__webglRenderbuffer):Nt(e.__webglRenderbuffer,e),l&&u.generateMipmap(u.TEXTURE_2D);s?u.bindTexture(u.TEXTURE_CUBE_MAP,null):u.bindTexture(u.TEXTURE_2D,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null)}e?(t=s?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,i=e.width,r=e.height,a=0,n=0):(t=null,i=k,r=G,a=O,n=I),t!==w&&(u.bindFramebuffer(u.FRAMEBUFFER,t),u.viewport(a,n,i,r),w=t),H=i,W=r},this.shadowMapPlugin=new o.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new o.SpritePlugin),this.addPostPlugin(new o.LensFlarePlugin)},o.WebGLRenderTarget=function(e,t,i){o.EventDispatcher.call(this),this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:o.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:o.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:o.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:o.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.format=void 0!==i.format?i.format:o.RGBAFormat,this.type=void 0!==i.type?i.type:o.UnsignedByteType,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},o.WebGLRenderTarget.prototype.clone=function(){var e=new o.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},o.WebGLRenderTarget.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},o.WebGLRenderTargetCube=function(e,t,i){o.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},o.WebGLRenderTargetCube.prototype=Object.create(o.WebGLRenderTarget.prototype),o.RenderableVertex=function(){this.positionWorld=new o.Vector3,this.positionScreen=new o.Vector4,this.visible=!0},o.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},o.RenderableFace3=function(){this.v1=new o.RenderableVertex,this.v2=new o.RenderableVertex,this.v3=new o.RenderableVertex,this.centroidModel=new o.Vector3,this.normalModel=new o.Vector3,this.normalModelView=new o.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new o.Vector3,new o.Vector3,new o.Vector3],this.vertexNormalsModelView=[new o.Vector3,new o.Vector3,new o.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},o.RenderableFace4=function(){this.v1=new o.RenderableVertex,this.v2=new o.RenderableVertex,this.v3=new o.RenderableVertex,this.v4=new o.RenderableVertex,this.centroidModel=new o.Vector3,this.normalModel=new o.Vector3,this.normalModelView=new o.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],this.vertexNormalsModelView=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},o.RenderableObject=function(){this.object=null,this.z=null},o.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new o.Vector2,this.material=null},o.RenderableLine=function(){this.z=null,this.v1=new o.RenderableVertex,this.v2=new o.RenderableVertex,this.material=null},o.ColorUtils={adjustHSV:function(e,t,i,r){var a=o.ColorUtils.__hsv;e.getHSV(a),a.h=o.Math.clamp(a.h+t,0,1),a.s=o.Math.clamp(a.s+i,0,1),a.v=o.Math.clamp(a.v+r,0,1),e.setHSV(a.h,a.s,a.v)}},o.ColorUtils.__hsv={h:0,s:0,v:0},o.GeometryUtils={merge:function(e,t){var i,r,a=e.vertices.length,n=(e.faceVertexUvs[0].length,t instanceof o.Mesh?t.geometry:t),s=e.vertices,l=n.vertices,h=e.faces,c=n.faces,p=e.faceVertexUvs[0],u=n.faceVertexUvs[0];t instanceof o.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,r=new o.Matrix3,r.getInverse(i),r.transpose());for(var f=0,d=l.length;f<d;f++){var m=l[f],g=m.clone();i&&g.applyMatrix4(i),s.push(g)}for(f=0,d=c.length;f<d;f++){var v,y,x,_=c[f],w=_.vertexNormals,b=_.vertexColors;_ instanceof o.Face3?v=new o.Face3(_.a+a,_.b+a,_.c+a):_ instanceof o.Face4&&(v=new o.Face4(_.a+a,_.b+a,_.c+a,_.d+a)),v.normal.copy(_.normal),r&&v.normal.applyMatrix3(r).normalize();for(var S=0,M=w.length;S<M;S++)y=w[S].clone(),r&&y.applyMatrix3(r).normalize(),v.vertexNormals.push(y);v.color.copy(_.color);for(S=0,M=b.length;S<M;S++)x=b[S],v.vertexColors.push(x.clone());v.materialIndex=_.materialIndex,v.centroid.copy(_.centroid),i&&v.centroid.applyMatrix4(i),h.push(v)}for(f=0,d=u.length;f<d;f++){var A=u[f],T=[];for(S=0,M=A.length;S<M;S++)T.push(new o.Vector2(A[S].x,A[S].y));p.push(T)}},removeMaterials:function(e,t){for(var i={},r=0,a=t.length;r<a;r++)i[t[r]]=!0;var o,n=[];for(r=0,a=e.faces.length;r<a;r++)o=e.faces[r],o.materialIndex in i||n.push(o);e.faces=n},randomPointInTriangle:function(e,t,i){var r,a,n,s=new o.Vector3,l=o.GeometryUtils.__v1;return r=o.GeometryUtils.random(),a=o.GeometryUtils.random(),r+a>1&&(r=1-r,a=1-a),n=1-r-a,s.copy(e),s.multiplyScalar(r),l.copy(t),l.multiplyScalar(a),s.add(l),l.copy(i),l.multiplyScalar(n),s.add(l),s},randomPointInFace:function(e,t,i){var r,a,n,s;if(e instanceof o.Face3)return r=t.vertices[e.a],a=t.vertices[e.b],n=t.vertices[e.c],o.GeometryUtils.randomPointInTriangle(r,a,n);if(e instanceof o.Face4){var l,h;r=t.vertices[e.a],a=t.vertices[e.b],n=t.vertices[e.c],s=t.vertices[e.d],i?e._area1&&e._area2?(l=e._area1,h=e._area2):(l=o.GeometryUtils.triangleArea(r,a,s),h=o.GeometryUtils.triangleArea(a,n,s),e._area1=l,e._area2=h):(l=o.GeometryUtils.triangleArea(r,a,s),h=o.GeometryUtils.triangleArea(a,n,s));var c=o.GeometryUtils.random()*(l+h);return c<l?o.GeometryUtils.randomPointInTriangle(r,a,s):o.GeometryUtils.randomPointInTriangle(a,n,s)}},randomPointsInGeometry:function(e,t){var i,r,a,n,s,l,h=e.faces,c=e.vertices,p=h.length,u=0,f=[];for(r=0;r<p;r++)i=h[r],i instanceof o.Face3?(a=c[i.a],n=c[i.b],s=c[i.c],i._area=o.GeometryUtils.triangleArea(a,n,s)):i instanceof o.Face4&&(a=c[i.a],n=c[i.b],s=c[i.c],l=c[i.d],i._area1=o.GeometryUtils.triangleArea(a,n,l),i._area2=o.GeometryUtils.triangleArea(n,s,l),i._area=i._area1+i._area2),u+=i._area,f[r]=u;function d(e){function t(i,r){if(r<i)return i;var a=i+Math.floor((r-i)/2);return f[a]>e?t(i,a-1):f[a]<e?t(a+1,r):a}var i=t(0,f.length-1);return i}var m,g,v=[],y={};for(r=0;r<t;r++)m=o.GeometryUtils.random()*u,g=d(m),v[r]=o.GeometryUtils.randomPointInFace(h[g],e,!0),y[g]?y[g]+=1:y[g]=1;return v},triangleArea:function(e,t,i){var r=o.GeometryUtils.__v1,a=o.GeometryUtils.__v2;return r.subVectors(t,e),a.subVectors(i,e),r.cross(a),.5*r.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new o.Vector3;return i.addVectors(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new o.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},normalizeUVs:function(e){for(var t=e.faceVertexUvs[0],i=0,r=t.length;i<r;i++)for(var a=t[i],o=0,n=a.length;o<n;o++)1!==a[o].x&&(a[o].x=a[o].x-Math.floor(a[o].x)),1!==a[o].y&&(a[o].y=a[o].y-Math.floor(a[o].y))},triangulateQuads:function(e){var t,i,r,a,n=[],s=[],l=[];for(t=0,i=e.faceUvs.length;t<i;t++)s[t]=[];for(t=0,i=e.faceVertexUvs.length;t<i;t++)l[t]=[];for(t=0,i=e.faces.length;t<i;t++){var h=e.faces[t];if(h instanceof o.Face4){var c=h.a,p=h.b,u=h.c,f=h.d,d=new o.Face3,m=new o.Face3;for(d.color.copy(h.color),m.color.copy(h.color),d.materialIndex=h.materialIndex,m.materialIndex=h.materialIndex,d.a=c,d.b=p,d.c=f,m.a=p,m.b=u,m.c=f,4===h.vertexColors.length&&(d.vertexColors[0]=h.vertexColors[0].clone(),d.vertexColors[1]=h.vertexColors[1].clone(),d.vertexColors[2]=h.vertexColors[3].clone(),m.vertexColors[0]=h.vertexColors[1].clone(),m.vertexColors[1]=h.vertexColors[2].clone(),m.vertexColors[2]=h.vertexColors[3].clone()),n.push(d,m),r=0,a=e.faceVertexUvs.length;r<a;r++)if(e.faceVertexUvs[r].length){var g=e.faceVertexUvs[r][t],v=g[0],y=g[1],x=g[2],_=g[3],w=[v.clone(),y.clone(),_.clone()],b=[y.clone(),x.clone(),_.clone()];l[r].push(w,b)}for(r=0,a=e.faceUvs.length;r<a;r++)if(e.faceUvs[r].length){var S=e.faceUvs[r][t];s[r].push(S,S)}}else{for(n.push(h),r=0,a=e.faceUvs.length;r<a;r++)s[r].push(e.faceUvs[r][t]);for(r=0,a=e.faceVertexUvs.length;r<a;r++)l[r].push(e.faceVertexUvs[r][t])}}e.faces=n,e.faceUvs=s,e.faceVertexUvs=l,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,i,r){for(var a=e.faces,o=i||0,n=r||a.length-1,s=o;s<=n;s++)a[s].materialIndex=t}},o.GeometryUtils.random=o.Math.random16,o.GeometryUtils.__v1=new o.Vector3,o.GeometryUtils.__v2=new o.Vector3,o.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i,r){var a=new Image,n=new o.Texture(a,t),s=new o.ImageLoader;return s.addEventListener("load",(function(e){n.image=e.content,n.needsUpdate=!0,i&&i(n)})),s.addEventListener("error",(function(e){r&&r(e.message)})),s.crossOrigin=this.crossOrigin,s.load(e,a),n.sourceFile=e,n},loadCompressedTexture:function(e,t,i,r){var a=new o.CompressedTexture;a.mapping=t;var n=new XMLHttpRequest;return n.onload=function(){var e=n.response,t=o.ImageUtils.parseDDS(e,!0);a.format=t.format,a.mipmaps=t.mipmaps,a.image.width=t.width,a.image.height=t.height,a.generateMipmaps=!1,a.needsUpdate=!0,i&&i(a)},n.onerror=r,n.open("GET",e,!0),n.responseType="arraybuffer",n.send(null),a},loadTextureCube:function(e,t,i,r){var a=[];a.loadCount=0;var n=new o.Texture;n.image=a,void 0!==t&&(n.mapping=t),n.flipY=!1;for(var s=0,l=e.length;s<l;++s){var h=new Image;a[s]=h,h.onload=function(){a.loadCount+=1,6===a.loadCount&&(n.needsUpdate=!0,i&&i(n))},h.onerror=r,h.crossOrigin=this.crossOrigin,h.src=e[s]}return n},loadCompressedTextureCube:function(e,t,i,r){var a=[];a.loadCount=0;var n=new o.CompressedTexture;n.image=a,void 0!==t&&(n.mapping=t),n.flipY=!1,n.generateMipmaps=!1;var s=function(e,t){return function(){var r=e.response,s=o.ImageUtils.parseDDS(r,!0);t.format=s.format,t.mipmaps=s.mipmaps,t.width=s.width,t.height=s.height,a.loadCount+=1,6===a.loadCount&&(n.format=s.format,n.needsUpdate=!0,i&&i(n))}};if(e instanceof Array)for(var l=0,h=e.length;l<h;++l){var c={};a[l]=c;var p=new XMLHttpRequest;p.onload=s(p,c),p.onerror=r;var u=e[l];p.open("GET",u,!0),p.responseType="arraybuffer",p.send(null)}else{u=e,p=new XMLHttpRequest;p.onload=function(){var e=p.response,t=o.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var r=t.mipmaps.length/t.mipmapCount,s=0;s<r;s++){a[s]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)a[s].mipmaps.push(t.mipmaps[s*t.mipmapCount+l]),a[s].format=t.format,a[s].width=t.width,a[s].height=t.height}n.format=t.format,n.needsUpdate=!0,i&&i(n)}},p.onerror=r,p.open("GET",u,!0),p.responseType="arraybuffer",p.send(null)}return n},parseDDS:function(e,t){var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},r=542327876,a=131072,n=512,s=4;function l(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function h(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var c,p=l("DXT1"),u=l("DXT3"),f=l("DXT5"),d=31,m=0,g=1,v=2,y=3,x=4,_=7,w=20,b=21,S=28,M=new Int32Array(e,0,d);if(M[m]!==r)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),i;if(!M[w]&s)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var A=M[b];switch(A){case p:c=8,i.format=o.RGB_S3TC_DXT1_Format;break;case u:c=16,i.format=o.RGBA_S3TC_DXT3_Format;break;case f:c=16,i.format=o.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",h(A)),i}i.mipmapCount=1,M[v]&a&&!1!==t&&(i.mipmapCount=Math.max(1,M[_])),i.isCubemap=!!(M[S]&n),i.width=M[x],i.height=M[y];for(var T=M[g]+4,C=i.width,E=i.height,P=i.isCubemap?6:1,L=0;L<P;L++){for(var R=0;R<i.mipmapCount;R++){var D=Math.max(4,C)/4*Math.max(4,E)/4*c,F=new Uint8Array(e,T,D),U={data:F,width:C,height:E};i.mipmaps.push(U),T+=D,C=Math.max(.5*C,1),E=Math.max(.5*E,1)}C=i.width,E=i.height}return i},getNormalMap:function(e,t){var i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},a=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var o=e.width,n=e.height,s=document.createElement("canvas");s.width=o,s.height=n;var l=s.getContext("2d");l.drawImage(e,0,0);for(var h=l.getImageData(0,0,o,n).data,c=l.createImageData(o,n),p=c.data,u=0;u<o;u++)for(var f=0;f<n;f++){var d=f-1<0?0:f-1,m=f+1>n-1?n-1:f+1,g=u-1<0?0:u-1,v=u+1>o-1?o-1:u+1,y=[],x=[0,0,h[4*(f*o+u)]/255*t];y.push([-1,0,h[4*(f*o+g)]/255*t]),y.push([-1,-1,h[4*(d*o+g)]/255*t]),y.push([0,-1,h[4*(d*o+u)]/255*t]),y.push([1,-1,h[4*(d*o+v)]/255*t]),y.push([1,0,h[4*(f*o+v)]/255*t]),y.push([1,1,h[4*(m*o+v)]/255*t]),y.push([0,1,h[4*(m*o+u)]/255*t]),y.push([-1,1,h[4*(m*o+g)]/255*t]);for(var _=[],w=y.length,b=0;b<w;b++){var S=y[b],M=y[(b+1)%w];S=r(S,x),M=r(M,x),_.push(a(i(S,M)))}var A=[0,0,0];for(b=0;b<_.length;b++)A[0]+=_[b][0],A[1]+=_[b][1],A[2]+=_[b][2];A[0]/=_.length,A[1]/=_.length,A[2]/=_.length;var T=4*(f*o+u);p[T]=(A[0]+1)/2*255|0,p[T+1]=(A[1]+1)/2*255|0,p[T+2]=255*A[2]|0,p[T+3]=255}return l.putImageData(c,0,0),s},generateDataTexture:function(e,t,i){for(var r=e*t,a=new Uint8Array(3*r),n=Math.floor(255*i.r),s=Math.floor(255*i.g),l=Math.floor(255*i.b),h=0;h<r;h++)a[3*h]=n,a[3*h+1]=s,a[3*h+2]=l;var c=new o.DataTexture(a,e,t,o.RGBFormat);return c.needsUpdate=!0,c}},o.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new o.Object3D,r=0,a=t.length;r<a;r++)i.add(new o.Mesh(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var r=new o.Matrix4;r.getInverse(i.matrixWorld),e.applyMatrix(r),t.remove(e),i.add(e)}},o.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;i.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,i=this.getFace(),r=this.size/i.resolution,a=0,n=String(e).split(""),s=n.length,l=[];for(t=0;t<s;t++){var h=new o.Path,c=this.extractGlyphPoints(n[t],i,r,a,h);a+=c.offset,l.push(c.path)}var p=a/2;return{paths:l,offset:p}},extractGlyphPoints:function(e,t,i,r,a){var n,s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A=[],T=t.glyphs[e]||t.glyphs["?"];if(T){if(T.o)for(h=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),p=h.length,u=i,f=i,n=0;n<p;)switch(c=h[n++],c){case"m":d=h[n++]*u+r,m=h[n++]*f,a.moveTo(d,m);break;case"l":d=h[n++]*u+r,m=h[n++]*f,a.lineTo(d,m);break;case"q":if(g=h[n++]*u+r,v=h[n++]*f,_=h[n++]*u+r,w=h[n++]*f,a.quadraticCurveTo(_,w,g,v),M=A[A.length-1],M)for(y=M.x,x=M.y,s=1,l=this.divisions;s<=l;s++){var C=s/l;o.Shape.Utils.b2(C,y,_,g),o.Shape.Utils.b2(C,x,w,v)}break;case"b":if(g=h[n++]*u+r,v=h[n++]*f,_=h[n++]*u+r,w=h[n++]*-f,b=h[n++]*u+r,S=h[n++]*-f,a.bezierCurveTo(g,v,_,w,b,S),M=A[A.length-1],M)for(y=M.x,x=M.y,s=1,l=this.divisions;s<=l;s++)C=s/l,o.Shape.Utils.b3(C,y,_,b,g),o.Shape.Utils.b3(C,x,w,S,v);break}return{offset:T.ha*i,path:a}}}},o.FontUtils.generateShapes=function(e,t){t=t||{};var i=void 0!==t.size?t.size:100,r=void 0!==t.curveSegments?t.curveSegments:4,a=void 0!==t.font?t.font:"helvetiker",n=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";o.FontUtils.size=i,o.FontUtils.divisions=r,o.FontUtils.face=a,o.FontUtils.weight=n,o.FontUtils.style=s;for(var l=o.FontUtils.drawText(e),h=l.paths,c=[],p=0,u=h.length;p<u;p++)Array.prototype.push.apply(c,h[p].toShapes());return c},function(e){var t=1e-10,i=function(e,t){var i=e.length;if(i<3)return null;var o,n,s,l=[],h=[],c=[];if(r(e)>0)for(n=0;n<i;n++)h[n]=n;else for(n=0;n<i;n++)h[n]=i-1-n;var p=i,u=2*p;for(n=p-1;p>2;){if(u--<=0)return console.log("Warning, unable to triangulate polygon!"),t?c:l;if(o=n,p<=o&&(o=0),n=o+1,p<=n&&(n=0),s=n+1,p<=s&&(s=0),a(e,o,n,s,p,h)){var f,d,m,g,v;for(f=h[o],d=h[n],m=h[s],l.push([e[f],e[d],e[m]]),c.push([h[o],h[n],h[s]]),g=n,v=n+1;v<p;g++,v++)h[g]=h[v];p--,u=2*p}}return t?c:l},r=function(e){for(var t=e.length,i=0,r=t-1,a=0;a<t;r=a++)i+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*i},a=function(e,i,r,a,o,n){var s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C,E,P,L;if(l=e[n[i]].x,h=e[n[i]].y,c=e[n[r]].x,p=e[n[r]].y,u=e[n[a]].x,f=e[n[a]].y,t>(c-l)*(f-h)-(p-h)*(u-l))return!1;for(g=u-c,v=f-p,y=l-u,x=h-f,_=c-l,w=p-h,s=0;s<o;s++)if(s!==i&&s!==r&&s!==a&&(d=e[n[s]].x,m=e[n[s]].y,b=d-l,S=m-h,M=d-c,A=m-p,T=d-u,C=m-f,L=g*A-v*M,E=_*S-w*b,P=y*C-x*T,L>=0&&P>=0&&E>=0))return!1;return!0};e.Triangulate=i,e.Triangulate.area=r}(o.FontUtils),a._typeface_js={faces:o.FontUtils.faces,loadFace:o.FontUtils.loadFace},o.Curve=function(){},o.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},o.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},o.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i},o.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i},o.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},o.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],a=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)t=this.getPoint(i/e),o+=t.distanceTo(a),r.push(o),a=t;return this.cacheArcLengths=r,r},o.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},o.Curve.prototype.getUtoTmapping=function(e,t){var i,r=this.getLengths(),a=0,o=r.length;i=t||e*r[o-1];var n,s=0,l=o-1;while(s<=l)if(a=Math.floor(s+(l-s)/2),n=r[a]-i,n<0)s=a+1;else{if(!(n>0)){l=a;break}l=a-1}if(a=l,r[a]==i){var h=a/(o-1);return h}var c=r[a],p=r[a+1],u=p-c,f=(i-c)/u;h=(a+f)/(o-1);return h},o.Curve.prototype.getTangent=function(e){var t=1e-4,i=e-t,r=e+t;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),n=o.clone().sub(a);return n.normalize()},o.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},o.LineCurve=function(e,t){this.v1=e,this.v2=t},o.LineCurve.prototype=Object.create(o.Curve.prototype),o.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},o.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},o.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},o.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},o.QuadraticBezierCurve.prototype=Object.create(o.Curve.prototype),o.QuadraticBezierCurve.prototype.getPoint=function(e){var t,i;return t=o.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=o.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new o.Vector2(t,i)},o.QuadraticBezierCurve.prototype.getTangent=function(e){var t,i;t=o.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),i=o.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var r=new o.Vector2(t,i);return r.normalize(),r},o.CubicBezierCurve=function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r},o.CubicBezierCurve.prototype=Object.create(o.Curve.prototype),o.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=o.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=o.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new o.Vector2(t,i)},o.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=o.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=o.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new o.Vector2(t,i);return r.normalize(),r},o.SplineCurve=function(e){this.points=void 0==e?[]:e},o.SplineCurve.prototype=Object.create(o.Curve.prototype),o.SplineCurve.prototype.getPoint=function(e){var t,i,r,a=new o.Vector2,n=[],s=this.points;return t=(s.length-1)*e,i=Math.floor(t),r=t-i,n[0]=0==i?i:i-1,n[1]=i,n[2]=i>s.length-2?s.length-1:i+1,n[3]=i>s.length-3?s.length-1:i+2,a.x=o.Curve.Utils.interpolate(s[n[0]].x,s[n[1]].x,s[n[2]].x,s[n[3]].x,r),a.y=o.Curve.Utils.interpolate(s[n[0]].y,s[n[1]].y,s[n[2]].y,s[n[3]].y,r),a},o.EllipseCurve=function(e,t,i,r,a,o,n){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=a,this.aEndAngle=o,this.aClockwise=n},o.EllipseCurve.prototype=Object.create(o.Curve.prototype),o.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);var i=this.aStartAngle+e*t,r=this.aX+this.xRadius*Math.cos(i),a=this.aY+this.yRadius*Math.sin(i);return new o.Vector2(r,a)},o.ArcCurve=function(e,t,i,r,a,n){o.EllipseCurve.call(this,e,t,i,i,r,a,n)},o.ArcCurve.prototype=Object.create(o.EllipseCurve.prototype),o.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,a){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*a},tangentSpline:function(e,t,i,r,a){var o=6*e*e-6*e,n=3*e*e-4*e+1,s=-6*e*e+6*e,l=3*e*e-2*e;return o+n+s+l},interpolate:function(e,t,i,r,a){var o=.5*(i-e),n=.5*(r-t),s=a*a,l=a*s;return(2*t-2*i+o+n)*l+(-3*t+3*i-2*o-n)*s+o*a+t}},o.Curve.create=function(e,t){return e.prototype=Object.create(o.Curve.prototype),e.prototype.getPoint=t,e},o.LineCurve3=o.Curve.create((function(e,t){this.v1=e,this.v2=t}),(function(e){var t=new o.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t})),o.QuadraticBezierCurve3=o.Curve.create((function(e,t,i){this.v0=e,this.v1=t,this.v2=i}),(function(e){var t,i,r;return t=o.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=o.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r=o.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new o.Vector3(t,i,r)})),o.CubicBezierCurve3=o.Curve.create((function(e,t,i,r){this.v0=e,this.v1=t,this.v2=i,this.v3=r}),(function(e){var t,i,r;return t=o.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=o.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r=o.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new o.Vector3(t,i,r)})),o.SplineCurve3=o.Curve.create((function(e){this.points=void 0==e?[]:e}),(function(e){var t,i,r,a=new o.Vector3,n=[],s=this.points;t=(s.length-1)*e,i=Math.floor(t),r=t-i,n[0]=0==i?i:i-1,n[1]=i,n[2]=i>s.length-2?s.length-1:i+1,n[3]=i>s.length-3?s.length-1:i+2;var l=s[n[0]],h=s[n[1]],c=s[n[2]],p=s[n[3]];return a.x=o.Curve.Utils.interpolate(l.x,h.x,c.x,p.x,r),a.y=o.Curve.Utils.interpolate(l.y,h.y,c.y,p.y,r),a.z=o.Curve.Utils.interpolate(l.z,h.z,c.z,p.z,r),a})),o.ClosedSplineCurve3=o.Curve.create((function(e){this.points=void 0==e?[]:e}),(function(e){var t,i,r,a=new o.Vector3,n=[],s=this.points;return t=(s.length-0)*e,i=Math.floor(t),r=t-i,i+=i>0?0:(Math.floor(Math.abs(i)/s.length)+1)*s.length,n[0]=(i-1)%s.length,n[1]=i%s.length,n[2]=(i+1)%s.length,n[3]=(i+2)%s.length,a.x=o.Curve.Utils.interpolate(s[n[0]].x,s[n[1]].x,s[n[2]].x,s[n[3]].x,r),a.y=o.Curve.Utils.interpolate(s[n[0]].y,s[n[1]].y,s[n[2]].y,s[n[3]].y,r),a.z=o.Curve.Utils.interpolate(s[n[0]].z,s[n[1]].z,s[n[2]].z,s[n[3]].z,r),a})),o.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},o.CurvePath.prototype=Object.create(o.Curve.prototype),o.CurvePath.prototype.add=function(e){this.curves.push(e)},o.CurvePath.prototype.checkConnection=function(){},o.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new o.LineCurve(t,e))},o.CurvePath.prototype.getPoint=function(e){var t,i,r=e*this.getLength(),a=this.getCurveLengths(),o=0;while(o<a.length){if(a[o]>=r){t=a[o]-r,i=this.curves[o];var n=1-t/i.getLength();return i.getPointAt(n)}o++}return null},o.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},o.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,r=this.curves.length;for(e=0;e<r;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},o.CurvePath.prototype.getBoundingBox=function(){var e,t,i,r,a,n,s,l,h,c,p=this.getPoints();e=t=Number.NEGATIVE_INFINITY,r=a=Number.POSITIVE_INFINITY;var u=p[0]instanceof o.Vector3;for(c=u?new o.Vector3:new o.Vector2,l=0,h=p.length;l<h;l++)s=p[l],s.x>e?e=s.x:s.x<r&&(r=s.x),s.y>t?t=s.y:s.y<a&&(a=s.y),u&&(s.z>i?i=s.z:s.z<n&&(n=s.z)),c.add(s);var f={minX:r,minY:a,maxX:e,maxY:t,centroid:c.divideScalar(h)};return u&&(f.maxZ=i,f.minZ=n),f},o.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},o.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},o.CurvePath.prototype.createGeometry=function(e){for(var t=new o.Geometry,i=0;i<e.length;i++)t.vertices.push(new o.Vector3(e[i].x,e[i].y,e[i].z||0));return t},o.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},o.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,a=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},o.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,a=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)a=this.getWrapPoints(a,t[i]);return a},o.CurvePath.prototype.getWrapPoints=function(e,t){var i,r,a,o,n,s,l=this.getBoundingBox();for(i=0,r=e.length;i<r;i++){a=e[i],o=a.x,n=a.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var h=t.getPoint(s),c=t.getNormalVector(s).multiplyScalar(n);a.x=h.x+c.x,a.y=h.y+c.y}return e},o.Gyroscope=function(){o.Object3D.call(this)},o.Gyroscope.prototype=Object.create(o.Object3D.prototype),o.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)},o.Gyroscope.prototype.translationWorld=new o.Vector3,o.Gyroscope.prototype.translationObject=new o.Vector3,o.Gyroscope.prototype.rotationWorld=new o.Quaternion,o.Gyroscope.prototype.rotationObject=new o.Quaternion,o.Gyroscope.prototype.scaleWorld=new o.Vector3,o.Gyroscope.prototype.scaleObject=new o.Vector3,o.Path=function(e){o.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},o.Path.prototype=Object.create(o.CurvePath.prototype),o.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},o.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},o.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:o.PathActions.MOVE_TO,args:i})},o.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,a=r[r.length-2],n=r[r.length-1],s=new o.LineCurve(new o.Vector2(a,n),new o.Vector2(e,t));this.curves.push(s),this.actions.push({action:o.PathActions.LINE_TO,args:i})},o.Path.prototype.quadraticCurveTo=function(e,t,i,r){var a=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,s=n[n.length-2],l=n[n.length-1],h=new o.QuadraticBezierCurve(new o.Vector2(s,l),new o.Vector2(e,t),new o.Vector2(i,r));this.curves.push(h),this.actions.push({action:o.PathActions.QUADRATIC_CURVE_TO,args:a})},o.Path.prototype.bezierCurveTo=function(e,t,i,r,a,n){var s=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,h=l[l.length-2],c=l[l.length-1],p=new o.CubicBezierCurve(new o.Vector2(h,c),new o.Vector2(e,t),new o.Vector2(i,r),new o.Vector2(a,n));this.curves.push(p),this.actions.push({action:o.PathActions.BEZIER_CURVE_TO,args:s})},o.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,r=i[i.length-2],a=i[i.length-1],n=[new o.Vector2(r,a)];Array.prototype.push.apply(n,e);var s=new o.SplineCurve(n);this.curves.push(s),this.actions.push({action:o.PathActions.CSPLINE_THRU,args:t})},o.Path.prototype.arc=function(e,t,i,r,a,o){var n=this.actions[this.actions.length-1].args,s=n[n.length-2],l=n[n.length-1];this.absarc(e+s,t+l,i,r,a,o)},o.Path.prototype.absarc=function(e,t,i,r,a,o){this.absellipse(e,t,i,i,r,a,o)},o.Path.prototype.ellipse=function(e,t,i,r,a,o,n){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1];this.absellipse(e+l,t+h,i,r,a,o,n)},o.Path.prototype.absellipse=function(e,t,i,r,a,n,s){var l=Array.prototype.slice.call(arguments),h=new o.EllipseCurve(e,t,i,r,a,n,s);this.curves.push(h);var c=h.getPoint(s?1:0);l.push(c.x),l.push(c.y),this.actions.push({action:o.PathActions.ELLIPSE,args:l})},o.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var i=[],r=0;r<e;r++)i.push(this.getPoint(r/e));return i},o.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,a,n,s,l,h,c,p,u,f,d,m,g,v,y,x,_,w=[];for(i=0,r=this.actions.length;i<r;i++)switch(a=this.actions[i],n=a.action,s=a.args,n){case o.PathActions.MOVE_TO:w.push(new o.Vector2(s[0],s[1]));break;case o.PathActions.LINE_TO:w.push(new o.Vector2(s[0],s[1]));break;case o.PathActions.QUADRATIC_CURVE_TO:for(l=s[2],h=s[3],u=s[0],f=s[1],w.length>0?(g=w[w.length-1],d=g.x,m=g.y):(g=this.actions[i-1].args,d=g[g.length-2],m=g[g.length-1]),v=1;v<=e;v++)y=v/e,x=o.Shape.Utils.b2(y,d,u,l),_=o.Shape.Utils.b2(y,m,f,h),w.push(new o.Vector2(x,_));break;case o.PathActions.BEZIER_CURVE_TO:for(l=s[4],h=s[5],u=s[0],f=s[1],c=s[2],p=s[3],w.length>0?(g=w[w.length-1],d=g.x,m=g.y):(g=this.actions[i-1].args,d=g[g.length-2],m=g[g.length-1]),v=1;v<=e;v++)y=v/e,x=o.Shape.Utils.b3(y,d,u,c,l),_=o.Shape.Utils.b3(y,m,f,p,h),w.push(new o.Vector2(x,_));break;case o.PathActions.CSPLINE_THRU:g=this.actions[i-1].args;var b=new o.Vector2(g[g.length-2],g[g.length-1]),S=[b],M=e*s[0].length;S=S.concat(s[0]);var A=new o.SplineCurve(S);for(v=1;v<=M;v++)w.push(A.getPointAt(v/M));break;case o.PathActions.ARC:var T=s[0],C=s[1],E=s[2],P=s[3],L=s[4],R=!!s[5],D=L-P,F=2*e;for(v=1;v<=F;v++)y=v/F,R||(y=1-y),U=P+y*D,x=T+E*Math.cos(U),_=C+E*Math.sin(U),w.push(new o.Vector2(x,_));break;case o.PathActions.ELLIPSE:T=s[0],C=s[1];var U,z=s[2],V=s[3];P=s[4],L=s[5],R=!!s[6],D=L-P,F=2*e;for(v=1;v<=F;v++)y=v/F,R||(y=1-y),U=P+y*D,x=T+z*Math.cos(U),_=C+V*Math.sin(U),w.push(new o.Vector2(x,_));break}var B=w[w.length-1],N=1e-10;return Math.abs(B.x-w[0].x)<N&&Math.abs(B.y-w[0].y)<N&&w.splice(w.length-1,1),t&&w.push(w[0]),w},o.Path.prototype.toShapes=function(){var e,t,i,r,a,n=[],s=new o.Path;for(e=0,t=this.actions.length;e<t;e++)i=this.actions[e],a=i.args,r=i.action,r==o.PathActions.MOVE_TO&&0!=s.actions.length&&(n.push(s),s=new o.Path),s[r].apply(s,a);if(0!=s.actions.length&&n.push(s),0==n.length)return[];var l,h,c=[],p=!o.Shape.Utils.isClockWise(n[0].getPoints());if(1==n.length)return l=n[0],h=new o.Shape,h.actions=l.actions,h.curves=l.curves,c.push(h),c;if(p)for(h=new o.Shape,e=0,t=n.length;e<t;e++)l=n[e],o.Shape.Utils.isClockWise(l.getPoints())?(h.actions=l.actions,h.curves=l.curves,c.push(h),h=new o.Shape):h.holes.push(l);else{for(e=0,t=n.length;e<t;e++)l=n[e],o.Shape.Utils.isClockWise(l.getPoints())?(h&&c.push(h),h=new o.Shape,h.actions=l.actions,h.curves=l.curves):h.holes.push(l);c.push(h)}return c},o.Shape=function(){o.Path.apply(this,arguments),this.holes=[]},o.Shape.prototype=Object.create(o.Path.prototype),o.Shape.prototype.extrude=function(e){var t=new o.ExtrudeGeometry(this,e);return t},o.Shape.prototype.makeGeometry=function(e){var t=new o.ShapeGeometry(this,e);return t},o.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},o.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},o.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},o.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},o.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},o.Shape.Utils={removeHoles:function(e,t){var i,r,a,n,s,l,h,c,p,u,f,d,m,g,v,y,x=e.concat(),_=x.concat(),w=[];for(s=0;s<t.length;s++){for(h=t[s],Array.prototype.push.apply(_,h),c=Number.POSITIVE_INFINITY,l=0;l<h.length;l++){f=h[l];var b=[];for(u=0;u<x.length;u++)d=x[u],p=f.distanceToSquared(d),b.push(p),p<c&&(c=p,a=l,n=u)}i=n-1>=0?n-1:x.length-1,r=a-1>=0?a-1:h.length-1;var S=[h[a],x[n],x[i]],M=o.FontUtils.Triangulate.area(S),A=[h[a],h[r],x[n]],T=o.FontUtils.Triangulate.area(A),C=1,E=-1,P=n,L=a;n+=C,a+=E,n<0&&(n+=x.length),n%=x.length,a<0&&(a+=h.length),a%=h.length,i=n-1>=0?n-1:x.length-1,r=a-1>=0?a-1:h.length-1,S=[h[a],x[n],x[i]];var R=o.FontUtils.Triangulate.area(S);A=[h[a],h[r],x[n]];var D=o.FontUtils.Triangulate.area(A);M+T>R+D&&(n=P,a=L,n<0&&(n+=x.length),n%=x.length,a<0&&(a+=h.length),a%=h.length,i=n-1>=0?n-1:x.length-1,r=a-1>=0?a-1:h.length-1),m=x.slice(0,n),g=x.slice(n),v=h.slice(a),y=h.slice(0,a);var F=[h[a],x[n],x[i]],U=[h[a],h[r],x[n]];w.push(F),w.push(U),x=m.concat(v).concat(y).concat(g)}return{shape:x,isolatedPts:w,allpoints:_}},triangulateShape:function(e,t){var i,r,a,n,s,l,h=o.Shape.Utils.removeHoles(e,t),c=h.shape,p=h.allpoints,u=h.isolatedPts,f=o.FontUtils.Triangulate(c,!1),d={};for(i=0,r=p.length;i<r;i++)s=p[i].x+":"+p[i].y,void 0!==d[s]&&console.log("Duplicate point",s),d[s]=i;for(i=0,r=f.length;i<r;i++)for(n=f[i],a=0;a<3;a++)s=n[a].x+":"+n[a].y,l=d[s],void 0!==l&&(n[a]=l);for(i=0,r=u.length;i<r;i++)for(n=u[i],a=0;a<3;a++)s=n[a].x+":"+n[a].y,l=d[s],void 0!==l&&(n[a]=l);return f.concat(u)},isClockWise:function(e){return o.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){var i=1-e;return 3*i*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,a){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,a)}},o.AnimationHandler=function(){var e=[],t={},i={update:function(t){for(var i=0;i<e.length;i++)e[i].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},add:function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,a(e)},get:function(e){if("string"===typeof e)return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof o.SkinnedMesh)for(var i=0;i<e.bones.length;i++)t.push(e.bones[i]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)r(e.children[i],t)},a=function(e){if(!0!==e.initialized){for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof o.Quaternion)){var r=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=new o.Quaternion(r[0],r[1],r[2],r[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){var a={};for(i=0;i<e.hierarchy[t].keys.length;i++)for(var n=0;n<e.hierarchy[t].keys[i].morphTargets.length;n++){var s=e.hierarchy[t].keys[i].morphTargets[n];a[s]=-1}e.hierarchy[t].usedMorphTargets=a;for(i=0;i<e.hierarchy[t].keys.length;i++){var l={};for(var s in a){for(n=0;n<e.hierarchy[t].keys[i].morphTargets.length;n++)if(e.hierarchy[t].keys[i].morphTargets[n]===s){l[s]=e.hierarchy[t].keys[i].morphTargetsInfluences[n];break}n===e.hierarchy[t].keys[i].morphTargets.length&&(l[s]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=l}}for(i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}var h=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(h));e.initialized=!0}};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),o.Animation=function(e,t,i){this.root=e,this.data=o.AnimationHandler.get(t),this.hierarchy=o.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==i?i:o.AnimationHandler.LINEAR,this.points=[],this.target=new o.Vector3},o.Animation.prototype.play=function(e,t){if(!1===this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0;var i,r,a=this.hierarchy.length;for(i=0;i<a;i++){r=this.hierarchy[i],this.interpolationType!==o.AnimationHandler.CATMULLROM_FORWARD&&(r.useQuaternion=!0),r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey={pos:0,rot:0,scl:0},r.animationCache.nextKey={pos:0,rot:0,scl:0},r.animationCache.originalMatrix=r instanceof o.Bone?r.skinMatrix:r.matrix);var n=r.animationCache.prevKey,s=r.animationCache.nextKey;n.pos=this.data.hierarchy[i].keys[0],n.rot=this.data.hierarchy[i].keys[0],n.scl=this.data.hierarchy[i].keys[0],s.pos=this.getNextKeyWith("pos",i,1),s.rot=this.getNextKeyWith("rot",i,1),s.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,o.AnimationHandler.addToUpdate(this)},o.Animation.prototype.pause=function(){!0===this.isPaused?o.AnimationHandler.addToUpdate(this):o.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},o.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,o.AnimationHandler.removeFromUpdate(this)},o.Animation.prototype.update=function(e){if(!1!==this.isPlaying){var t,i,r,a,n,s,l,h,c,p,u,f,d,m,g=["pos","rot","scl"];this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,u=this.currentTime,p=this.currentTime=this.currentTime%this.data.length,parseInt(Math.min(p*this.data.fps,this.data.length*this.data.fps),10);for(var v=0,y=this.hierarchy.length;v<y;v++){h=this.hierarchy[v],c=h.animationCache;for(var x=0;x<3;x++){if(t=g[x],s=c.prevKey[t],l=c.nextKey[t],l.time<=u){if(p<u){if(!this.loop)return void this.stop();s=this.data.hierarchy[v].keys[0],l=this.getNextKeyWith(t,v,1);while(l.time<p)s=l,l=this.getNextKeyWith(t,v,l.index+1)}else do{s=l,l=this.getNextKeyWith(t,v,l.index+1)}while(l.time<p);c.prevKey[t]=s,c.nextKey[t]=l}h.matrixAutoUpdate=!0,h.matrixWorldNeedsUpdate=!0,i=(p-s.time)/(l.time-s.time),a=s[t],n=l[t],(i<0||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+v),i=i<0?0:1),"pos"===t?(r=h.position,this.interpolationType===o.AnimationHandler.LINEAR?(r.x=a[0]+(n[0]-a[0])*i,r.y=a[1]+(n[1]-a[1])*i,r.z=a[2]+(n[2]-a[2])*i):this.interpolationType!==o.AnimationHandler.CATMULLROM&&this.interpolationType!==o.AnimationHandler.CATMULLROM_FORWARD||(this.points[0]=this.getPrevKeyWith("pos",v,s.index-1)["pos"],this.points[1]=a,this.points[2]=n,this.points[3]=this.getNextKeyWith("pos",v,l.index+1)["pos"],i=.33*i+.33,f=this.interpolateCatmullRom(this.points,i),r.x=f[0],r.y=f[1],r.z=f[2],this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD&&(d=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(d[0],d[1],d[2]),this.target.sub(r),this.target.y=0,this.target.normalize(),m=Math.atan2(this.target.x,this.target.z),h.rotation.set(0,m,0)))):"rot"===t?o.Quaternion.slerp(a,n,h.quaternion,i):"scl"===t&&(r=h.scale,r.x=a[0]+(n[0]-a[0])*i,r.y=a[1]+(n[1]-a[1])*i,r.z=a[2]+(n[2]-a[2])*i)}}}},o.Animation.prototype.interpolateCatmullRom=function(e,t){var i,r,a,o,n,s,l,h,c,p=[],u=[];return i=(e.length-1)*t,r=Math.floor(i),a=i-r,p[0]=0===r?r:r-1,p[1]=r,p[2]=r>e.length-2?r:r+1,p[3]=r>e.length-3?r:r+2,s=e[p[0]],l=e[p[1]],h=e[p[2]],c=e[p[3]],o=a*a,n=a*o,u[0]=this.interpolate(s[0],l[0],h[0],c[0],a,o,n),u[1]=this.interpolate(s[1],l[1],h[1],c[1],a,o,n),u[2]=this.interpolate(s[2],l[2],h[2],c[2],a,o,n),u},o.Animation.prototype.interpolate=function(e,t,i,r,a,o,n){var s=.5*(i-e),l=.5*(r-t);return(2*(t-i)+s+l)*n+(-3*(t-i)-2*s-l)*o+s*a+t},o.Animation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(this.interpolationType===o.AnimationHandler.CATMULLROM||this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD?i=i<r.length-1?i:r.length-1:i%=r.length;i<r.length;i++)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[0]},o.Animation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=this.interpolationType===o.AnimationHandler.CATMULLROM||this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+r.length;i>=0;i--)if(void 0!==r[i][e])return r[i];return this.data.hierarchy[t].keys[r.length-1]},o.KeyFrameAnimation=function(e,t,i){this.root=e,this.data=o.AnimationHandler.get(t),this.hierarchy=o.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0===i||i;for(var r=0,a=this.hierarchy.length;r<a;r++){var n=this.data.hierarchy[r].keys,s=this.data.hierarchy[r].sids,l=this.hierarchy[r];if(n.length&&s){for(var h=0;h<s.length;h++){var c=s[h],p=this.getNextKeyWith(c,r,0);p&&p.apply(c)}l.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),l.matrixWorldNeedsUpdate=!0}}},o.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0===e||e,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,r,a,n=this.hierarchy.length;for(i=0;i<n;i++){r=this.hierarchy[i],a=this.data.hierarchy[i],r.useQuaternion=!0,void 0===a.animationCache&&(a.animationCache={},a.animationCache.prevKey=null,a.animationCache.nextKey=null,a.animationCache.originalMatrix=r instanceof o.Bone?r.skinMatrix:r.matrix);var s=this.data.hierarchy[i].keys;s.length&&(a.animationCache.prevKey=s[0],a.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,o.AnimationHandler.addToUpdate(this)},o.KeyFrameAnimation.prototype.pause=function(){this.isPaused?o.AnimationHandler.addToUpdate(this):o.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},o.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,o.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var r=i.animationCache.originalMatrix;t instanceof o.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete i.animationCache}}},o.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,r,a,n,s,l,h,c=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,l=this.currentTime,s=this.currentTime=this.currentTime%this.data.length,s<this.startTimeMs&&(s=this.currentTime=this.startTimeMs+s),n=parseInt(Math.min(s*this.data.fps,this.data.length*this.data.fps),10),h=s<l,!h||this.loop){if(!(s<this.startTime)){for(f=0,d=this.hierarchy.length;f<d;f++){r=this.hierarchy[f],a=this.data.hierarchy[f];m=a.keys;var p=a.animationCache;if(this.JITCompile&&void 0!==c[f][n])r instanceof o.Bone?(r.skinMatrix=c[f][n],r.matrixWorldNeedsUpdate=!1):(r.matrix=c[f][n],r.matrixWorldNeedsUpdate=!0);else if(m.length){if(this.JITCompile&&p&&(r instanceof o.Bone?r.skinMatrix=p.originalMatrix:r.matrix=p.originalMatrix),t=p.prevKey,i=p.nextKey,t&&i){if(i.time<=l){if(h&&this.loop){t=m[0],i=m[1];while(i.time<s)t=i,i=m[t.index+1]}else if(!h){var u=m.length-1;while(i.time<s&&i.index!==u)t=i,i=m[t.index+1]}p.prevKey=t,p.nextKey=i}i.time>=s?t.interpolate(i,s):t.interpolate(i,i.time)}this.data.hierarchy[f].node.updateMatrix(),r.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===c[0][n]){this.hierarchy[0].updateMatrixWorld(!0);for(f=0;f<this.hierarchy.length;f++)this.hierarchy[f]instanceof o.Bone?c[f][n]=this.hierarchy[f].skinMatrix.clone():c[f][n]=this.hierarchy[f].matrix.clone()}}}else{for(var f=0,d=this.hierarchy.length;f<d;f++){var m=this.data.hierarchy[f].keys,g=this.data.hierarchy[f].sids,v=m.length-1,y=this.hierarchy[f];if(m.length){for(var x=0;x<g.length;x++){var _=g[x],w=this.getPrevKeyWith(_,f,v);w&&w.apply(_)}this.data.hierarchy[f].node.updateMatrix(),y.matrixWorldNeedsUpdate=!0}}this.stop()}}},o.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i%=r.length;i<r.length;i++)if(r[i].hasTarget(e))return r[i];return r[0]},o.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){var r=this.data.hierarchy[t].keys;for(i=i>=0?i:i+r.length;i>=0;i--)if(r[i].hasTarget(e))return r[i];return r[r.length-1]},o.CubeCamera=function(e,t,i){o.Object3D.call(this);var r=90,a=1,n=new o.PerspectiveCamera(r,a,e,t);n.up.set(0,-1,0),n.lookAt(new o.Vector3(1,0,0)),this.add(n);var s=new o.PerspectiveCamera(r,a,e,t);s.up.set(0,-1,0),s.lookAt(new o.Vector3(-1,0,0)),this.add(s);var l=new o.PerspectiveCamera(r,a,e,t);l.up.set(0,0,1),l.lookAt(new o.Vector3(0,1,0)),this.add(l);var h=new o.PerspectiveCamera(r,a,e,t);h.up.set(0,0,-1),h.lookAt(new o.Vector3(0,-1,0)),this.add(h);var c=new o.PerspectiveCamera(r,a,e,t);c.up.set(0,-1,0),c.lookAt(new o.Vector3(0,0,1)),this.add(c);var p=new o.PerspectiveCamera(r,a,e,t);p.up.set(0,-1,0),p.lookAt(new o.Vector3(0,0,-1)),this.add(p),this.renderTarget=new o.WebGLRenderTargetCube(i,i,{format:o.RGBFormat,magFilter:o.LinearFilter,minFilter:o.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,r=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,n,i),i.activeCubeFace=1,e.render(t,s,i),i.activeCubeFace=2,e.render(t,l,i),i.activeCubeFace=3,e.render(t,h,i),i.activeCubeFace=4,e.render(t,c,i),i.generateMipmaps=r,i.activeCubeFace=5,e.render(t,p,i)}},o.CubeCamera.prototype=Object.create(o.Object3D.prototype),o.CombinedCamera=function(e,t,i,r,a,n,s){o.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new o.OrthographicCamera(e/-2,e/2,t/2,t/-2,n,s),this.cameraP=new o.PerspectiveCamera(i,e/t,r,a),this.zoom=1,this.toPerspective()},o.CombinedCamera.prototype=Object.create(o.Camera.prototype),o.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},o.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,i=this.cameraP.near,r=this.cameraP.far,a=(i+r)/2,o=Math.tan(e/2)*a,n=2*o,s=n*t,l=s/2;o/=this.zoom,l/=this.zoom,this.cameraO.left=-l,this.cameraO.right=l,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},o.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},o.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},o.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},o.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var i=2*o.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i},o.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},o.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},o.AsteriskGeometry=function(e,t){o.Geometry.call(this);for(var i=e,r=t,a=.707*i,n=.707*r,s=[[i,0,0],[r,0,0],[-i,0,0],[-r,0,0],[0,i,0],[0,r,0],[0,-i,0],[0,-r,0],[0,0,i],[0,0,r],[0,0,-i],[0,0,-r],[a,a,0],[n,n,0],[-a,-a,0],[-n,-n,0],[a,-a,0],[n,-n,0],[-a,a,0],[-n,n,0],[a,0,a],[n,0,n],[-a,0,-a],[-n,0,-n],[a,0,-a],[n,0,-n],[-a,0,a],[-n,0,n],[0,a,a],[0,n,n],[0,-a,-a],[0,-n,-n],[0,a,-a],[0,n,-n],[0,-a,a],[0,-n,n]],l=0,h=s.length;l<h;l++){var c=s[l][0],p=s[l][1],u=s[l][2];this.vertices.push(new o.Vector3(c,p,u))}},o.AsteriskGeometry.prototype=Object.create(o.Geometry.prototype),o.CircleGeometry=function(e,t,i,r){o.Geometry.call(this),e=e||50,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,t=void 0!==t?Math.max(3,t):8;var a,n=[],s=new o.Vector3,l=new o.Vector2(.5,.5);for(this.vertices.push(s),n.push(l),a=0;a<=t;a++){var h=new o.Vector3;h.x=e*Math.cos(i+a/t*r),h.y=e*Math.sin(i+a/t*r),this.vertices.push(h),n.push(new o.Vector2((h.x/e+1)/2,-(h.y/e+1)/2+1))}var c=new o.Vector3(0,0,-1);for(a=1;a<=t;a++){var p=a,u=a+1,f=0;this.faces.push(new o.Face3(p,u,f,[c,c,c])),this.faceVertexUvs[0].push([n[a],n[a+1],l])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.CircleGeometry.prototype=Object.create(o.Geometry.prototype),o.CubeGeometry=function(e,t,i,r,a,n){o.Geometry.call(this);var s=this;this.width=e,this.height=t,this.depth=i,this.widthSegments=r||1,this.heightSegments=a||1,this.depthSegments=n||1;var l=this.width/2,h=this.height/2,c=this.depth/2;function p(e,t,i,r,a,n,l,h){var c,p,u,f=s.widthSegments,d=s.heightSegments,m=a/2,g=n/2,v=s.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",d=s.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",f=s.depthSegments);var y=f+1,x=d+1,_=a/f,w=n/d,b=new o.Vector3;for(b[c]=l>0?1:-1,u=0;u<x;u++)for(p=0;p<y;p++){var S=new o.Vector3;S[e]=(p*_-m)*i,S[t]=(u*w-g)*r,S[c]=l,s.vertices.push(S)}for(u=0;u<d;u++)for(p=0;p<f;p++){var M=p+y*u,A=p+y*(u+1),T=p+1+y*(u+1),C=p+1+y*u,E=new o.Face4(M+v,A+v,T+v,C+v);E.normal.copy(b),E.vertexNormals.push(b.clone(),b.clone(),b.clone(),b.clone()),E.materialIndex=h,s.faces.push(E),s.faceVertexUvs[0].push([new o.Vector2(p/f,1-u/d),new o.Vector2(p/f,1-(u+1)/d),new o.Vector2((p+1)/f,1-(u+1)/d),new o.Vector2((p+1)/f,1-u/d)])}}p("z","y",-1,-1,this.depth,this.height,l,0),p("z","y",1,-1,this.depth,this.height,-l,1),p("x","z",1,1,this.width,this.depth,h,2),p("x","z",1,-1,this.width,this.depth,-h,3),p("x","y",1,-1,this.width,this.height,c,4),p("x","y",-1,-1,this.width,this.height,-c,5),this.computeCentroids(),this.mergeVertices()},o.CubeGeometry.prototype=Object.create(o.Geometry.prototype),o.CylinderGeometry=function(e,t,i,r,a,n){o.Geometry.call(this),e=void 0!==e?e:20,t=void 0!==t?t:20,i=void 0!==i?i:100;var s,l,h=i/2,c=r||8,p=a||1,u=[],f=[];for(l=0;l<=p;l++){var d=[],m=[],g=l/p,v=g*(t-e)+e;for(s=0;s<=c;s++){var y=s/c,x=new o.Vector3;x.x=v*Math.sin(y*Math.PI*2),x.y=-g*i+h,x.z=v*Math.cos(y*Math.PI*2),this.vertices.push(x),d.push(this.vertices.length-1),m.push(new o.Vector2(y,1-g))}u.push(d),f.push(m)}var _,w,b=(t-e)/i;for(s=0;s<c;s++)for(0!==e?(_=this.vertices[u[0][s]].clone(),w=this.vertices[u[0][s+1]].clone()):(_=this.vertices[u[1][s]].clone(),w=this.vertices[u[1][s+1]].clone()),_.setY(Math.sqrt(_.x*_.x+_.z*_.z)*b).normalize(),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),l=0;l<p;l++){var S=u[l][s],M=u[l+1][s],A=u[l+1][s+1],T=u[l][s+1],C=_.clone(),E=_.clone(),P=w.clone(),L=w.clone(),R=f[l][s].clone(),D=f[l+1][s].clone(),F=f[l+1][s+1].clone(),U=f[l][s+1].clone();this.faces.push(new o.Face4(S,M,A,T,[C,E,P,L])),this.faceVertexUvs[0].push([R,D,F,U])}if(!n&&e>0)for(this.vertices.push(new o.Vector3(0,h,0)),s=0;s<c;s++){S=u[0][s],M=u[0][s+1],A=this.vertices.length-1,C=new o.Vector3(0,1,0),E=new o.Vector3(0,1,0),P=new o.Vector3(0,1,0),R=f[0][s].clone(),D=f[0][s+1].clone(),F=new o.Vector2(D.u,0);this.faces.push(new o.Face3(S,M,A,[C,E,P])),this.faceVertexUvs[0].push([R,D,F])}if(!n&&t>0)for(this.vertices.push(new o.Vector3(0,-h,0)),s=0;s<c;s++){S=u[l][s+1],M=u[l][s],A=this.vertices.length-1,C=new o.Vector3(0,-1,0),E=new o.Vector3(0,-1,0),P=new o.Vector3(0,-1,0),R=f[l][s+1].clone(),D=f[l][s].clone(),F=new o.Vector2(D.u,1);this.faces.push(new o.Face3(S,M,A,[C,E,P])),this.faceVertexUvs[0].push([R,D,F])}this.computeCentroids(),this.computeFaceNormals()},o.CylinderGeometry.prototype=Object.create(o.Geometry.prototype),o.ExtrudeGeometry=function(e,t){"undefined"!==typeof e?(o.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()):e=[]},o.ExtrudeGeometry.prototype=Object.create(o.Geometry.prototype),o.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;r<i;r++){var a=e[r];this.addShape(a,t)}},o.ExtrudeGeometry.prototype.addShape=function(e,t){var i,r,a,n,s,l,h,c,p=void 0!==t.amount?t.amount:100,u=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:u-2,d=void 0!==t.bevelSegments?t.bevelSegments:3,m=void 0===t.bevelEnabled||t.bevelEnabled,g=void 0!==t.curveSegments?t.curveSegments:12,v=void 0!==t.steps?t.steps:1,y=t.extrudePath,x=!1,_=t.material,w=t.extrudeMaterial,b=void 0!==t.UVGenerator?t.UVGenerator:o.ExtrudeGeometry.WorldUVGenerator;this.shapebb;y&&(i=y.getSpacedPoints(v),x=!0,m=!1,r=void 0!==t.frames?t.frames:new o.TubeGeometry.FrenetFrames(y,v,!1),a=new o.Vector3,n=new o.Vector3,s=new o.Vector3),m||(d=0,u=0,f=0);var S=this,M=this.vertices.length,A=e.extractPoints(g),T=A.shape,C=A.holes,E=!o.Shape.Utils.isClockWise(T);if(E){for(T=T.reverse(),h=0,c=C.length;h<c;h++)l=C[h],o.Shape.Utils.isClockWise(l)&&(C[h]=l.reverse());E=!1}var P=o.Shape.Utils.triangulateShape(T,C),L=T;for(h=0,c=C.length;h<c;h++)l=C[h],T=T.concat(l);function R(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}var D,F,U,z,V,B,N=T.length,O=P.length;L.length,Math.PI;function I(e,t,i){return G(e,t,i)}function k(e,t,i){var r=Math.atan2(t.y-e.y,t.x-e.x),a=Math.atan2(i.y-e.y,i.x-e.x);r>a&&(a+=2*Math.PI);var n=(r+a)/2,s=-Math.cos(n),l=-Math.sin(n),h=new o.Vector2(s,l);return h}function G(e,t,i){var r,a,n,s,l,h,c=o.ExtrudeGeometry.__v1,p=o.ExtrudeGeometry.__v2,u=o.ExtrudeGeometry.__v3,f=o.ExtrudeGeometry.__v4,d=o.ExtrudeGeometry.__v5,m=o.ExtrudeGeometry.__v6;return c.set(e.x-t.x,e.y-t.y),p.set(e.x-i.x,e.y-i.y),r=c.normalize(),a=p.normalize(),u.set(-r.y,r.x),f.set(a.y,-a.x),d.copy(e).add(u),m.copy(e).add(f),d.equals(m)?f.clone():(d.copy(t).add(u),m.copy(i).add(f),n=r.dot(f),s=m.sub(d).dot(f),0===n&&(console.log("Either infinite or no solutions!"),0===s?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),l=s/n,l<0?k(e,t,i):(h=r.multiplyScalar(l).add(d),h.sub(e).clone()))}for(var H=[],W=0,j=L.length,X=j-1,Y=W+1;W<j;W++,X++,Y++){X===j&&(X=0),Y===j&&(Y=0);L[W],L[X],L[Y];H[W]=I(L[W],L[X],L[Y])}var q,K,Q=[],Z=H.concat();for(h=0,c=C.length;h<c;h++){for(l=C[h],q=[],W=0,j=l.length,X=j-1,Y=W+1;W<j;W++,X++,Y++)X===j&&(X=0),Y===j&&(Y=0),q[W]=I(l[W],l[X],l[Y]);Q.push(q),Z=Z.concat(q)}for(D=0;D<d;D++){for(U=D/d,z=u*(1-U),F=f*Math.sin(U*Math.PI/2),W=0,j=L.length;W<j;W++)V=R(L[W],H[W],F),te(V.x,V.y,-z);for(h=0,c=C.length;h<c;h++)for(l=C[h],q=Q[h],W=0,j=l.length;W<j;W++)V=R(l[W],q[W],F),te(V.x,V.y,-z)}for(F=f,W=0;W<N;W++)V=m?R(T[W],Z[W],F):T[W],x?(n.copy(r.normals[0]).multiplyScalar(V.x),a.copy(r.binormals[0]).multiplyScalar(V.y),s.copy(i[0]).add(n).add(a),te(s.x,s.y,s.z)):te(V.x,V.y,0);for(K=1;K<=v;K++)for(W=0;W<N;W++)V=m?R(T[W],Z[W],F):T[W],x?(n.copy(r.normals[K]).multiplyScalar(V.x),a.copy(r.binormals[K]).multiplyScalar(V.y),s.copy(i[K]).add(n).add(a),te(s.x,s.y,s.z)):te(V.x,V.y,p/v*K);for(D=d-1;D>=0;D--){for(U=D/d,z=u*(1-U),F=f*Math.sin(U*Math.PI/2),W=0,j=L.length;W<j;W++)V=R(L[W],H[W],F),te(V.x,V.y,p+z);for(h=0,c=C.length;h<c;h++)for(l=C[h],q=Q[h],W=0,j=l.length;W<j;W++)V=R(l[W],q[W],F),x?te(V.x,V.y+i[v-1].y,i[v-1].x+z):te(V.x,V.y,p+z)}function J(){if(m){var e=0,t=N*e;for(W=0;W<O;W++)B=P[W],ie(B[2]+t,B[1]+t,B[0]+t,!0);for(e=v+2*d,t=N*e,W=0;W<O;W++)B=P[W],ie(B[0]+t,B[1]+t,B[2]+t,!1)}else{for(W=0;W<O;W++)B=P[W],ie(B[2],B[1],B[0],!0);for(W=0;W<O;W++)B=P[W],ie(B[0]+N*v,B[1]+N*v,B[2]+N*v,!1)}}function $(){var e=0;for(ee(L,e),e+=L.length,h=0,c=C.length;h<c;h++)l=C[h],ee(l,e),e+=l.length}function ee(e,t){var i,r;W=e.length;while(--W>=0){i=W,r=W-1,r<0&&(r=e.length-1);var a=0,o=v+2*d;for(a=0;a<o;a++){var n=N*a,s=N*(a+1),l=t+i+n,h=t+r+n,c=t+r+s,p=t+i+s;re(l,h,c,p,e,a,o,i,r)}}}function te(e,t,i){S.vertices.push(new o.Vector3(e,t,i))}function ie(i,r,a,n){i+=M,r+=M,a+=M,S.faces.push(new o.Face3(i,r,a,null,null,_));var s=n?b.generateBottomUV(S,e,t,i,r,a):b.generateTopUV(S,e,t,i,r,a);S.faceVertexUvs[0].push(s)}function re(i,r,a,n,s,l,h,c,p){i+=M,r+=M,a+=M,n+=M,S.faces.push(new o.Face4(i,r,a,n,null,null,w));var u=b.generateSideWallUV(S,e,s,t,i,r,a,n,l,h,c,p);S.faceVertexUvs[0].push(u)}J(),$()},o.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r,a,n){var s=e.vertices[r].x,l=e.vertices[r].y,h=e.vertices[a].x,c=e.vertices[a].y,p=e.vertices[n].x,u=e.vertices[n].y;return[new o.Vector2(s,l),new o.Vector2(h,c),new o.Vector2(p,u)]},generateBottomUV:function(e,t,i,r,a,o){return this.generateTopUV(e,t,i,r,a,o)},generateSideWallUV:function(e,t,i,r,a,n,s,l,h,c,p,u){var f=e.vertices[a].x,d=e.vertices[a].y,m=e.vertices[a].z,g=e.vertices[n].x,v=e.vertices[n].y,y=e.vertices[n].z,x=e.vertices[s].x,_=e.vertices[s].y,w=e.vertices[s].z,b=e.vertices[l].x,S=e.vertices[l].y,M=e.vertices[l].z;return Math.abs(d-v)<.01?[new o.Vector2(f,1-m),new o.Vector2(g,1-y),new o.Vector2(x,1-w),new o.Vector2(b,1-M)]:[new o.Vector2(d,1-m),new o.Vector2(v,1-y),new o.Vector2(_,1-w),new o.Vector2(S,1-M)]}},o.ExtrudeGeometry.__v1=new o.Vector2,o.ExtrudeGeometry.__v2=new o.Vector2,o.ExtrudeGeometry.__v3=new o.Vector2,o.ExtrudeGeometry.__v4=new o.Vector2,o.ExtrudeGeometry.__v5=new o.Vector2,o.ExtrudeGeometry.__v6=new o.Vector2,o.ShapeGeometry=function(e,t){o.Geometry.call(this),e instanceof Array===!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},o.ShapeGeometry.prototype=Object.create(o.Geometry.prototype),o.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++)this.addShape(e[i],t);return this},o.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,r,a,n=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,l=void 0===t.UVGenerator?o.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=(this.shapebb,this.vertices.length),c=e.extractPoints(n),p=c.shape,u=c.holes,f=!o.Shape.Utils.isClockWise(p);if(f){for(p=p.reverse(),i=0,r=u.length;i<r;i++)a=u[i],o.Shape.Utils.isClockWise(a)&&(u[i]=a.reverse());f=!1}var d=o.Shape.Utils.triangulateShape(p,u),m=p;for(i=0,r=u.length;i<r;i++)a=u[i],p=p.concat(a);var g,v,y=p.length,x=d.length;m.length;for(i=0;i<y;i++)g=p[i],this.vertices.push(new o.Vector3(g.x,g.y,0));for(i=0;i<x;i++){v=d[i];var _=v[0]+h,w=v[1]+h,b=v[2]+h;this.faces.push(new o.Face3(_,w,b,null,null,s)),this.faceVertexUvs[0].push(l.generateBottomUV(this,e,t,_,w,b))}},o.LatheGeometry=function(e,t,i,r){o.Geometry.call(this),t=t||12,i=i||0,r=r||2*Math.PI;for(var a=1/(e.length-1),n=1/t,s=0,l=t;s<=l;s++)for(var h=i+s*n*r,c=Math.cos(h),p=Math.sin(h),u=0,f=e.length;u<f;u++){var d=e[u],m=new o.Vector3;m.x=c*d.x-p*d.y,m.y=p*d.x+c*d.y,m.z=d.z,this.vertices.push(m)}var g=e.length;for(s=0,l=t;s<l;s++)for(u=0,f=e.length-1;u<f;u++){var v=u+g*s,y=v,x=v+g,_=(c=v+1+g,v+1);this.faces.push(new o.Face4(y,x,c,_));var w=s*n,b=u*a,S=w+n,M=b+a;this.faceVertexUvs[0].push([new o.Vector2(w,b),new o.Vector2(S,b),new o.Vector2(S,M),new o.Vector2(w,M)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.LatheGeometry.prototype=Object.create(o.Geometry.prototype),o.PlaneGeometry=function(e,t,i,r){var a,n;o.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=i||1,this.heightSegments=r||1;var s=e/2,l=t/2,h=this.widthSegments,c=this.heightSegments,p=h+1,u=c+1,f=this.width/h,d=this.height/c,m=new o.Vector3(0,0,1);for(n=0;n<u;n++)for(a=0;a<p;a++){var g=a*f-s,v=n*d-l;this.vertices.push(new o.Vector3(g,-v,0))}for(n=0;n<c;n++)for(a=0;a<h;a++){var y=a+p*n,x=a+p*(n+1),_=a+1+p*(n+1),w=a+1+p*n,b=new o.Face4(y,x,_,w);b.normal.copy(m),b.vertexNormals.push(m.clone(),m.clone(),m.clone(),m.clone()),this.faces.push(b),this.faceVertexUvs[0].push([new o.Vector2(a/h,1-n/c),new o.Vector2(a/h,1-(n+1)/c),new o.Vector2((a+1)/h,1-(n+1)/c),new o.Vector2((a+1)/h,1-n/c)])}this.computeCentroids()},o.PlaneGeometry.prototype=Object.create(o.Geometry.prototype),o.SphereGeometry=function(e,t,i,r,a,n,s){o.Geometry.call(this),this.radius=e||50,this.widthSegments=Math.max(3,Math.floor(t)||8),this.heightSegments=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?n:0,s=void 0!==s?s:Math.PI;var l,h,c=[],p=[];for(h=0;h<=this.heightSegments;h++){var u=[],f=[];for(l=0;l<=this.widthSegments;l++){var d=l/this.widthSegments,m=h/this.heightSegments,g=new o.Vector3;g.x=-this.radius*Math.cos(r+d*a)*Math.sin(n+m*s),g.y=this.radius*Math.cos(n+m*s),g.z=this.radius*Math.sin(r+d*a)*Math.sin(n+m*s),this.vertices.push(g),u.push(this.vertices.length-1),f.push(new o.Vector2(d,1-m))}c.push(u),p.push(f)}for(h=0;h<this.heightSegments;h++)for(l=0;l<this.widthSegments;l++){var v=c[h][l+1],y=c[h][l],x=c[h+1][l],_=c[h+1][l+1],w=this.vertices[v].clone().normalize(),b=this.vertices[y].clone().normalize(),S=this.vertices[x].clone().normalize(),M=this.vertices[_].clone().normalize(),A=p[h][l+1].clone(),T=p[h][l].clone(),C=p[h+1][l].clone(),E=p[h+1][l+1].clone();Math.abs(this.vertices[v].y)===this.radius?(this.faces.push(new o.Face3(v,x,_,[w,S,M])),this.faceVertexUvs[0].push([A,C,E])):Math.abs(this.vertices[x].y)===this.radius?(this.faces.push(new o.Face3(v,y,x,[w,b,S])),this.faceVertexUvs[0].push([A,T,C])):(this.faces.push(new o.Face4(v,y,x,_,[w,b,S,M])),this.faceVertexUvs[0].push([A,T,C,E]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.SphereGeometry.prototype=Object.create(o.Geometry.prototype),o.TextGeometry=function(e,t){var i=o.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),o.ExtrudeGeometry.call(this,i,t)},o.TextGeometry.prototype=Object.create(o.ExtrudeGeometry.prototype),o.TorusGeometry=function(e,t,i,r,a){o.Geometry.call(this);this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=r||6,this.arc=a||2*Math.PI;for(var n=new o.Vector3,s=[],l=[],h=0;h<=this.radialSegments;h++)for(var c=0;c<=this.tubularSegments;c++){var p=c/this.tubularSegments*this.arc,u=h/this.radialSegments*Math.PI*2;n.x=this.radius*Math.cos(p),n.y=this.radius*Math.sin(p);var f=new o.Vector3;f.x=(this.radius+this.tube*Math.cos(u))*Math.cos(p),f.y=(this.radius+this.tube*Math.cos(u))*Math.sin(p),f.z=this.tube*Math.sin(u),this.vertices.push(f),s.push(new o.Vector2(c/this.tubularSegments,h/this.radialSegments)),l.push(f.clone().sub(n).normalize())}for(h=1;h<=this.radialSegments;h++)for(c=1;c<=this.tubularSegments;c++){var d=(this.tubularSegments+1)*h+c-1,m=(this.tubularSegments+1)*(h-1)+c-1,g=(this.tubularSegments+1)*(h-1)+c,v=(this.tubularSegments+1)*h+c,y=new o.Face4(d,m,g,v,[l[d],l[m],l[g],l[v]]);y.normal.add(l[d]),y.normal.add(l[m]),y.normal.add(l[g]),y.normal.add(l[v]),y.normal.normalize(),this.faces.push(y),this.faceVertexUvs[0].push([s[d].clone(),s[m].clone(),s[g].clone(),s[v].clone()])}this.computeCentroids()},o.TorusGeometry.prototype=Object.create(o.Geometry.prototype),o.TorusKnotGeometry=function(e,t,i,r,a,n,s){o.Geometry.call(this);var l=this;this.radius=e||100,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=r||8,this.p=a||2,this.q=n||3,this.heightScale=s||1,this.grid=new Array(this.radialSegments);for(var h=new o.Vector3,c=new o.Vector3,p=new o.Vector3,u=0;u<this.radialSegments;++u){this.grid[u]=new Array(this.tubularSegments);for(var f=0;f<this.tubularSegments;++f){var d,m,g=u/this.radialSegments*2*this.p*Math.PI,v=f/this.tubularSegments*2*Math.PI,y=R(g,v,this.q,this.p,this.radius,this.heightScale),x=R(g+.01,v,this.q,this.p,this.radius,this.heightScale);h.subVectors(x,y),c.addVectors(x,y),p.crossVectors(h,c),c.crossVectors(p,h),p.normalize(),c.normalize(),d=-this.tube*Math.cos(v),m=this.tube*Math.sin(v),y.x+=d*c.x+m*p.x,y.y+=d*c.y+m*p.y,y.z+=d*c.z+m*p.z,this.grid[u][f]=L(y.x,y.y,y.z)}}for(u=0;u<this.radialSegments;++u)for(f=0;f<this.tubularSegments;++f){var _=(u+1)%this.radialSegments,w=(f+1)%this.tubularSegments,b=this.grid[u][f],S=this.grid[_][f],M=this.grid[_][w],A=this.grid[u][w],T=new o.Vector2(u/this.radialSegments,f/this.tubularSegments),C=new o.Vector2((u+1)/this.radialSegments,f/this.tubularSegments),E=new o.Vector2((u+1)/this.radialSegments,(f+1)/this.tubularSegments),P=new o.Vector2(u/this.radialSegments,(f+1)/this.tubularSegments);this.faces.push(new o.Face4(b,S,M,A)),this.faceVertexUvs[0].push([T,C,E,P])}function L(e,t,i){return l.vertices.push(new o.Vector3(e,t,i))-1}function R(e,t,i,r,a,n){var s=Math.cos(e),l=(Math.cos(t),Math.sin(e)),h=i/r*e,c=Math.cos(h),p=a*(2+c)*.5*s,u=a*(2+c)*l*.5,f=n*a*Math.sin(h)*.5;return new o.Vector3(p,u,f)}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.TorusKnotGeometry.prototype=Object.create(o.Geometry.prototype),o.TubeGeometry=function(e,t,i,r,a,n){o.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radiusSegments=r||8,this.closed=a||!1,n&&(this.debug=new o.Object3D),this.grid=[];var s,l,h,c,p,u,f,d,m,g,v,y,x,_,w,b,S,M,A,T,C=this,E=this.segments+1,P=new o.Vector3,L=new o.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),R=L.tangents,D=L.normals,F=L.binormals;function U(e,t,i){return C.vertices.push(new o.Vector3(e,t,i))-1}for(this.tangents=R,this.normals=D,this.binormals=F,m=0;m<E;m++)for(this.grid[m]=[],c=m/(E-1),d=e.getPointAt(c),s=R[m],l=D[m],h=F[m],this.debug&&(this.debug.add(new o.ArrowHelper(s,d,i,255)),this.debug.add(new o.ArrowHelper(l,d,i,16711680)),this.debug.add(new o.ArrowHelper(h,d,i,65280))),g=0;g<this.radiusSegments;g++)p=g/this.radiusSegments*2*Math.PI,u=-this.radius*Math.cos(p),f=this.radius*Math.sin(p),P.copy(d),P.x+=u*l.x+f*h.x,P.y+=u*l.y+f*h.y,P.z+=u*l.z+f*h.z,this.grid[m][g]=U(P.x,P.y,P.z);for(m=0;m<this.segments;m++)for(g=0;g<this.radiusSegments;g++)v=this.closed?(m+1)%this.segments:m+1,y=(g+1)%this.radiusSegments,x=this.grid[m][g],_=this.grid[v][g],w=this.grid[v][y],b=this.grid[m][y],S=new o.Vector2(m/this.segments,g/this.radiusSegments),M=new o.Vector2((m+1)/this.segments,g/this.radiusSegments),A=new o.Vector2((m+1)/this.segments,(g+1)/this.radiusSegments),T=new o.Vector2(m/this.segments,(g+1)/this.radiusSegments),this.faces.push(new o.Face4(x,_,w,b)),this.faceVertexUvs[0].push([S,M,A,T]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.TubeGeometry.prototype=Object.create(o.Geometry.prototype),o.TubeGeometry.FrenetFrames=function(e,t,i){new o.Vector3;var r,a,n,s,l,h,c,p=new o.Vector3,u=(new o.Vector3,[]),f=[],d=[],m=new o.Vector3,g=new o.Matrix4,v=t+1,y=1e-4;for(this.tangents=u,this.normals=f,this.binormals=d,h=0;h<v;h++)c=h/(v-1),u[h]=e.getTangentAt(c),u[h].normalize();function x(){f[0]=new o.Vector3,d[0]=new o.Vector3,a=Number.MAX_VALUE,n=Math.abs(u[0].x),s=Math.abs(u[0].y),l=Math.abs(u[0].z),n<=a&&(a=n,p.set(1,0,0)),s<=a&&(a=s,p.set(0,1,0)),l<=a&&p.set(0,0,1),m.crossVectors(u[0],p).normalize(),f[0].crossVectors(u[0],m),d[0].crossVectors(u[0],f[0])}for(x(),h=1;h<v;h++)f[h]=f[h-1].clone(),d[h]=d[h-1].clone(),m.crossVectors(u[h-1],u[h]),m.length()>y&&(m.normalize(),r=Math.acos(u[h-1].dot(u[h])),f[h].applyMatrix4(g.makeRotationAxis(m,r))),d[h].crossVectors(u[h],f[h]);if(i)for(r=Math.acos(f[0].dot(f[v-1])),r/=v-1,u[0].dot(m.crossVectors(f[0],f[v-1]))>0&&(r=-r),h=1;h<v;h++)f[h].applyMatrix4(g.makeRotationAxis(u[h],r*h)),d[h].crossVectors(u[h],f[h])},o.PolyhedronGeometry=function(e,t,i,r){o.Geometry.call(this),i=i||1,r=r||0;for(var a=this,n=0,s=e.length;n<s;n++)c(new o.Vector3(e[n][0],e[n][1],e[n][2]));var l=[],h=this.vertices;for(n=0,s=t.length;n<s;n++)p(h[t[n][0]],h[t[n][1]],h[t[n][2]],r);this.mergeVertices();for(n=0,s=this.vertices.length;n<s;n++)this.vertices[n].multiplyScalar(i);function c(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var i=f(e)/2/Math.PI+.5,r=d(e)/Math.PI+.5;return t.uv=new o.Vector2(i,1-r),t}function p(e,t,i,r){if(r<1){var n=new o.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);n.centroid.add(e).add(t).add(i).divideScalar(3),n.normal=n.centroid.clone().normalize(),a.faces.push(n);var s=f(n.centroid);a.faceVertexUvs[0].push([m(e.uv,e,s),m(t.uv,t,s),m(i.uv,i,s)])}else r-=1,p(e,u(e,t),u(e,i),r),p(u(e,t),t,u(t,i),r),p(u(e,i),u(t,i),i,r),p(u(e,t),u(t,i),u(e,i),r)}function u(e,t){l[e.index]||(l[e.index]=[]),l[t.index]||(l[t.index]=[]);var i=l[e.index][t.index];return void 0===i&&(l[e.index][t.index]=l[t.index][e.index]=i=c((new o.Vector3).addVectors(e,t).divideScalar(2))),i}function f(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function m(e,t,i){return i<0&&1===e.x&&(e=new o.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new o.Vector2(i/2/Math.PI+.5,e.y)),e}this.computeCentroids(),this.boundingSphere=new o.Sphere(new o.Vector3,i)},o.PolyhedronGeometry.prototype=Object.create(o.Geometry.prototype),o.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2,r=[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],a=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];o.PolyhedronGeometry.call(this,r,a,e,t)},o.IcosahedronGeometry.prototype=Object.create(o.Geometry.prototype),o.OctahedronGeometry=function(e,t){var i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],r=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];o.PolyhedronGeometry.call(this,i,r,e,t)},o.OctahedronGeometry.prototype=Object.create(o.Geometry.prototype),o.TetrahedronGeometry=function(e,t){var i=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],r=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];o.PolyhedronGeometry.call(this,i,r,e,t)},o.TetrahedronGeometry.prototype=Object.create(o.Geometry.prototype),o.ParametricGeometry=function(e,t,i,r){o.Geometry.call(this);var a,n,s,l,h,c=this.vertices,p=this.faces,u=this.faceVertexUvs[0];r=void 0!==r&&r;var f,d,m,g,v,y,x,_,w=t+1;for(a=0;a<=i;a++)for(h=a/i,n=0;n<=t;n++)l=n/t,s=e(l,h),c.push(s);for(a=0;a<i;a++)for(n=0;n<t;n++)f=a*w+n,d=a*w+n+1,m=(a+1)*w+n,g=(a+1)*w+n+1,v=new o.Vector2(n/t,a/i),y=new o.Vector2((n+1)/t,a/i),x=new o.Vector2(n/t,(a+1)/i),_=new o.Vector2((n+1)/t,(a+1)/i),r?(p.push(new o.Face3(f,d,m)),p.push(new o.Face3(d,g,m)),u.push([v,y,x]),u.push([y,_,x])):(p.push(new o.Face4(f,d,g,m)),u.push([v,y,_,x]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.ParametricGeometry.prototype=Object.create(o.Geometry.prototype),o.ConvexGeometry=function(e){o.Geometry.call(this);for(var t=[[0,1,2],[0,2,1]],i=3;i<e.length;i++)r(i);function r(i){var r=e[i].clone(),o=r.length();r.x+=o*l(),r.y+=o*l(),r.z+=o*l();for(var n=[],h=0;h<t.length;){var c=t[h];if(a(c,r)){for(var p=0;p<3;p++){for(var u=[c[p],c[(p+1)%3]],f=!0,d=0;d<n.length;d++)if(s(n[d],u)){n[d]=n[n.length-1],n.pop(),f=!1;break}f&&n.push(u)}t[h]=t[t.length-1],t.pop()}else h++}for(d=0;d<n.length;d++)t.push([n[d][0],n[d][1],i])}function a(t,i){var r=e[t[0]],a=e[t[1]],o=e[t[2]],s=n(r,a,o),l=s.dot(r);return s.dot(i)>=l}function n(e,t,i){var r=new o.Vector3,a=new o.Vector3;return r.subVectors(i,t),a.subVectors(e,t),r.cross(a),r.normalize(),r}function s(e,t){return e[0]===t[1]&&e[1]===t[0]}function l(){return 2*(Math.random()-.5)*1e-6}function h(e){var t=e.length();return new o.Vector2(e.x/t,e.y/t)}var c=0,p=new Array(e.length);for(i=0;i<t.length;i++)for(var u=t[i],f=0;f<3;f++)void 0===p[u[f]]&&(p[u[f]]=c++,this.vertices.push(e[u[f]])),u[f]=p[u[f]];for(i=0;i<t.length;i++)this.faces.push(new o.Face3(t[i][0],t[i][1],t[i][2]));for(i=0;i<this.faces.length;i++){u=this.faces[i];this.faceVertexUvs[0].push([h(this.vertices[u.a]),h(this.vertices[u.b]),h(this.vertices[u.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.ConvexGeometry.prototype=Object.create(o.Geometry.prototype),o.AxisHelper=function(e){var t=new o.Geometry;t.vertices.push(new o.Vector3,new o.Vector3(e||1,0,0),new o.Vector3,new o.Vector3(0,e||1,0),new o.Vector3,new o.Vector3(0,0,e||1)),t.colors.push(new o.Color(16711680),new o.Color(16755200),new o.Color(65280),new o.Color(11206400),new o.Color(255),new o.Color(43775));var i=new o.LineBasicMaterial({vertexColors:o.VertexColors});o.Line.call(this,t,i,o.LinePieces)},o.AxisHelper.prototype=Object.create(o.Line.prototype),o.ArrowHelper=function(e,t,i,r){o.Object3D.call(this),void 0===i&&(i=20),void 0===r&&(r=16776960);var a=new o.Geometry;a.vertices.push(new o.Vector3(0,0,0)),a.vertices.push(new o.Vector3(0,1,0)),this.line=new o.Line(a,new o.LineBasicMaterial({color:r})),this.add(this.line);var n=new o.CylinderGeometry(0,.05,.25,5,1);this.cone=new o.Mesh(n,new o.MeshBasicMaterial({color:r})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof o.Vector3&&(this.position=t),this.setDirection(e),this.setLength(i)},o.ArrowHelper.prototype=Object.create(o.Object3D.prototype),o.ArrowHelper.prototype.setDirection=function(e){var t=o.ArrowHelper.__v1.copy(e).normalize();if(t.y>.999)this.rotation.set(0,0,0);else if(t.y<-.999)this.rotation.set(Math.PI,0,0);else{var i=o.ArrowHelper.__v2.set(t.z,0,-t.x).normalize(),r=Math.acos(t.y),a=o.ArrowHelper.__q1.setFromAxisAngle(i,r);this.rotation.setEulerFromQuaternion(a,this.eulerOrder)}},o.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},o.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},o.ArrowHelper.__v1=new o.Vector3,o.ArrowHelper.__v2=new o.Vector3,o.ArrowHelper.__q1=new o.Quaternion,o.CameraHelper=function(e){o.Line.call(this);var t=this;this.geometry=new o.Geometry,this.material=new o.LineBasicMaterial({color:16777215,vertexColors:o.FaceColors}),this.type=o.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={};var i=16755200,r=16711680,a=43775,n=16777215,s=3355443;function l(e,t,i){h(e,i),h(t,i)}function h(e,i){t.geometry.vertices.push(new o.Vector3),t.geometry.colors.push(new o.Color(i)),void 0===t.pointMap[e]&&(t.pointMap[e]=[]),t.pointMap[e].push(t.geometry.vertices.length-1)}l("n1","n2",i),l("n2","n4",i),l("n4","n3",i),l("n3","n1",i),l("f1","f2",i),l("f2","f4",i),l("f4","f3",i),l("f3","f1",i),l("n1","f1",i),l("n2","f2",i),l("n3","f3",i),l("n4","f4",i),l("p","n1",r),l("p","n2",r),l("p","n3",r),l("p","n4",r),l("u1","u2",a),l("u2","u3",a),l("u3","u1",a),l("c","t",n),l("p","c",s),l("cn1","cn2",s),l("cn3","cn4",s),l("cf1","cf2",s),l("cf3","cf4",s),this.camera=e,this.update(e)},o.CameraHelper.prototype=Object.create(o.Line.prototype),o.CameraHelper.prototype.update=function(){var e=this,t=1,i=1;function r(t,i,r,a){o.CameraHelper.__v.set(i,r,a),o.CameraHelper.__projector.unprojectVector(o.CameraHelper.__v,o.CameraHelper.__c);var n=e.pointMap[t];if(void 0!==n)for(var s=0,l=n.length;s<l;s++)e.geometry.vertices[n[s]].copy(o.CameraHelper.__v)}o.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-t,-i,-1),r("n2",t,-i,-1),r("n3",-t,i,-1),r("n4",t,i,-1),r("f1",-t,-i,1),r("f2",t,-i,1),r("f3",-t,i,1),r("f4",t,i,1),r("u1",.7*t,1.1*i,-1),r("u2",.7*-t,1.1*i,-1),r("u3",0,2*i,-1),r("cf1",-t,0,1),r("cf2",t,0,1),r("cf3",0,-i,1),r("cf4",0,i,1),r("cn1",-t,0,-1),r("cn2",t,0,-1),r("cn3",0,-i,-1),r("cn4",0,i,-1),this.geometry.verticesNeedUpdate=!0},o.CameraHelper.__projector=new o.Projector,o.CameraHelper.__v=new o.Vector3,o.CameraHelper.__c=new o.Camera,o.DirectionalLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.position=e.position,this.direction=new o.Vector3,this.direction.subVectors(e.target.position,e.position);var i=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(i);var r=this.color.getHex(),a=new o.SphereGeometry(t,16,8),n=new o.AsteriskGeometry(1.25*t,2.25*t),s=new o.MeshBasicMaterial({color:r,fog:!1}),l=new o.LineBasicMaterial({color:r,fog:!1});if(this.lightSphere=new o.Mesh(a,s),this.lightRays=new o.Line(n,l,o.LinePieces),this.add(this.lightSphere),this.add(this.lightRays),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==e.target.properties.targetInverse){var h=new o.SphereGeometry(t,8,4),c=new o.MeshBasicMaterial({color:r,wireframe:!0,fog:!1});this.targetSphere=new o.Mesh(h,c),this.targetSphere.position=e.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=e.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var p=new o.LineDashedMaterial({color:r,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),u=new o.Geometry;u.vertices.push(this.position.clone()),u.vertices.push(this.targetSphere.position.clone()),u.computeLineDistances(),this.targetLine=new o.Line(u,p),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},o.DirectionalLightHelper.prototype=Object.create(o.Object3D.prototype),o.DirectionalLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position);var e=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},o.HemisphereLightHelper=function(e,t,i,r){o.Object3D.call(this),this.light=e,this.position=e.position;var a=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(a);var n=this.color.getHex();this.groundColor=e.groundColor.clone(),this.groundColor.multiplyScalar(a);for(var s=this.groundColor.getHex(),l=new o.SphereGeometry(t,16,8,0,2*Math.PI,0,.5*Math.PI),h=new o.SphereGeometry(t,16,8,0,2*Math.PI,.5*Math.PI,Math.PI),c=new o.MeshBasicMaterial({color:n,fog:!1}),p=new o.MeshBasicMaterial({color:s,fog:!1}),u=0,f=l.faces.length;u<f;u++)l.faces[u].materialIndex=0;for(u=0,f=h.faces.length;u<f;u++)h.faces[u].materialIndex=1;o.GeometryUtils.merge(l,h),this.lightSphere=new o.Mesh(l,new o.MeshFaceMaterial([c,p])),this.lightArrow=new o.ArrowHelper(new o.Vector3(0,1,0),new o.Vector3(0,1.1*(t+i),0),i,n),this.lightArrow.rotation.x=Math.PI,this.lightArrowGround=new o.ArrowHelper(new o.Vector3(0,1,0),new o.Vector3(0,-1.1*(t+i),0),i,s);var d=new o.Object3D;d.rotation.x=.5*-Math.PI,d.add(this.lightSphere),d.add(this.lightArrow),d.add(this.lightArrowGround),this.add(d),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0,this.target=new o.Vector3,this.lookAt(this.target)},o.HemisphereLightHelper.prototype=Object.create(o.Object3D.prototype),o.HemisphereLightHelper.prototype.update=function(){var e=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.groundColor.copy(this.light.groundColor),this.groundColor.multiplyScalar(e),this.lightSphere.material.materials[0].color.copy(this.color),this.lightSphere.material.materials[1].color.copy(this.groundColor),this.lightArrow.setColor(this.color.getHex()),this.lightArrowGround.setColor(this.groundColor.getHex()),this.lookAt(this.target)},o.PointLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.position=e.position;var i=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(i);var r=this.color.getHex(),a=new o.SphereGeometry(t,16,8),n=new o.AsteriskGeometry(1.25*t,2.25*t),s=new o.IcosahedronGeometry(1,2),l=new o.MeshBasicMaterial({color:r,fog:!1}),h=new o.LineBasicMaterial({color:r,fog:!1}),c=new o.MeshBasicMaterial({color:r,fog:!1,wireframe:!0,opacity:.1,transparent:!0});this.lightSphere=new o.Mesh(a,l),this.lightRays=new o.Line(n,h,o.LinePieces),this.lightDistance=new o.Mesh(s,c);var p=e.distance;0===p?this.lightDistance.visible=!1:this.lightDistance.scale.set(p,p,p),this.add(this.lightSphere),this.add(this.lightRays),this.add(this.lightDistance),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0},o.PointLightHelper.prototype=Object.create(o.Object3D.prototype),o.PointLightHelper.prototype.update=function(){var e=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightDistance.material.color.copy(this.color);var t=this.light.distance;0===t?this.lightDistance.visible=!1:(this.lightDistance.visible=!0,this.lightDistance.scale.set(t,t,t))},o.SpotLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.position=e.position,this.direction=new o.Vector3,this.direction.subVectors(e.target.position,e.position);var i=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(i);var r=this.color.getHex(),a=new o.SphereGeometry(t,16,8),n=new o.AsteriskGeometry(1.25*t,2.25*t),s=new o.CylinderGeometry(1e-4,1,1,8,1,!0),l=new o.Matrix4;l.rotateX(-Math.PI/2),l.translate(new o.Vector3(0,-.5,0)),s.applyMatrix(l);var h=new o.MeshBasicMaterial({color:r,fog:!1}),c=new o.LineBasicMaterial({color:r,fog:!1}),p=new o.MeshBasicMaterial({color:r,fog:!1,wireframe:!0,opacity:.3,transparent:!0});this.lightSphere=new o.Mesh(a,h),this.lightCone=new o.Mesh(s,p);var u=e.distance?e.distance:1e4,f=u*Math.tan(.5*e.angle)*2;if(this.lightCone.scale.set(f,f,u),this.lightRays=new o.Line(n,c,o.LinePieces),this.gyroscope=new o.Gyroscope,this.gyroscope.add(this.lightSphere),this.gyroscope.add(this.lightRays),this.add(this.gyroscope),this.add(this.lightCone),this.lookAt(e.target.position),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==e.target.properties.targetInverse){var d=new o.SphereGeometry(t,8,4),m=new o.MeshBasicMaterial({color:r,wireframe:!0,fog:!1});this.targetSphere=new o.Mesh(d,m),this.targetSphere.position=e.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=e.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var g=new o.LineDashedMaterial({color:r,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),v=new o.Geometry;v.vertices.push(this.position.clone()),v.vertices.push(this.targetSphere.position.clone()),v.computeLineDistances(),this.targetLine=new o.Line(v,g),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},o.SpotLightHelper.prototype=Object.create(o.Object3D.prototype),o.SpotLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position),this.lookAt(this.light.target.position);var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(.5*this.light.angle)*2;this.lightCone.scale.set(t,t,e);var i=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(i),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightCone.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},o.ImmediateRenderObject=function(){o.Object3D.call(this),this.render=function(e){}},o.ImmediateRenderObject.prototype=Object.create(o.Object3D.prototype),o.LensFlare=function(e,t,i,r,a){o.Object3D.call(this),this.lensFlares=[],this.positionScreen=new o.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,a)},o.LensFlare.prototype=Object.create(o.Object3D.prototype),o.LensFlare.prototype.add=function(e,t,i,r,a,n){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===n&&(n=1),void 0===a&&(a=new o.Color(16777215)),void 0===r&&(r=o.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:n,color:a,blending:r})},o.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,a=2*-this.positionScreen.y;for(e=0;e<i;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+a*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},o.MorphBlendMesh=function(e,t){o.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,r="__default",a=0,n=i-1,s=i/1;this.createAnimation(r,a,n,s),this.setAnimationWeight(r,1)},o.MorphBlendMesh.prototype=Object.create(o.Mesh.prototype),o.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){var a={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=a,this.animationsList.push(a)},o.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,r={},a=this.geometry,o=0,n=a.morphTargets.length;o<n;o++){var s=a.morphTargets[o],l=s.name.match(i);if(l&&l.length>1){var h=l[1];l[2];r[h]||(r[h]={start:1/0,end:-1/0});var c=r[h];o<c.start&&(c.start=o),o>c.end&&(c.end=o),t||(t=h)}}for(var h in r){c=r[h];this.createAnimation(h,c.start,c.end,e)}this.firstAnimation=t},o.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},o.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},o.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},o.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},o.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},o.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},o.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},o.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},o.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},o.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},o.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var a=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var n=r.startFrame+o.Math.clamp(Math.floor(r.time/a),0,r.length-1),s=r.weight;n!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*s,this.morphTargetInfluences[n]=0,r.lastFrame=r.currentFrame,r.currentFrame=n);var l=r.time%a/a;r.directionBackwards&&(l=1-l),this.morphTargetInfluences[r.currentFrame]=l*s,this.morphTargetInfluences[r.lastFrame]=(1-l)*s}}},o.LensFlarePlugin=function(){var e,t,i,r={};function a(t,i){var r=e.createProgram(),a=e.createShader(e.FRAGMENT_SHADER),o=e.createShader(e.VERTEX_SHADER),n="precision "+i+" float;\n";return e.shaderSource(a,n+t.fragmentShader),e.shaderSource(o,n+t.vertexShader),e.compileShader(a),e.compileShader(o),e.attachShader(r,a),e.attachShader(r,o),e.linkProgram(r),r}this.init=function(n){e=n.context,t=n,i=n.getPrecision(),r.vertices=new Float32Array(16),r.faces=new Uint16Array(6);var s=0;r.vertices[s++]=-1,r.vertices[s++]=-1,r.vertices[s++]=0,r.vertices[s++]=0,r.vertices[s++]=1,r.vertices[s++]=-1,r.vertices[s++]=1,r.vertices[s++]=0,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=-1,r.vertices[s++]=1,r.vertices[s++]=0,r.vertices[s++]=1,s=0,r.faces[s++]=0,r.faces[s++]=1,r.faces[s++]=2,r.faces[s++]=0,r.faces[s++]=2,r.faces[s++]=3,r.vertexBuffer=e.createBuffer(),r.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,r.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.faces,e.STATIC_DRAW),r.tempTexture=e.createTexture(),r.occlusionTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,r.tempTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,r.occlusionTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(r.hasVertexTexture=!1,r.program=a(o.ShaderFlares["lensFlare"],i)):(r.hasVertexTexture=!0,r.program=a(o.ShaderFlares["lensFlareVertexTexture"],i)),r.attributes={},r.uniforms={},r.attributes.vertex=e.getAttribLocation(r.program,"position"),r.attributes.uv=e.getAttribLocation(r.program,"uv"),r.uniforms.renderType=e.getUniformLocation(r.program,"renderType"),r.uniforms.map=e.getUniformLocation(r.program,"map"),r.uniforms.occlusionMap=e.getUniformLocation(r.program,"occlusionMap"),r.uniforms.opacity=e.getUniformLocation(r.program,"opacity"),r.uniforms.color=e.getUniformLocation(r.program,"color"),r.uniforms.scale=e.getUniformLocation(r.program,"scale"),r.uniforms.rotation=e.getUniformLocation(r.program,"rotation"),r.uniforms.screenPosition=e.getUniformLocation(r.program,"screenPosition")},this.render=function(i,a,n,s){var l=i.__webglFlares,h=l.length;if(h){var c,p,u,f,d,m=new o.Vector3,g=s/n,v=.5*n,y=.5*s,x=16/s,_=new o.Vector2(x*g,x),w=new o.Vector3(1,1,0),b=new o.Vector2(1,1),S=r.uniforms,M=r.attributes;for(e.useProgram(r.program),e.enableVertexAttribArray(r.attributes.vertex),e.enableVertexAttribArray(r.attributes.uv),e.uniform1i(S.occlusionMap,0),e.uniform1i(S.map,1),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.vertexAttribPointer(M.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(M.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer),e.disable(e.CULL_FACE),e.depthMask(!1),c=0;c<h;c++)if(x=16/s,_.set(x*g,x),f=l[c],m.set(f.matrixWorld.elements[12],f.matrixWorld.elements[13],f.matrixWorld.elements[14]),m.applyMatrix4(a.matrixWorldInverse),m.applyProjection(a.projectionMatrix),w.copy(m),b.x=w.x*v+v,b.y=w.y*y+y,r.hasVertexTexture||b.x>0&&b.x<n&&b.y>0&&b.y<s)for(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r.tempTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,b.x-8,b.y-8,16,16,0),e.uniform1i(S.renderType,0),e.uniform2f(S.scale,_.x,_.y),e.uniform3f(S.screenPosition,w.x,w.y,w.z),e.disable(e.BLEND),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r.occlusionTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,b.x-8,b.y-8,16,16,0),e.uniform1i(S.renderType,1),e.disable(e.DEPTH_TEST),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r.tempTexture),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),f.positionScreen.copy(w),f.customUpdateCallback?f.customUpdateCallback(f):f.updateLensFlares(),e.uniform1i(S.renderType,2),e.enable(e.BLEND),p=0,u=f.lensFlares.length;p<u;p++)d=f.lensFlares[p],d.opacity>.001&&d.scale>.001&&(w.x=d.x,w.y=d.y,w.z=d.z,x=d.size*d.scale/s,_.x=x*g,_.y=x,e.uniform3f(S.screenPosition,w.x,w.y,w.z),e.uniform2f(S.scale,_.x,_.y),e.uniform1f(S.rotation,d.rotation),e.uniform1f(S.opacity,d.opacity),e.uniform3f(S.color,d.color.r,d.color.g,d.color.b),t.setBlending(d.blending,d.blendEquation,d.blendSrc,d.blendDst),t.setTexture(d.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthMask(!0)}}},o.ShadowMapPlugin=function(){var e,t,i,r,a,n,s=new o.Frustum,l=new o.Matrix4,h=new o.Vector3,c=new o.Vector3;function p(e,t){var i=new o.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var r=i.pointsWorld,a=i.pointsFrustum,n=0;n<8;n++)r[n]=new o.Vector3,a[n]=new o.Vector3;var s=e.shadowCascadeNearZ[t],l=e.shadowCascadeFarZ[t];return a[0].set(-1,-1,s),a[1].set(1,-1,s),a[2].set(-1,1,s),a[3].set(1,1,s),a[4].set(-1,-1,l),a[5].set(1,-1,l),a[6].set(-1,1,l),a[7].set(1,1,l),i}function u(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t],o=i.pointsFrustum;o[0].z=r,o[1].z=r,o[2].z=r,o[3].z=r,o[4].z=a,o[5].z=a,o[6].z=a,o[7].z=a}function f(e,t){var i=t.shadowCamera,r=t.pointsFrustum,a=t.pointsWorld;h.set(1/0,1/0,1/0),c.set(-1/0,-1/0,-1/0);for(var n=0;n<8;n++){var s=a[n];s.copy(r[n]),o.ShadowMapPlugin.__projector.unprojectVector(s,e),s.applyMatrix4(i.matrixWorldInverse),s.x<h.x&&(h.x=s.x),s.x>c.x&&(c.x=s.x),s.y<h.y&&(h.y=s.y),s.y>c.y&&(c.y=s.y),s.z<h.z&&(h.z=s.z),s.z>c.z&&(c.z=s.z)}i.left=h.x,i.right=c.x,i.top=c.y,i.bottom=h.y,i.updateProjectionMatrix()}function d(e){return e.material instanceof o.MeshFaceMaterial?e.material.materials[0]:e.material}this.init=function(s){e=s.context,t=s;var l=o.ShaderLib["depthRGBA"],h=o.UniformsUtils.clone(l.uniforms);i=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h}),r=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,morphTargets:!0}),a=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,skinning:!0}),n=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),i._shadowPass=!0,r._shadowPass=!0,a._shadowPass=!0,n._shadowPass=!0},this.render=function(e,i){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,i)},this.update=function(h,c){var m,g,v,y,x,_,w,b,S,M,A,T,C,E,P=[],L=0,R=null;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===o.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),m=0,g=h.__lights.length;m<g;m++)if(C=h.__lights[m],C.castShadow)if(C instanceof o.DirectionalLight&&C.shadowCascade)for(x=0;x<C.shadowCascadeCount;x++){var D;if(C.shadowCascadeArray[x])D=C.shadowCascadeArray[x];else{D=p(C,x),D.originalCamera=c;var F=new o.Gyroscope;F.position=C.shadowCascadeOffset,F.add(D),F.add(D.target),c.add(F),C.shadowCascadeArray[x]=D,console.log("Created virtualLight",D)}u(C,x),P[L]=D,L++}else P[L]=C,L++;for(m=0,g=P.length;m<g;m++){if(C=P[m],!C.shadowMap){var U=o.LinearFilter;t.shadowMapType===o.PCFSoftShadowMap&&(U=o.NearestFilter);var z={minFilter:U,magFilter:U,format:o.RGBAFormat};C.shadowMap=new o.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,z),C.shadowMapSize=new o.Vector2(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new o.Matrix4}if(!C.shadowCamera){if(C instanceof o.SpotLight)C.shadowCamera=new o.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else{if(!(C instanceof o.DirectionalLight)){console.error("Unsupported light type for shadow");continue}C.shadowCamera=new o.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}h.add(C.shadowCamera),t.autoUpdateScene&&h.updateMatrixWorld()}for(C.shadowCameraVisible&&!C.cameraHelper&&(C.cameraHelper=new o.CameraHelper(C.shadowCamera),C.shadowCamera.add(C.cameraHelper)),C.isVirtual&&D.originalCamera==c&&f(c,C),_=C.shadowMap,w=C.shadowMatrix,b=C.shadowCamera,b.position.copy(C.matrixWorld.getPosition()),b.lookAt(C.target.matrixWorld.getPosition()),b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),C.cameraHelper&&(C.cameraHelper.visible=C.shadowCameraVisible),C.shadowCameraVisible&&C.cameraHelper.update(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(b.projectionMatrix),w.multiply(b.matrixWorldInverse),l.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),s.setFromMatrix(l),t.setRenderTarget(_),t.clear(),E=h.__webglObjects,v=0,y=E.length;v<y;v++)A=E[v],T=A.object,A.render=!1,T.visible&&T.castShadow&&((T instanceof o.Mesh||T instanceof o.ParticleSystem)&&T.frustumCulled&&!s.intersectsObject(T)||(T._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,T.matrixWorld),A.render=!0));var V,B,N;for(v=0,y=E.length;v<y;v++)A=E[v],A.render&&(T=A.object,S=A.buffer,V=d(T),B=T.geometry.morphTargets.length>0&&V.morphTargets,N=T instanceof o.SkinnedMesh&&V.skinning,M=T.customDepthMaterial?T.customDepthMaterial:N?B?n:a:B?r:i,S instanceof o.BufferGeometry?t.renderBufferDirect(b,h.__lights,R,M,S,T):t.renderBuffer(b,h.__lights,R,M,S,T));for(E=h.__webglObjectsImmediate,v=0,y=E.length;v<y;v++)A=E[v],T=A.object,T.visible&&T.castShadow&&(T._modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,T.matrixWorld),t.renderImmediateObject(b,h.__lights,R,i,T))}var O=t.getClearColor(),I=t.getClearAlpha();e.clearColor(O.r,O.g,O.b,I),e.enable(e.BLEND),t.shadowMapCullFace===o.CullFaceFront&&e.cullFace(e.BACK)}},o.ShadowMapPlugin.__projector=new o.Projector,o.SpritePlugin=function(){var e,t,i,r={};function a(t,i){var r=e.createProgram(),a=e.createShader(e.FRAGMENT_SHADER),o=e.createShader(e.VERTEX_SHADER),n="precision "+i+" float;\n";return e.shaderSource(a,n+t.fragmentShader),e.shaderSource(o,n+t.vertexShader),e.compileShader(a),e.compileShader(o),e.attachShader(r,a),e.attachShader(r,o),e.linkProgram(r),r}function n(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}this.init=function(n){e=n.context,t=n,i=n.getPrecision(),r.vertices=new Float32Array(16),r.faces=new Uint16Array(6);var s=0;r.vertices[s++]=-1,r.vertices[s++]=-1,r.vertices[s++]=0,r.vertices[s++]=0,r.vertices[s++]=1,r.vertices[s++]=-1,r.vertices[s++]=1,r.vertices[s++]=0,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=-1,r.vertices[s++]=1,r.vertices[s++]=0,r.vertices[s++]=1,s=0,r.faces[s++]=0,r.faces[s++]=1,r.faces[s++]=2,r.faces[s++]=0,r.faces[s++]=2,r.faces[s++]=3,r.vertexBuffer=e.createBuffer(),r.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,r.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.faces,e.STATIC_DRAW),r.program=a(o.ShaderSprite["sprite"],i),r.attributes={},r.uniforms={},r.attributes.position=e.getAttribLocation(r.program,"position"),r.attributes.uv=e.getAttribLocation(r.program,"uv"),r.uniforms.uvOffset=e.getUniformLocation(r.program,"uvOffset"),r.uniforms.uvScale=e.getUniformLocation(r.program,"uvScale"),r.uniforms.rotation=e.getUniformLocation(r.program,"rotation"),r.uniforms.scale=e.getUniformLocation(r.program,"scale"),r.uniforms.alignment=e.getUniformLocation(r.program,"alignment"),r.uniforms.color=e.getUniformLocation(r.program,"color"),r.uniforms.map=e.getUniformLocation(r.program,"map"),r.uniforms.opacity=e.getUniformLocation(r.program,"opacity"),r.uniforms.useScreenCoordinates=e.getUniformLocation(r.program,"useScreenCoordinates"),r.uniforms.sizeAttenuation=e.getUniformLocation(r.program,"sizeAttenuation"),r.uniforms.screenPosition=e.getUniformLocation(r.program,"screenPosition"),r.uniforms.modelViewMatrix=e.getUniformLocation(r.program,"modelViewMatrix"),r.uniforms.projectionMatrix=e.getUniformLocation(r.program,"projectionMatrix"),r.uniforms.fogType=e.getUniformLocation(r.program,"fogType"),r.uniforms.fogDensity=e.getUniformLocation(r.program,"fogDensity"),r.uniforms.fogNear=e.getUniformLocation(r.program,"fogNear"),r.uniforms.fogFar=e.getUniformLocation(r.program,"fogFar"),r.uniforms.fogColor=e.getUniformLocation(r.program,"fogColor"),r.uniforms.alphaTest=e.getUniformLocation(r.program,"alphaTest")},this.render=function(i,a,s,l){var h=i.__webglSprites,c=h.length;if(c){var p=r.attributes,u=r.uniforms,f=l/s,d=.5*s,m=.5*l;e.useProgram(r.program),e.enableVertexAttribArray(p.position),e.enableVertexAttribArray(p.uv),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer),e.vertexAttribPointer(p.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(p.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer),e.uniformMatrix4fv(u.projectionMatrix,!1,a.projectionMatrix.elements),e.activeTexture(e.TEXTURE0),e.uniform1i(u.map,0);var g=0,v=0,y=i.fog;y?(e.uniform3f(u.fogColor,y.color.r,y.color.g,y.color.b),y instanceof o.Fog?(e.uniform1f(u.fogNear,y.near),e.uniform1f(u.fogFar,y.far),e.uniform1i(u.fogType,1),g=1,v=1):y instanceof o.FogExp2&&(e.uniform1f(u.fogDensity,y.density),e.uniform1i(u.fogType,2),g=2,v=2)):(e.uniform1i(u.fogType,0),g=0,v=0);var x,_,w,b,S,M=[];for(x=0;x<c;x++)_=h[x],w=_.material,_.visible&&0!==w.opacity&&(w.useScreenCoordinates?_.z=-_.position.z:(_._modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,_.matrixWorld),_.z=-_._modelViewMatrix.elements[14]));for(h.sort(n),x=0;x<c;x++)_=h[x],w=_.material,_.visible&&0!==w.opacity&&w.map&&w.map.image&&w.map.image.width&&(e.uniform1f(u.alphaTest,w.alphaTest),!0===w.useScreenCoordinates?(e.uniform1i(u.useScreenCoordinates,1),e.uniform3f(u.screenPosition,(_.position.x*t.devicePixelRatio-d)/d,(m-_.position.y*t.devicePixelRatio)/m,Math.max(0,Math.min(1,_.position.z))),M[0]=t.devicePixelRatio,M[1]=t.devicePixelRatio):(e.uniform1i(u.useScreenCoordinates,0),e.uniform1i(u.sizeAttenuation,w.sizeAttenuation?1:0),e.uniformMatrix4fv(u.modelViewMatrix,!1,_._modelViewMatrix.elements),M[0]=1,M[1]=1),S=i.fog&&w.fog?v:0,g!==S&&(e.uniform1i(u.fogType,S),g=S),b=1/(w.scaleByViewport?l:1),M[0]*=b*f*_.scale.x,M[1]*=b*_.scale.y,e.uniform2f(u.uvScale,w.uvScale.x,w.uvScale.y),e.uniform2f(u.uvOffset,w.uvOffset.x,w.uvOffset.y),e.uniform2f(u.alignment,w.alignment.x,w.alignment.y),e.uniform1f(u.opacity,w.opacity),e.uniform3f(u.color,w.color.r,w.color.g,w.color.b),e.uniform1f(u.rotation,_.rotation),e.uniform2fv(u.scale,M),t.setBlending(w.blending,w.blendEquation,w.blendSrc,w.blendDst),t.setDepthTest(w.depthTest),t.setDepthWrite(w.depthWrite),t.setTexture(w.map,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE)}}},o.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,i,r,a,n,s=new o.Frustum,l=new o.Matrix4;function h(e){return e.material instanceof o.MeshFaceMaterial?e.material.materials[0]:e.material}this.init=function(s){e=s.context,t=s;var l=o.ShaderLib["depthRGBA"],h=o.UniformsUtils.clone(l.uniforms);i=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h}),r=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,morphTargets:!0}),a=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,skinning:!0}),n=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),i._shadowPass=!0,r._shadowPass=!0,a._shadowPass=!0,n._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(c,p){var u,f,d,m,g,v,y,x,_,w,b=null;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),t.autoUpdateScene&&c.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),l.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),s.setFromMatrix(l),t.setRenderTarget(this.renderTarget),t.clear(),y=c.__webglObjects,u=0,f=y.length;u<f;u++)g=y[u],v=g.object,g.render=!1,v.visible&&((v instanceof o.Mesh||v instanceof o.ParticleSystem)&&v.frustumCulled&&!s.intersectsObject(v)||(v._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,v.matrixWorld),g.render=!0));for(u=0,f=y.length;u<f;u++)if(g=y[u],g.render){if(v=g.object,d=g.buffer,v instanceof o.ParticleSystem&&!v.customDepthMaterial)continue;x=h(v),x&&t.setMaterialFaces(v.material),_=v.geometry.morphTargets.length>0&&x.morphTargets,w=v instanceof o.SkinnedMesh&&x.skinning,m=v.customDepthMaterial?v.customDepthMaterial:w?_?n:a:_?r:i,d instanceof o.BufferGeometry?t.renderBufferDirect(p,c.__lights,b,m,d,v):t.renderBuffer(p,c.__lights,b,m,d,v)}for(y=c.__webglObjectsImmediate,u=0,f=y.length;u<f;u++)g=y[u],v=g.object,v.visible&&(v._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,v.matrixWorld),t.renderImmediateObject(p,c.__lights,b,i,v));var S=t.getClearColor(),M=t.getClearAlpha();e.clearColor(S.r,S.g,S.b,M),e.enable(e.BLEND)}},o.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},o.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},e.exports&&(t=e.exports=o),t.THREE=o},8209:function(e,t,i){"use strict";i("ffeb")},"870b":function(e,t,i){var r=i("24fb"),a=i("1de5"),o=i("e916");t=r(!1);var n=a(o);t.push([e.i,'.animall[data-v-0c6f1d7c]{width:1000px;height:530px;display:flex;flex-direction:row;position:absolute}.animall .icons[data-v-0c6f1d7c]{height:4%}.animall .icons1[data-v-0c6f1d7c]{position:absolute;left:27%;top:74.9%;z-index:12}.animall .icons2[data-v-0c6f1d7c]{position:absolute;left:64%;top:78.5%;z-index:12}.animall .icons3[data-v-0c6f1d7c]{position:absolute;left:33.5%;top:35%;z-index:12}.animall .icons4[data-v-0c6f1d7c]{position:absolute;left:81.1%;top:25%;z-index:12}.animall .img[data-v-0c6f1d7c]{height:28%;z-index:10;image-rendering:-webkit-optimize-contrast}.animall .item[data-v-0c6f1d7c]{letter-spacing:2px;position:absolute;text-align:center;padding:2px 20px;background:linear-gradient(13.1deg,#ff762a 1.96%,#faaf1d 73.07%);background-clip:padding-box;border:3px solid rgba(28,210,237,.3);border-radius:57px;font-weight:500;font-size:22px;line-height:40px;color:#fff}.animall .img1[data-v-0c6f1d7c]{position:absolute;left:44%;top:69%;height:23%}.animall .item1[data-v-0c6f1d7c]{left:44%;top:5.8%;z-index:11}.animall .img2[data-v-0c6f1d7c]{left:75%;top:48%;position:absolute}.animall .item2[data-v-0c6f1d7c]{left:72.5%;top:39.3%;background:linear-gradient(13.1deg,#1270e0 1.96%,#1da3fa 73.07%);background-clip:padding-box;border:3px solid rgba(28,210,237,.3);z-index:9}.animall .img3[data-v-0c6f1d7c]{left:11%;top:48%;position:absolute}.animall .item3[data-v-0c6f1d7c]{left:9%;top:39.3%;background:linear-gradient(13.1deg,#1270e0 1.96%,#1da3fa 73.07%);background-clip:padding-box;border:3px solid rgba(28,210,237,.3);z-index:9}.animall .img4[data-v-0c6f1d7c]{position:absolute;left:39%;top:13%;height:41%}.animall .item4[data-v-0c6f1d7c]{left:41.5%;top:61.5%;background:linear-gradient(13.1deg,#1270e0 1.96%,#1da3fa 73.07%);background-clip:padding-box;border:3px solid rgba(28,210,237,.3);z-index:9}.animall .lines[data-v-0c6f1d7c]{transform:rotate(-90deg);position:absolute;width:200px;height:2px;background:linear-gradient(13.1deg,#1deaec 1.96%,#1270e0 63.07%,rgba(28,210,237,.2) 85.07%,rgba(28,210,237,0) 90%)}.animall .back[data-v-0c6f1d7c]{position:relative;overflow:hidden;width:300px;height:8px;margin-top:20px}.animall .line-icon[data-v-0c6f1d7c]{position:absolute;left:0;top:-3px;width:300px;height:8px;border-radius:0 0 50% 50%;background:linear-gradient(90deg,#37393d,#4d5f82 49%,#37393d)}.animall .lines[data-v-0c6f1d7c]:before{content:"";transform:rotate(90deg);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:15px solid #1971ff;position:absolute;top:-7px}.animall .lines1[data-v-0c6f1d7c]{width:21%;left:7.5%;top:21%;z-index:9}.animall .lines1[data-v-0c6f1d7c]:before{-webkit-animation:mymove1-data-v-0c6f1d7c 4s infinite;animation:mymove1-data-v-0c6f1d7c 4s infinite}.animall .lines2[data-v-0c6f1d7c]{width:25%;left:54.5%;top:25%;z-index:9}.animall .lines2[data-v-0c6f1d7c]:before{-webkit-animation:mymove2-data-v-0c6f1d7c 4s infinite;animation:mymove2-data-v-0c6f1d7c 4s infinite}.animall .lines3[data-v-0c6f1d7c]{width:25%;left:22%;top:25%;z-index:9}.animall .lines3[data-v-0c6f1d7c]:before{-webkit-animation:mymove2-data-v-0c6f1d7c 4s infinite;animation:mymove2-data-v-0c6f1d7c 4s infinite}.animall .lines4[data-v-0c6f1d7c]{width:21%;left:71.5%;top:21%;z-index:9}.animall .lines4[data-v-0c6f1d7c]:before{-webkit-animation:mymove1-data-v-0c6f1d7c 4s infinite;animation:mymove1-data-v-0c6f1d7c 4s infinite}.animall .line1[data-v-0c6f1d7c]{transform:rotate(30deg);position:absolute;height:2px;background:linear-gradient(13.1deg,#1deaec 1.96%,#1270e0 73.07%);width:25%;left:55%;top:49%;z-index:9}.animall .line1[data-v-0c6f1d7c]:before{content:"";transform:rotate(90deg);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:15px solid #1deaec;position:absolute;top:-7px;-webkit-animation:mymove-data-v-0c6f1d7c 4s infinite;animation:mymove-data-v-0c6f1d7c 4s infinite}.animall .line2[data-v-0c6f1d7c]{transform:rotate(150deg);position:absolute;height:2px;background:linear-gradient(13.1deg,#1270e0 1.96%,#1deaec 73.07%);width:28%;left:20%;top:49%}.animall .line2[data-v-0c6f1d7c]:before{content:"";transform:rotate(90deg);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:15px solid #1270e0;position:absolute;top:-7px;-webkit-animation:mymove-data-v-0c6f1d7c 4s infinite;animation:mymove-data-v-0c6f1d7c 4s infinite}.animall .line3[data-v-0c6f1d7c]{position:absolute;width:2px;height:16%;background:linear-gradient(13.1deg,#1270e0 1.96%,#1270e0 73.07%);left:51%;top:48%}.animall .line3[data-v-0c6f1d7c]:before{content:"";transform:rotate(180deg);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:15px solid #1270e0;position:absolute;top:8px;-webkit-animation:mymove4-data-v-0c6f1d7c 4s infinite;animation:mymove4-data-v-0c6f1d7c 4s infinite;left:-5px}.animall .bottom-yuan[data-v-0c6f1d7c]{position:absolute;width:100%;height:68%;bottom:4.5%;background-image:url('+n+');background-position:center 0;background-size:contain;background-repeat:no-repeat}.animall .circle[data-v-0c6f1d7c]{position:absolute;top:59%;left:16%;width:75%;height:26%;z-index:9}.animall .circle1[data-v-0c6f1d7c]{position:absolute;top:29%;left:16%;width:900px;height:160px;z-index:99}.animall .circle1 path[data-v-0c6f1d7c]{transition:all .3s ease;d:path("M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z")}.animall .circle1 path.pause[data-v-0c6f1d7c]{d:path("M 12,26 16.33,26 16.33,10 12,10 z M 20.66,26 25,26 25,10 20.66,10 z")}@-webkit-keyframes mymove-data-v-0c6f1d7c{0%{left:75px}to{left:100%}}@keyframes mymove-data-v-0c6f1d7c{0%{left:75px}to{left:100%}}@-webkit-keyframes mymove1-data-v-0c6f1d7c{0%{left:0;opacity:1}to{left:100%;opacity:0}}@keyframes mymove1-data-v-0c6f1d7c{0%{left:0;opacity:1}to{left:100%;opacity:0}}@-webkit-keyframes mymove2-data-v-0c6f1d7c{0%{left:0;opacity:1}to{left:100%;opacity:0}}@keyframes mymove2-data-v-0c6f1d7c{0%{left:0;opacity:1}to{left:100%;opacity:0}}@-webkit-keyframes mymove4-data-v-0c6f1d7c{0%{top:8px}to{top:100%}}@keyframes mymove4-data-v-0c6f1d7c{0%{top:8px}to{top:100%}}',""]),e.exports=t},"8f3f":function(e,t,i){e.exports=i.p+"img/bg.694b600c.png"},d101:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"bacground",attrs:{id:"canvas"}},[i("animall")],1)},a=[],o=i("7fed"),n=i("fd5c"),s={components:{animall:n["a"]},name:"bacground",data(){return{}},mounted(){var e,t,r,a,n,s,l=100,h=40,c=40,p=0;function u(){t.aspect=e.offsetWidth/e.offsetHeight,t.updateProjectionMatrix(),a.setSize(e.offsetWidth,e.offsetHeight)}function f(){e=document.getElementById("canvas"),t=new o["PerspectiveCamera"](120,e.offsetWidth/e.offsetHeight,1,1500),t.position.set(0,450,2e3),r=new o["Scene"];const p=(new o["TextureLoader"]).load(i("8f3f"));r.background=p,console.log(r.background),n=[];for(var f=2*Math.PI,d=new o["ParticleCanvasMaterial"]({color:1021695,vertexColors:!0,size:4,program:function(e){e.beginPath(),e.arc(0,0,.01,0,f,!0),e.fill()}}),m=new o["ParticleCanvasMaterial"]({color:16777215,vertexColors:!0,size:1,program:function(e){e.beginPath();var t=e.createLinearGradient(-.008,.25,.016,-.25);t.addColorStop(0,"#1cd2ed57"),t.addColorStop(1,"#0090ff"),e.fillStyle=t,e.fillRect(-.002,0,.003,1),e.fillStyle="#1cd2ed57",e.arc(0,0,.008,0,f,!0),e.fillStyle="#1cd2ed57",e.arc(0,1,.008,0,f,!0),e.fill(),e.closePath();var i=e.createRadialGradient(0,.25,0,0,.25,.025);i.addColorStop(0,"transparent"),i.addColorStop(1,"#1cd2ed57"),e.fillStyle=i,e.arc(0,1,.005,0,f,!0),e.fill()}}),g=0,v=0;v<h;v++)for(var y=0;y<c;y++){var x=Math.random()-.05;s=n[g++]=x>0?new o["Particle"](d):new o["Particle"](m),s.position.x=v*l-h*l/2,s.position.z=y*l-c*l/2,r.add(s)}a=new o["CanvasRenderer"],a.setSize(e.offsetWidth,e.offsetHeight),e.appendChild(a.domElement),window.addEventListener("resize",u,!1)}function d(){requestAnimationFrame(d),m()}function m(){for(var e=0,i=0;i<h;i++)for(var o=0;o<c;o++)s=n[e++],s.position.y=50*Math.sin(.3*(i+p))+50*Math.sin(.5*(o+p)),s.scale.x=s.scale.y=s.scale.z=50*(4*(Math.sin(.3*(i+p))+1)+4*(Math.sin(.5*(o+p))+1));a.render(r,t),p+=.1}f(),d()},methods:{},computed:{}},l=s,h=(i("f1a8"),i("2877")),c=Object(h["a"])(l,r,a,!1,null,"5f34950a",null);t["default"]=c.exports},e916:function(e,t,i){e.exports=i.p+"img/backyuan.4b66864e.png"},f1a8:function(e,t,i){"use strict";i("3f2e")},fd5c:function(e,t,i){"use strict";var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"animall"},[r("span",{staticClass:"lines1 lines"}),r("span",{staticClass:"lines2 lines"}),r("span",{staticClass:"lines3 lines"}),r("span",{staticClass:"lines4 lines"}),r("img",{staticClass:"icons icons1",attrs:{src:i("6b3c"),alt:""}}),r("img",{staticClass:"icons icons2",attrs:{src:i("6b3c"),alt:""}}),r("img",{staticClass:"icons icons3",attrs:{src:i("6b3c"),alt:""}}),r("img",{staticClass:"icons icons4",attrs:{src:i("6b3c"),alt:""}}),r("img",{staticClass:"img1 img",attrs:{src:i("292a"),alt:""}}),r("span",{staticClass:"item1 item"},[e._v("XXXXX")]),r("img",{staticClass:"img2 img",attrs:{src:i("704c"),alt:""}}),r("span",{staticClass:"item2 item"},[e._v("XXXXX50")]),r("img",{staticClass:"img3 img",attrs:{src:i("704c"),alt:""}}),r("span",{staticClass:"item3 item"},[e._v("XXXXX50")]),r("img",{staticClass:"img4 img",attrs:{src:i("02d6"),alt:""}}),r("span",{staticClass:"item4 item"},[e._v("XXXXX50")]),r("span",{staticClass:"\n       line1"}),r("span",{staticClass:"line2"}),r("span",{staticClass:"line3"}),r("svg",{staticClass:"circle",attrs:{version:"1.1",preserveAspectRatio:"xMinYMin meet"}},[r("path",{staticStyle:{stroke:"url(#grad1)"},attrs:{d:"M0 50 Q400 260 800 50",fill:"transparent","stroke-width":"2","stroke-linecap":"round",stroke:"red"}}),r("defs",[r("linearGradient",{attrs:{id:"grad1",x1:"0%",y1:"0%",x2:"100%",y2:"0%"}},[r("stop",{staticStyle:{"stop-color":"#1DEAEC","stop-opacity":"1"},attrs:{offset:"0%"}}),r("stop",{staticStyle:{"stop-color":"#0FBEF6","stop-opacity":"1"},attrs:{offset:"50%"}}),r("stop",{staticStyle:{"stop-color":"#07A4FC","stop-opacity":"1"},attrs:{offset:"100%"}})],1)],1),r("g",{attrs:{transform:"translate(0, -46) scale(0.3) rotate(90) "}},[r("path",{staticStyle:{fill:"url(#grad1)"},attrs:{name:"",fill:"red",stroke:"blue",d:"M150 50 L130 130 L170 130  Z"}}),r("animateMotion",{attrs:{path:"M0 50 Q400 260 800 50",begin:"0s",rotate:"auto",dur:"6s",repeatCount:"indefinite"}})],1)]),r("div",{staticClass:"bottom-yuan"})])},a=[],o={components:{},name:"animall",data(){return{}},mounted(){const e=document.getElementsByTagName("svg");for(let t=0;t<e.length;t++)e[t].setAttribute("viewBox","0,0,"+e[t].getBBox().width+","+e[t].getBBox().height)},methods:{},computed:{}},n=o,s=(i("8209"),i("2877")),l=Object(s["a"])(n,r,a,!1,null,"0c6f1d7c",null);t["a"]=l.exports},ffeb:function(e,t,i){var r=i("870b");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=i("499e").default;a("9238dc70",r,!0,{sourceMap:!1,shadowMode:!1})}}]);